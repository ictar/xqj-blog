

<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>随机优化算法详解：模拟退火与 Pincus 定理 - </title>

  <meta name="description" content="当优化问题陷于局部最优的迷宫时，确定性算法往往束手无策。本文将带你进入随机优化的世界，探索如何将寻找最小能量的问题转化为寻找最大概率的问题。我们将深入剖析模拟退火算法（Simulated Annealing）的物理直觉与数学原理，通过动态可视化展示其“高温探索、低温锁定”的优雅机制，并详细推导 Pincus 定理，从数学上证明为何退火算法能找到全局最优解。">
  <meta name="author" content="Qiongjie.X"/>


<link rel="canonical" href="http://localhost:1313/zh-cn/post/mcmc-statics/stochastic-optimization/" />


<meta name="keywords" content="随机优化, 模拟退火, 优化算法, 机器学习, Pincus定理, Python实现" /><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "琼呀",
    
    "url": "http:\/\/localhost:1313\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/localhost:1313\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/localhost:1313\/zh-cn\/post\/mcmc-statics\/stochastic-optimization\/",
          "name": "随机优化算法详解：模拟退火与 pincus 定理"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Qiongjie.X"
  },
  "headline": "随机优化算法详解：模拟退火与 Pincus 定理",
  "description" : "当优化问题陷于局部最优的迷宫时，确定性算法往往束手无策。本文将带你进入随机优化的世界，探索如何将寻找最小能量的问题转化为寻找最大概率的问题。我们将深入剖析模拟退火算法（Simulated Annealing）的物理直觉与数学原理，通过动态可视化展示其“高温探索、低温锁定”的优雅机制，并详细推导 Pincus 定理，从数学上证明为何退火算法能找到全局最优解。",
  "inLanguage" : "zh-cn",
  "wordCount":  1799 ,
  "datePublished" : "2026-02-02T00:00:00\u002b00:00",
  "dateModified" : "2026-02-02T00:00:00\u002b00:00",
  "image" : "http:\/\/localhost:1313\/img\/avatar-icon.png",
  "keywords" : [ "随机优化, 模拟退火, 优化算法, 机器学习, Pincus定理, Python实现" ],
  "mainEntityOfPage" : "http:\/\/localhost:1313\/zh-cn\/post\/mcmc-statics\/stochastic-optimization\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/localhost:1313\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/localhost:1313\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>



<meta property="og:title" content="随机优化算法详解：模拟退火与 Pincus 定理" />
<meta property="og:description" content="当优化问题陷于局部最优的迷宫时，确定性算法往往束手无策。本文将带你进入随机优化的世界，探索如何将寻找最小能量的问题转化为寻找最大概率的问题。我们将深入剖析模拟退火算法（Simulated Annealing）的物理直觉与数学原理，通过动态可视化展示其“高温探索、低温锁定”的优雅机制，并详细推导 Pincus 定理，从数学上证明为何退火算法能找到全局最优解。">
<meta property="og:image" content="http://localhost:1313/img/avatar-icon.png" />
<meta property="og:url" content="http://localhost:1313/zh-cn/post/mcmc-statics/stochastic-optimization/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="琼呀" />

  <meta name="twitter:title" content="随机优化算法详解：模拟退火与 Pincus 定理" />
  <meta name="twitter:description" content="当优化问题陷于局部最优的迷宫时，确定性算法往往束手无策。本文将带你进入随机优化的世界，探索如何将寻找最小能量的问题转化为寻找最大概率的问题。我们将深入剖析模拟退火算法（Simulated Annealing）的物理直觉与数学原理，通过动态可视化展示其“高温探索、低温锁定”的优雅机制，并详细推导 Pincus 定理，从数学上证明为何退火算法能找到全局最优解。">
  <meta name="twitter:image" content="http://localhost:1313/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='http://localhost:1313/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.147.4">
  <link rel="alternate" href="http://localhost:1313/zh-cn/index.xml" type="application/rss+xml" title="琼呀"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="http://localhost:1313/css/main.css" /><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://localhost:1313/css/syntax.css" /><link rel="stylesheet" href="http://localhost:1313/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  crossorigin="anonymous"
/>
<link rel="stylesheet" href="http://localhost:1313/css/custom.css"><link rel="stylesheet" href="http://localhost:1313/css/toc.css">

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  crossorigin="anonymous"
></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body, {
    delimiters: [
      {left: '$$', right: '$$', display: true},
      {left: '$', right: '$', display: false}
    ]
  });"></script>


<link rel="icon" type="image/png" href="http://localhost:1313/img/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="http://localhost:1313/img/favicon.svg" />
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/img/apple-touch-icon.png" />
<link rel="manifest" href="http://localhost:1313/img/site.webmanifest" />

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost:1313/zh-cn/">琼呀</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" role="button" tabindex="0" href="/zh-cn/post">文章</a>
              <div class="navlinks-children">
                
                  <a href="/zh-cn/post/python-geodata">用 Python 玩转遥感数据</a>
                
                  <a href="/zh-cn/post/mcmc-statics">蒙特卡洛-马尔可夫链统计方法</a>
                
                  <a href="/zh-cn/post/ai-fundamentals">AI 基础系列</a>
                
                  <a href="/zh-cn/post/geoai">GeoAI 系列</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" role="button" tabindex="0" href="/zh-cn/projects">项目</a>
              <div class="navlinks-children">
                
                  <a href="https://ictar.github.io/TerraFlow/">TerraFlow</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="笔记" href="/zh-cn/notes">笔记</a>
            </li>
          
        
          
            <li>
              <a title="标签" href="/zh-cn/tags">标签</a>
            </li>
          
        
          
            <li>
              <a title="关于我" href="/zh-cn/page/about/">关于我</a>
            </li>
          
        

        
          
            <li>
              
                
                  <a href="http://localhost:1313/post/mcmc-statics/stochastic-optimization/">EN</a>
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="琼呀" href="http://localhost:1313/zh-cn/">
            <img class="avatar-img" src="http://localhost:1313/img/avatar-icon.png" alt="琼呀" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>随机优化算法详解：模拟退火与 Pincus 定理</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;发表于 February 2, 2026
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1799&nbsp;个字
  
  
  &nbsp;&bull;&nbsp;其它语言: <a href="http://localhost:1313/post/mcmc-statics/stochastic-optimization/" lang="en">EN</a>
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row" style="display: flex; flex-wrap: wrap;">
    
    
    <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h1 id="随机优化stochastic-optimization">随机优化（Stochastic Optimization）</h1>
<blockquote>
<p>在一个充满不确定性（噪声）或者极其复杂（非凸）的环境中，如何利用“随机性”来找到最佳方案。</p></blockquote>
<h2 id="从确定性优化到随机优化">从确定性优化到随机优化</h2>
<h3 id="问题的定义从确定性世界出发">问题的定义：从确定性世界出发</h3>
<p>一切始于一个经典的优化难题。假设我们需要寻找一个系统的最优状态，用数学语言描述就是：
</p>
$$\min_{x \in Q} E(x) = m$$<p>
其中：</p>
<ul>
<li>$x$ 是我们要寻找的参数（比如模型的权重、分子的构型）。</li>
<li>$E(x)$ 是我们的能量函数（在机器学习中称为损失函数 Loss Function）。我们的目标是让它越小越好。</li>
<li>$m$ 是理论上的全局最小值。</li>
</ul>
<p>在确定性优化（Deterministic Method）的世界里，我们通常像瞎子下山一样，沿着梯度的方向一步步挪动。这在简单的地形（凸函数）很有效，但在复杂的现实问题中，我们很容易被困在局部最优的“坑”里出不来。</p>
<h3 id="欢迎来到随机世界-welcome-to-stochastic-world">欢迎来到随机世界 (Welcome to Stochastic World)</h3>
<p>为了跳出局部最优的陷阱，我们使用一个关键的转换：<strong>我们将“寻找最小能量”的问题，转化为了“寻找最大概率”的问题。</strong></p>
<p>这种转换基于物理学中的 <strong><a href="https://zh.wikipedia.org/wiki/%E7%8E%BB%E5%B0%94%E5%85%B9%E6%9B%BC%E5%88%86%E5%B8%83">波尔兹曼分布（Boltzmann Distribution）</a></strong>。我们定义一个新的概率密度函数（PDF）：
</p>
$$f(x) = A e^{-E(x)}$$<p>其中，</p>
<ul>
<li>$f(x)$：概率密度函数，必须大于零</li>
<li>$A = \frac{1}{\int e^{-E(x)} \, dx}$是 <strong>归一化常数 (Normalization Constant)</strong>
<ul>
<li>在统计物理学中，$A$ 的倒数有一个大名鼎鼎的名字：配分函数 (Partition Function)，通常用符号 $Z$ 表示。$$Z = \frac{1}{A} = \int e^{-E(x)} \, dx$$</li>
</ul>
</li>
</ul>
<p>这里有一个极其巧妙的对应关系：</p>
<ul>
<li>$E(x)$ 越小（能量越低，是我们想要的）。</li>
<li>$e^{-E(x)}$ 就越大。</li>
<li>这意味着，$E(x)$ 的 <strong>最小值点</strong>，恰好对应了概率分布 $f(x)$ 的 <strong>峰值（最大值）</strong>。</li>
</ul>
<p>因此，原问题等价转化为：
</p>
$$\min E(x) \iff \max f(x)$$<h4 id="为什么要做这个转换">为什么要做这个转换？</h4>
<p>因为在随机世界里，我们不再执着于“每一步必须往低处走”，而是将解空间看作一个概率场。我们允许算法在一定概率下接受“坏结果”，正是这种机制让我们有机会跳出局部陷阱。</p>
<h4 id="引入温度参数">引入温度参数 $\lambda$</h4>
<p>为了控制搜索的过程，我们引入一个至关重要的参数 $\lambda$。于是这个概率密度函数就变成了：
</p>
$$f(x, \lambda) = A_\lambda e^{-\lambda E(x)}$$<p>
其中，$\lambda$ 大于零并与温度 $T$ 成反比：</p>
$$\lambda = \frac{1}{T} \ge 0$$<p>故而，$A$就变成了$A = \frac{1}{\int e^{-\lambda E(x)} \, dx}$</p>
<p>这个 $\lambda$（或 $T$）就像是一个调节器，决定了地形的“分辨率”或“反差”。我们可以通过调节它，来改变概率分布 $f(x, \lambda)$ 的形状。</p>
<h4 id="两个极限状态探索与锁定">两个极限状态：探索与锁定</h4>
<p>通过分析 $\lambda$ 的极限情况，我们能完美揭示随机优化的运作机制：</p>
<p><strong>状态 A：高温模式 (High Temperature)</strong></p>
<p>当 $\lambda \to 0$ 时（意味着 $T \to \infty$）：</p>
<ul>
<li>数学上：$-\lambda E(x) \to 0$，导致 $e^{-\lambda E(x)} \to 1$。</li>
<li>结果： $f(x, \lambda) \to \text{Constant}$。</li>
<li>物理图景： 此时概率分布在整个空间趋于均匀。无论 $E(x)$ 高低，所有点被采样的概率几乎相等。</li>
<li>意义： 这是全图探索 (Exploration) 阶段。算法像气体分子一样在空间中剧烈运动，能够轻松跨越任何高山和深谷，确保我们不会漏掉全局最优解所在的区域。</li>
</ul>
<p><strong>状态 B：低温模式 (Low Temperature)</strong></p>
<p>当 $\lambda \to \infty$ 时（意味着 $T \to 0$）：</p>
<ul>
<li>数学上：差异被无限放大。只要 $E(x)$ 稍微大一点点，$e^{-\lambda E(x)}$ 就会衰减得极快。</li>
<li>结果： 概率分布变成了一个尖峰（类似于狄拉克 $\delta$ 函数），仅在能量最低点 $m$ 处有值。</li>
<li>物理图景： 系统“冻结”了。</li>
<li>意义： 这是精细开发 (Exploitation) 阶段。算法锁定了当前区域的最低点，不再乱跑，从而获得高精度的解。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> FuncAnimation, PillowWriter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 1. 定义能量函数 (Energy Function) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 我们设计一个不对称的双势阱：</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 一个深坑（全局最优），一个浅坑（局部最优）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">energy_function</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># (x^2 - 1)^2 是标准的W形双井</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># + 0.3*x 用来倾斜它，使左边的坑比右边的深</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.3</span> <span style="color:#f92672">*</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 2. 准备数据 ---</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">2.5</span>, <span style="color:#ae81ff">2.5</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>E <span style="color:#f92672">=</span> energy_function(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 找到真正的全局最小值，用于绘图标记</span>
</span></span><span style="display:flex;"><span>min_idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmin(E)
</span></span><span style="display:flex;"><span>global_min_x <span style="color:#f92672">=</span> x[min_idx]
</span></span><span style="display:flex;"><span>global_min_y <span style="color:#f92672">=</span> E[min_idx]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 3. 设置绘图布局 ---</span>
</span></span><span style="display:flex;"><span>fig, (ax1, ax2) <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">10</span>), constrained_layout<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 上图：能量景观 E(x) - 永远不变</span>
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>plot(x, E, <span style="color:#e6db74">&#39;k-&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Energy $E(x)$&#39;</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>scatter(global_min_x, global_min_y, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gold&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, edgecolors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;k&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Global Min&#39;</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;The Problem: Energy Landscape $E(x)$&#34;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;Energy&#34;</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>ax1<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">2.5</span>, <span style="color:#ae81ff">2.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 下图：概率分布 f(x) - 随温度变化</span>
</span></span><span style="display:flex;"><span>line, <span style="color:#f92672">=</span> ax2<span style="color:#f92672">.</span>plot([], [], <span style="color:#e6db74">&#39;r-&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>)
</span></span><span style="display:flex;"><span>fill_poly <span style="color:#f92672">=</span> ax2<span style="color:#f92672">.</span>fill_between(x, np<span style="color:#f92672">.</span>zeros_like(x), np<span style="color:#f92672">.</span>zeros_like(x), color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">2.5</span>, <span style="color:#ae81ff">2.5</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;Probability Density $f(x)$&#34;</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>ax2<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 动态文本：显示当前的 Lambda 和 Temperature</span>
</span></span><span style="display:flex;"><span>text_info <span style="color:#f92672">=</span> ax2<span style="color:#f92672">.</span>text(<span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.9</span>, <span style="color:#e6db74">&#39;&#39;</span>, transform<span style="color:#f92672">=</span>ax2<span style="color:#f92672">.</span>transAxes, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>, 
</span></span><span style="display:flex;"><span>                     bbox<span style="color:#f92672">=</span>dict(facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;white&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 4. 动画逻辑 ---</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Lambda 从 0.1 (高温) 变到 10.0 (低温)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 我们用对数刻度，让高温阶段展示得慢一点，低温阶段快一点</span>
</span></span><span style="display:flex;"><span>lambdas <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>logspace(np<span style="color:#f92672">.</span>log10(<span style="color:#ae81ff">0.1</span>), np<span style="color:#f92672">.</span>log10(<span style="color:#ae81ff">15.0</span>), <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init</span>():
</span></span><span style="display:flex;"><span>    line<span style="color:#f92672">.</span>set_data([], [])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> line,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(frame_lambda):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> fill_poly
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># === 核心物理计算 ===</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. 计算玻尔兹曼因子 (未归一化概率)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># e^(-lambda * E)</span>
</span></span><span style="display:flex;"><span>    unnormalized_prob <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>frame_lambda <span style="color:#f92672">*</span> E)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. 计算归一化常数 A (Partition Function Z)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 利用梯形法则进行数值积分</span>
</span></span><span style="display:flex;"><span>    integral_Z <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>trapezoid(unnormalized_prob, x)
</span></span><span style="display:flex;"><span>    A <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> integral_Z
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. 得到最终概率分布 f(x)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># f(x) = A * e^(-lambda * E)</span>
</span></span><span style="display:flex;"><span>    pdf <span style="color:#f92672">=</span> A <span style="color:#f92672">*</span> unnormalized_prob
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># =================</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 更新曲线</span>
</span></span><span style="display:flex;"><span>    line<span style="color:#f92672">.</span>set_data(x, pdf)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 更新填充区域 (需要移除旧的，画新的)</span>
</span></span><span style="display:flex;"><span>    fill_poly<span style="color:#f92672">.</span>remove()
</span></span><span style="display:flex;"><span>    fill_poly <span style="color:#f92672">=</span> ax2<span style="color:#f92672">.</span>fill_between(x, <span style="color:#ae81ff">0</span>, pdf, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 动态调整Y轴高度 (因为尖峰会越来越高)</span>
</span></span><span style="display:flex;"><span>    ax2<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, np<span style="color:#f92672">.</span>max(pdf) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.2</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 更新标题和文字</span>
</span></span><span style="display:flex;"><span>    T <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> frame_lambda
</span></span><span style="display:flex;"><span>    ax2<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;The Stochastic Solution: Probability Distribution&#34;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
</span></span><span style="display:flex;"><span>    text_info<span style="color:#f92672">.</span>set_text(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;$\lambda$ = </span><span style="color:#e6db74">{</span>frame_lambda<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (Inverse Temp)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">$T$ = </span><span style="color:#e6db74">{</span>T<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (Temperature)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> line, fill_poly, text_info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 5. 生成并保存动画 ---</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;正在生成动画，请稍候...&#34;</span>)
</span></span><span style="display:flex;"><span>ani <span style="color:#f92672">=</span> FuncAnimation(fig, update, frames<span style="color:#f92672">=</span>lambdas, init_func<span style="color:#f92672">=</span>init, blit<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存为 GIF (需要安装 imagemagick 或使用 pillow)</span>
</span></span><span style="display:flex;"><span>ani<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#39;simulated_annealing.gif&#39;</span>, writer<span style="color:#f92672">=</span>PillowWriter(fps<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>))
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;✅ 动画已保存为 &#39;simulated_annealing.gif&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果在 Jupyter Notebook 中，可以直接解开下面这行注释来显示</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#plt.show()</span>
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/10_stochastic_optimization/simulated_annealing.gif" alt=""></p>
<p>这是一个经典的 <strong>“双势阱”（Double Well）</strong> 能量函数：</p>
<ul>
<li>它有一个全局最优解（深坑）。</li>
<li>还有一个局部最优解（浅坑）。</li>
</ul>
<p>在高温时，概率分布同时覆盖两个坑（由 $A$ 统管）；随着温度降低（$\lambda$ 变大），概率分布是如何逐渐“抛弃”局部最优，全部挤到全局最优那个“尖峰”里的。</p>
<h2 id="从-mcmc-到优化退火的艺术-the-bridge-simulated-annealing">从 MCMC 到优化——退火的艺术 (The Bridge: Simulated Annealing)</h2>
<p><strong>模拟退火</strong> (Simulated Annealing，SA) 是一种通用概率优化算法。</p>
<ul>
<li>名字来源：来自于冶金学中的“退火”工艺。
<ul>
<li>物理退火：把金属加热到很高温（原子乱跑），然后慢慢冷却。这样原子有足够的时间找到能量最低的晶体结构，金属就会变得坚硬且无缺陷。</li>
<li>算法退火：把参数 $x$ 扔到很高温（随机乱跑），然后慢慢降低 $T$。这样 $x$ 有足够的时间跳出局部最优，最终落入全局最优。</li>
</ul>
</li>
<li>核心特征：它是一种 <strong>“允许后悔”</strong> 的算法。也就是在搜索过程中，它不仅接受“好”的解，也会以一定概率接受“坏”的解（为了跳出坑）。</li>
</ul>
<p>之前提到的的 Steepest Descent (梯度下降) 是个“势利眼”，只往低处走。如果地形是像 鸡蛋托盘 那样的（无数个小坑），梯度下降掉进第一个坑就死在那里了。</p>
<p>而 SA 的优势在于：</p>
<ul>
<li>全局搜索能力：因为它在高温时接受“坏解”，所以它能爬坡翻越山岭，去探索未知的领域。</li>
<li>不依赖梯度：它不需要求导（$f(x)$ 甚至可以是不连续的）。</li>
<li>万金油：不管函数长多丑，只要你能算出函数值，它就能跑。
<ul>
<li>无论$f(x)$是否凸，都能应用</li>
</ul>
</li>
</ul>
<h3 id="算法流程">算法流程</h3>
<ol>
<li>定义转换 (Transform): 我们不直接去解 $\min E(x)$，而是构建一个概率分布：$$f(x) \propto e^{-E(x)/T}$$
<ul>
<li>这里 $\lambda = 1/T$</li>
<li>直觉：把“地形高度”变成“概率密度”。坑越深（$E$ 越小），概率越大；山越高（$E$ 越大），概率越小。</li>
</ul>
</li>
<li>高温探索 (Explore) (高温采样):
<ul>
<li>操作：设置一个很高的初始温度 $T_{max}$。</li>
<li>现象：
<ul>
<li>当 $T$ 很大时，$E(x)/T \approx 0$，所以 $e^0 \approx 1$。</li>
<li>整个概率分布是扁平的（Flat），接近均衡分布。</li>
<li>这时候你丢下去的“粒子”（采样点）会满地图乱跑（因为去到哪里的概率基本一致），可以轻易翻过高山，跳出局部陷阱。</li>
</ul>
</li>
</ul>
</li>
<li>降温过程 (Cooling / Annealing): 慢慢降低温度 $T$（增大 $\lambda$）。
<ul>
<li>操作：按照一个时间表逐渐降低 $T$。
<ul>
<li>例如：$T(t) \sim \frac{c}{\log(1+t)}$
<ul>
<li>这是一个非常著名的理论公式（Geman &amp; Geman, 1984），保证能找到全局最优，但它降温极慢。</li>
</ul>
</li>
<li>实际工程中，我们通常用更快的方法，比如 $T_{new} = T_{old} \times 0.99$。</li>
</ul>
</li>
<li>现象：随着温度降低，分布图开始“变形”。原本平坦的地方变低，原本深坑的地方变得更深（概率峰值更尖）。</li>
</ul>
</li>
<li>低温开发 (Exploit) ：持续采样 (Loop till Low T)
<ul>
<li>操作：继续循环“采样 -&gt; 降温 -&gt; 采样”，直到温度 $T$ 非常低
<ul>
<li>⚠️ 但不能等于 0，否则除数无意义。</li>
</ul>
</li>
<li>现象：此时概率分布已经变成了一根针（Dirac Delta）。粒子基本被“锁死”在那个最深的坑里，很难再跳出来了。</li>
</ul>
</li>
<li>均值估算 (Sample &amp; Average)
<ul>
<li>操作：在低温阶段采集一堆样本 $x_1, x_2, ..., x_n$，算出它们的平均值。</li>
<li>结论：这个平均值 $\bar{x}$ 就是我们估计的全局最小值位置 $x_{min}$。</li>
</ul>
</li>
</ol>
<blockquote>
<p>注意：</p>
<ul>
<li>刚开始 $T$ 很大，$\Delta E / T$ 很小，$P$ 接近 1。算法几乎接受所有坏解（疯狂乱跑）。</li>
<li>后来 $T$ 很小，$\Delta E / T$ 很大，$P$ 接近 0。算法几乎拒绝所有坏解（变成了梯度下降）。</li>
</ul></blockquote>
<h4 id="示例">示例</h4>
<h5 id="一维">一维</h5>
<p>这里使用一个有多处陷阱的函数来展示“温度控制”和“Metropolis采样”的结合：$E(x) = x^2 - \cos(\pi x)$。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 1. 目标函数 (Energy Function) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">E</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>cos(np<span style="color:#f92672">.</span>pi <span style="color:#f92672">*</span> x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 2. 采样核心: Metropolis 准则 ---</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 这是一个&#34;抽样机&#34;，负责根据当前温度 T 生成样本</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_one_step</span>(x_curr, T):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># a. 提议 (Propose): 随机往左或往右迈一步</span>
</span></span><span style="display:flex;"><span>    x_next <span style="color:#f92672">=</span> x_curr <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># b. 能量差 (Delta E)</span>
</span></span><span style="display:flex;"><span>    dE <span style="color:#f92672">=</span> E(x_next) <span style="color:#f92672">-</span> E(x_curr)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># c. 接受/拒绝 (Accept/Reject)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 核心逻辑：如果新位置能量低，一定去；如果高，有一定概率去（取决于温度T）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> dE <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>dE <span style="color:#f92672">/</span> T):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x_next <span style="color:#75715e"># 接受移动</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x_curr <span style="color:#75715e"># 拒绝移动，待在原地</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 主流程: 对应你的笔记步骤 ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_stochastic_optimization</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 初始化</span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2.5</span>       <span style="color:#75715e"># 起点 (故意选在一个较远的局部最优附近)</span>
</span></span><span style="display:flex;"><span>    T <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>       <span style="color:#75715e"># T_max (高温)</span>
</span></span><span style="display:flex;"><span>    T_min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>   <span style="color:#75715e"># T_min (低温截止)</span>
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.99</span>   <span style="color:#75715e"># 降温系数 (实际常用的降温方式)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> []      <span style="color:#75715e"># 记录走过的路径</span>
</span></span><span style="display:flex;"><span>    temps <span style="color:#f92672">=</span> []     <span style="color:#75715e"># 记录温度变化</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Step&#39;</span><span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;6</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Temp&#39;</span><span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;8</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Current x&#39;</span><span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;10</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;Action&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">45</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    step <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 流程 4: 直到温度非常低 (Till a very low T)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> T <span style="color:#f92672">&gt;</span> T_min:
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 流程 2 &amp; 3: 采样 并 降温</span>
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> sample_one_step(x, T)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 记录数据</span>
</span></span><span style="display:flex;"><span>        path<span style="color:#f92672">.</span>append(x)
</span></span><span style="display:flex;"><span>        temps<span style="color:#f92672">.</span>append(T)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 打印中间过程 (每隔200步)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> step <span style="color:#f92672">%</span> <span style="color:#ae81ff">200</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            status <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Explore 🎲&#34;</span> <span style="color:#66d9ef">if</span> T <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1.0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;Exploit 🎯&#34;</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>step<span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;6</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span>T<span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;8.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span>x<span style="color:#e6db74">:</span><span style="color:#e6db74">&lt;10.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">{</span>status<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 降温 (Decrease T)</span>
</span></span><span style="display:flex;"><span>        T <span style="color:#f92672">=</span> T <span style="color:#f92672">*</span> alpha 
</span></span><span style="display:flex;"><span>        step <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 流程 5: 统计均值 (Avg Samples)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 取最后 100 个低温样本的均值</span>
</span></span><span style="display:flex;"><span>    final_samples <span style="color:#f92672">=</span> path[<span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>:]
</span></span><span style="display:flex;"><span>    estimated_min <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(final_samples)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">45</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;✅ 最终估算结果: x = </span><span style="color:#e6db74">{</span>estimated_min<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;✅ 真实最小值: x = 0.0000 (大概率重合)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> path, temps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 运行并可视化 ---</span>
</span></span><span style="display:flex;"><span>path, temps <span style="color:#f92672">=</span> run_stochastic_optimization()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 画图展示粒子是如何&#34;从乱跑&#34;到&#34;归位&#34;的</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(path, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Particle Path&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Iterations (Time)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Position x&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Algorithm Flow: From Exploration (High T) to Exploitation (Low T)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axhline(<span style="color:#ae81ff">0</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Global Min (x=0)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Step   | Temp     | Current x  | Action
---------------------------------------------
0      | 10.0000  | -2.5000    | Explore 🎲
200    | 1.3398   | 2.2058     | Explore 🎲
400    | 0.1795   | 0.2473     | Exploit 🎯
600    | 0.0241   | -0.0782    | Exploit 🎯
---------------------------------------------
✅ 最终估算结果: x = -0.0115
✅ 真实最小值: x = 0.0000 (大概率重合)
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/10_stochastic_optimization/10_mcmc_stochastic_optimization_5_1.png" alt="png"></p>
<p>上面生成的图</p>
<ul>
<li>前半段 (左边)：曲线震荡非常剧烈。这就是高温探索，粒子根本不在乎那里是坑，它在整个区域乱跳。</li>
<li>后半段 (右边)：曲线变成了一条直线。这就是低温锁定，粒子被困在了 $x=0$ 附近。</li>
<li>结果：最后我们把后半段那些“静止”的点取平均，就得到了精准的最小值。</li>
</ul>
<h5 id="n-维">N 维</h5>
<p>为了演示 N 维的挑战性，我们选用著名的 Rastrigin 函数。这是一个“恶名昭彰”的测试函数：它就像一个布满鸡蛋托盘的大碗，宏观上看是个碗（有全局最优），但微观上到处都是坑（局部最优）。</p>
<p>N 维 Rastrigin 函数定义公式如下（$A=10$）：
</p>
$$f(\mathbf{x}) = 10n + \sum_{i=1}^n (x_i^2 - 10 \cos(2\pi x_i))$$<p>
它的全局最小值在原点 $\mathbf{x} = [0, 0, \dots, 0]$，函数值为 0。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 1. 定义 N 维目标函数 (Rastrigin Function) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rastrigin</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># x 是一个向量 (numpy array)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># A * n + sum(x^2 - A * cos(2*pi*x))</span>
</span></span><span style="display:flex;"><span>    A <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> len(x)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> A <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>sum(x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> A <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>cos(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>pi <span style="color:#f92672">*</span> x))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 2. N 维邻域生成 (Proposal) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_neighbor</span>(x_curr, step_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 关键点：我们在 N 维空间中随机游走</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># size=len(x_curr) 保证了生成的扰动向量和 x 维度一致</span>
</span></span><span style="display:flex;"><span>    perturbation <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span>step_size, step_size, size<span style="color:#f92672">=</span>len(x_curr))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x_curr <span style="color:#f92672">+</span> perturbation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 3. 模拟退火主程序 ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">simulated_annealing_nd</span>(n_dim<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, n_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">2000</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 初始化：在一个范围内随机生成起点 (-5.12 到 5.12 是 Rastrigin 的标准定义域)</span>
</span></span><span style="display:flex;"><span>    current_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span><span style="color:#ae81ff">5.12</span>, <span style="color:#ae81ff">5.12</span>, size<span style="color:#f92672">=</span>n_dim)
</span></span><span style="display:flex;"><span>    current_E <span style="color:#f92672">=</span> rastrigin(current_x)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 记录最佳解 (Best So Far)，防止跑丢了</span>
</span></span><span style="display:flex;"><span>    best_x <span style="color:#f92672">=</span> current_x<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>    best_E <span style="color:#f92672">=</span> current_E
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 温度设置</span>
</span></span><span style="display:flex;"><span>    T <span style="color:#f92672">=</span> <span style="color:#ae81ff">100.0</span>
</span></span><span style="display:flex;"><span>    T_min <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e-4</span>
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.99</span>  <span style="color:#75715e"># 降温系数</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> [current_x] <span style="color:#75715e"># 记录路径用于画图</span>
</span></span><span style="display:flex;"><span>    energy_history <span style="color:#f92672">=</span> [current_E]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;开始 </span><span style="color:#e6db74">{</span>n_dim<span style="color:#e6db74">}</span><span style="color:#e6db74"> 维优化...&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;起点: </span><span style="color:#e6db74">{</span>np<span style="color:#f92672">.</span>round(current_x, <span style="color:#ae81ff">2</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">, Energy: </span><span style="color:#e6db74">{</span>current_E<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    iter_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> T <span style="color:#f92672">&gt;</span> T_min <span style="color:#f92672">and</span> iter_count <span style="color:#f92672">&lt;</span> n_iter:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. 提议新位置 (向量加法)</span>
</span></span><span style="display:flex;"><span>        new_x <span style="color:#f92672">=</span> get_neighbor(current_x)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 防止跑出定义域 (Rastrigin 通常限制在 [-5.12, 5.12])</span>
</span></span><span style="display:flex;"><span>        new_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(new_x, <span style="color:#f92672">-</span><span style="color:#ae81ff">5.12</span>, <span style="color:#ae81ff">5.12</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        new_E <span style="color:#f92672">=</span> rastrigin(new_x)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. 计算能量差</span>
</span></span><span style="display:flex;"><span>        dE <span style="color:#f92672">=</span> new_E <span style="color:#f92672">-</span> current_E
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 3. Metropolis 准则 (和 1 维一模一样)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> dE <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>dE <span style="color:#f92672">/</span> T):
</span></span><span style="display:flex;"><span>            current_x <span style="color:#f92672">=</span> new_x
</span></span><span style="display:flex;"><span>            current_E <span style="color:#f92672">=</span> new_E
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 更新历史最佳</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> current_E <span style="color:#f92672">&lt;</span> best_E:
</span></span><span style="display:flex;"><span>                best_x <span style="color:#f92672">=</span> current_x<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>                best_E <span style="color:#f92672">=</span> current_E
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        path<span style="color:#f92672">.</span>append(current_x)
</span></span><span style="display:flex;"><span>        energy_history<span style="color:#f92672">.</span>append(current_E)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        T <span style="color:#f92672">*=</span> alpha
</span></span><span style="display:flex;"><span>        iter_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;结束. 最终位置: </span><span style="color:#e6db74">{</span>np<span style="color:#f92672">.</span>round(best_x, <span style="color:#ae81ff">4</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;最终能量: </span><span style="color:#e6db74">{</span>best_E<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> (理论最优是 0.0)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>array(path), energy_history, best_x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 运行: 这里我们设为 2 维以便画图，但算法支持 N 维 ---</span>
</span></span><span style="display:flex;"><span>DIMENSION <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>path, energies, final_sol <span style="color:#f92672">=</span> simulated_annealing_nd(n_dim<span style="color:#f92672">=</span>DIMENSION, n_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 4. 可视化 (仅适用于 2D) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> DIMENSION <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 子图 1: 地形图和路径</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    x_grid <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">5.12</span>, <span style="color:#ae81ff">5.12</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>    y_grid <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">5.12</span>, <span style="color:#ae81ff">5.12</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>    X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x_grid, y_grid)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算网格上每个点的 Z 值</span>
</span></span><span style="display:flex;"><span>    Z <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros_like(X)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]):
</span></span><span style="display:flex;"><span>            Z[i,j] <span style="color:#f92672">=</span> rastrigin(np<span style="color:#f92672">.</span>array([X[i,j], Y[i,j]]))
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>contourf(X, Y, Z, levels<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;viridis&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>colorbar(label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Energy&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 画路径：起点是白色，终点是红色</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(path[:, <span style="color:#ae81ff">0</span>], path[:, <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;w-&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>scatter(path[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], path[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;white&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Start&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>scatter(final_sol[<span style="color:#ae81ff">0</span>], final_sol[<span style="color:#ae81ff">1</span>], c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;End&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;2D Rastrigin Optimization Path</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">(Escaping many local minima)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 子图 2: 能量下降曲线</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(energies)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>yscale(<span style="color:#e6db74">&#39;log&#39;</span>) <span style="color:#75715e"># 用对数坐标看，因为后期下降很微小</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Iteration&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Energy (Log Scale)&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Energy Minimization Process&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>, which<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;both&#34;</span>, ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>开始 2 维优化...
起点: [-0.04  4.85], Energy: 28.08
结束. 最终位置: [1.0266 2.0164]
最终能量: 5.312337 (理论最优是 0.0)
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/10_stochastic_optimization/10_mcmc_stochastic_optimization_8_1.png" alt="png"></p>
<ol>
<li>代码中的关键行：<code>perturbation = np.random.uniform(-step_size, step_size, size=len(x_curr))</code>这就是 N 维扩展的核心。我们一次性生成了一个 N 维的随机向量。
<ul>
<li>在数学上，这相当于在 N 维超球体（或超立方体）中随机选一个方向跳出去。</li>
</ul>
</li>
<li>Rastrigin 的地形 (左图)：你会看到有很多深蓝色的圈圈，每一个都是一个局部陷阱。
<ul>
<li>如果是 <strong>梯度下降(Gradient Descent)</strong>：它大概率会掉进离起点最近的那个蓝色圈圈里，然后死在那里。</li>
<li><strong>模拟退火</strong>：你会看到白色的路径在图上乱窜（特别是前期）。它会跳进一个坑，跳出来，再跳进另一个坑，直到温度降低，被“吸”进最中间那个最深的坑（红色五角星）。</li>
</ul>
</li>
<li>Pincus Theorem 在 N 维的意义：即使是 N 维，Pincus Theorem 依然成立：$$\lim_{\lambda \to \infty} \frac{\int_{\mathbb{R}^N} \mathbf{x} e^{-\lambda E(\mathbf{x})} d\mathbf{x}}{\int_{\mathbb{R}^N} e^{-\lambda E(\mathbf{x})} d\mathbf{x}} = \mathbf{x}_{min}$$
<ul>
<li>这说明无论维度多高，只要我们能通过降温过程正确地从那个 N 维概率分布中采样，均值（或最后停留的位置）依然是全局最优。</li>
</ul>
</li>
</ol>
<h3 id="证明退火算法的正确性pincus-theorem">证明退火算法的正确性：Pincus Theorem</h3>
<blockquote>
<p>Pincus Theorem 为模拟退火算法提供了收敛性的理论保证（Theoretical Guarantee）。
Pincus Theorem 证明了“如果温度降到 0，这一堆样本的平均值就是全局最优解”； 模拟退火算法则负责“如何安全、平稳地把温度降到 0，而不让样本卡在半路”。</p></blockquote>
<h4 id="pincus-theorem-1968年由-mark-pincus-提出">Pincus Theorem (1968年由 Mark Pincus 提出)</h4>
<p>Pincus Theorem 是一个数学桥梁，它证明了：当我们把温度降到极低（$\lambda \to \infty$）时，一个函数的“加权平均值”（期望），就会收敛于这个函数的“全局最小值点”。</p>
<p>它把一个 <strong>“寻找极值的问题”（Optimization）变成了一个“计算积分的问题”</strong>（Integration）。</p>
<p>假设你有一个目标函数 $f(x)$，定义域为 $D$，你想要找到它的全局最小值点 $x^*$。Pincus Theorem 指出：
</p>
$$x^* = \lim_{\lambda \to \infty} \frac{\int_D x \cdot e^{-\lambda f(x)} \, dx}{\int_D e^{-\lambda f(x)} \, dx}$$<p>
或者写成统计学的期望形式：
</p>
$$x^* = \lim_{\lambda \to \infty} \mathbb{E}_{\lambda}[x]$$<p>
其中 $\lambda$ 是一个参数（对应物理中的 $1/T$）。</p>
<h4 id="证明">证明</h4>
<p>我们的目标是求这个分式的极限：
</p>
$$\langle x \rangle_\lambda = \frac{\int x \cdot e^{-\lambda E(x)} \, dx}{\int e^{-\lambda E(x)} \, dx}$$<p>
我们要证明：当 $\lambda \to \infty$ 时，这个结果等于 $x^*$（即 $E(x)$ 的全局最小值点）。</p>
<p>关键技巧：既然 $\lambda$ 很大，为了看清谁在主导，我们把分子和分母同时提取出那个“最大的项”。</p>
<p><strong>第一步：提取“最大公约数”</strong></p>
<p>假设 $x^*$ 是唯一的全局最小值点。那么对于任何 $x \neq x^*$，都有 $E(x) > E(x^*)$。</p>
<p>我们在分子和分母中，同时提出 $e^{-\lambda E(x^*)}$ 这一项：</p>
<ul>
<li>分母：$$\int e^{-\lambda E(x)} \, dx = \int e^{-\lambda [E(x^*) + (E(x) - E(x^*))]} \, dx = e^{-\lambda E(x^*)} \int e^{-\lambda (E(x) - E(x^*))} \, dx$$</li>
<li>分子：$$\int x e^{-\lambda E(x)} \, dx = e^{-\lambda E(x^*)} \int x \cdot e^{-\lambda (E(x) - E(x^*))} \, dx$$</li>
</ul>
<p>把它代回原式，你会发现 $e^{-\lambda E(x^*)}$ 在分子分母中约分消掉了！
</p>
$$\langle x \rangle_\lambda = \frac{\int x \cdot e^{-\lambda (E(x) - E(x^*))} \, dx}{\int e^{-\lambda (E(x) - E(x^*))} \, dx}$$<p>这一步非常关键。现在积分里的指数变成了 $-\lambda (E(x) - E(x^*))$。注意括号里的 $\Delta E = E(x) - E(x^*)$ 永远是大于等于 0 的。</p>
<p><strong>第二步：切分积分区域 (邻域 vs. 远方)</strong></p>
<p>现在我们把积分区域分成两部分：</p>
<ol>
<li>极小值附近的小邻域 $U_\epsilon$： $|x - x^*| < \epsilon$（这里 $\epsilon$ 是个很小的数）。</li>
<li>其余区域 $R$：远离最小值的地方。</li>
</ol>
<p>让我们看看当 $\lambda \to \infty$ 时，这两部分分别发生了什么。</p>
<ul>
<li>分析“其余区域 R”（远离最小值的地方）：在这些地方，$\Delta E = E(x) - E(x^*)$ 肯定有一个大于 0 的最小值，设为 $\delta > 0$。那么指数项 $e^{-\lambda \Delta E} \le e^{-\lambda \delta}$。当 $\lambda \to \infty$ 时，这一项会以指数级速度衰减到 0。这意味着：在极限情况下，所有远离 $x^*$ 的区域，对积分的贡献都可以忽略不计。</li>
<li>分析“邻域 $U_\epsilon$”（极小值附近）：在这个微小的区域里，$\Delta E \approx 0$，所以 $e^{-\lambda \Delta E} \approx 1$（或者衰减得很慢）。整个积分的值，完全由这一小块区域主导。</li>
</ul>
<p><strong>第三步：局部泰勒展开 (Taylor Expansion)</strong></p>
<p>为了更精确，我们在 $x^*$ 附近对 $E(x)$ 做泰勒展开：
</p>
$$E(x) \approx E(x^*) + E'(x^*)(x-x^*) + \frac{1}{2}E''(x^*)(x-x^*)^2$$<p>因为 $x^*$ 是极值点，一阶导数 $E'(x^*) = 0$。且假设它是极小值，二阶导数 $E''(x^*) = k > 0$。所以：
</p>
$$E(x) - E(x^*) \approx \frac{1}{2} k (x-x^*)^2$$<p>
代入我们的积分式（只看邻域部分）：
</p>
$$\text{分母} \approx \int_{x^*-\epsilon}^{x^*+\epsilon} e^{-\lambda \frac{1}{2} k (x-x^*)^2} \, dx$$<p>看！这变成了一个标准的高斯积分 (Gaussian Integral)。如果你还记得高斯积分公式 $\int e^{-ax^2} dx = \sqrt{\frac{\pi}{a}}$，那这里 $a = \frac{\lambda k}{2}$。</p>
<p>所以分母大约是：
</p>
$$\text{分母} \approx \sqrt{\frac{2\pi}{\lambda k}}$$<p>同理，分子由两部分组成：$x$ 和高斯分布。因为积分范围非常小（在 $x^*$ 附近），我们可以把 $x$ 近似看作常数 $x^*$ 提出来：
</p>
$$
\text{分子} \approx \int_{x^*-\epsilon}^{x^*+\epsilon} x \cdot e^{-\lambda \frac{1}{2} k (x-x^*)^2} \, dx \approx x^* \cdot \underbrace{\int e^{-\dots} dx}_{\text{分母的积分}}
$$<p>
</p>
$$
\text{分子} \approx x^* \cdot \sqrt{\frac{2\pi}{\lambda k}}
$$<p><strong>第四步：见证奇迹的约分</strong></p>
<p>现在我们把分子分母重新放在一起：
</p>
$$\lim_{\lambda \to \infty} \langle x \rangle_\lambda \approx \frac{x^* \cdot \sqrt{\frac{2\pi}{\lambda k}}}{\sqrt{\frac{2\pi}{\lambda k}}}$$<p>
那堆复杂的根号、$\pi$、二阶导数 $k$、甚至 $\lambda$ 本身，全部在分子分母中抵消了！最后剩下的只有：
</p>
$$= x^*$$

        
          <div class="blog-tags">
            
              <a href="http://localhost:1313/zh-cn/tags/%E9%9A%8F%E6%9C%BA%E4%BC%98%E5%8C%96/">随机优化</a>&nbsp;
            
              <a href="http://localhost:1313/zh-cn/tags/%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB/">模拟退火</a>&nbsp;
            
              <a href="http://localhost:1313/zh-cn/tags/%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/">优化算法</a>&nbsp;
            
              <a href="http://localhost:1313/zh-cn/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a>&nbsp;
            
              <a href="http://localhost:1313/zh-cn/tags/pincus%E5%AE%9A%E7%90%86/">Pincus定理</a>&nbsp;
            
              <a href="http://localhost:1313/zh-cn/tags/python%E5%AE%9E%E7%8E%B0/">Python实现</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
  <ul class="share">
    
    <li>
      <a
        href="//twitter.com/share?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2fstochastic-optimization%2f&amp;text=%e9%9a%8f%e6%9c%ba%e4%bc%98%e5%8c%96%e7%ae%97%e6%b3%95%e8%af%a6%e8%a7%a3%ef%bc%9a%e6%a8%a1%e6%8b%9f%e9%80%80%e7%81%ab%e4%b8%8e%20Pincus%20%e5%ae%9a%e7%90%86&amp;via="
        target="_blank"
        title="Share on Twitter"
        class="share-btn twitter"
      >
        <i class="fab fa-twitter"></i>
      </a>
    </li>

    
    <li>
      <a
        href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2fstochastic-optimization%2f"
        target="_blank"
        title="Share on Facebook"
        class="share-btn facebook"
      >
        <i class="fab fa-facebook"></i>
      </a>
    </li>

    
    <li>
      <a
        href="//service.weibo.com/share/share.php?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2fstochastic-optimization%2f&amp;appkey=&amp;title=%e9%9a%8f%e6%9c%ba%e4%bc%98%e5%8c%96%e7%ae%97%e6%b3%95%e8%af%a6%e8%a7%a3%ef%bc%9a%e6%a8%a1%e6%8b%9f%e9%80%80%e7%81%ab%e4%b8%8e%20Pincus%20%e5%ae%9a%e7%90%86&amp;pic="
        target="_blank"
        title="Share on Weibo"
        class="share-btn weibo"
      >
        <i class="fab fa-weibo"></i>
      </a>
    </li>

    
    <li>
      <a
        href="javascript:void(0);"
        onclick="openWechatModal('http:\/\/localhost:1313\/zh-cn\/post\/mcmc-statics\/stochastic-optimization\/')"
        title="Share on WeChat"
        class="share-btn wechat"
      >
        <i class="fab fa-weixin"></i>
      </a>
    </li>

    
    <li>
      <a
        href="//www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2fstochastic-optimization%2f&amp;title=%e9%9a%8f%e6%9c%ba%e4%bc%98%e5%8c%96%e7%ae%97%e6%b3%95%e8%af%a6%e8%a7%a3%ef%bc%9a%e6%a8%a1%e6%8b%9f%e9%80%80%e7%81%ab%e4%b8%8e%20Pincus%20%e5%ae%9a%e7%90%86"
        target="_blank"
        title="Share on LinkedIn"
        class="share-btn linkedin"
      >
        <i class="fab fa-linkedin"></i>
      </a>
    </li>

    
    <li>
      <a
        href="javascript:void(0);"
        onclick="copyToClipboard('http:\/\/localhost:1313\/zh-cn\/post\/mcmc-statics\/stochastic-optimization\/', '随机优化算法详解：模拟退火与 Pincus 定理')"
        title="Copy Link"
        class="share-btn copy-link"
      >
        <i class="fas fa-link"></i>
      </a>
    </li>
  </ul>
</div>


<div id="wechat-modal" class="wechat-modal">
  <div class="wechat-modal-content">
    <span class="wechat-close" onclick="closeWechatModal()">&times;</span>
    <h4>
      Scan to Share <br />
      微信扫一扫分享
    </h4>
    <div id="qrcode" class="qrcode-container"></div>
  </div>
</div>

<script type="text/javascript">
  function copyToClipboard(url, title) {
    navigator.clipboard.writeText(url).then(
      function () {
        
        var existingToast = document.getElementById("share-toast");
        if (existingToast) {
          existingToast.remove();
        }

        var toast = document.createElement("div");
        toast.id = "share-toast";
        toast.innerText = "Link copied to clipboard!";
        toast.style.position = "fixed";
        toast.style.bottom = "20px";
        toast.style.left = "50%";
        toast.style.transform = "translateX(-50%)";
        toast.style.backgroundColor = "rgba(0,0,0,0.8)";
        toast.style.color = "#fff";
        toast.style.padding = "10px 20px";
        toast.style.borderRadius = "5px";
        toast.style.zIndex = "10000";
        toast.style.opacity = "0";
        toast.style.transition = "opacity 0.5s ease-in-out";

        document.body.appendChild(toast);

        
        void toast.offsetWidth;

        toast.style.opacity = "1";

        setTimeout(function () {
          toast.style.opacity = "0";
          setTimeout(function () {
            if (toast.parentNode) toast.parentNode.removeChild(toast);
          }, 500);
        }, 3000);
      },
      function (err) {
        console.error("Could not copy text: ", err);
      },
    );
  }

  function openWechatModal(url) {
    var modal = document.getElementById("wechat-modal");
    modal.style.display = "flex";
    var qrcodeContainer = document.getElementById("qrcode");
    qrcodeContainer.innerHTML = "";
    var img = document.createElement("img");
    img.src =
      "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" +
      encodeURIComponent(url);
    img.style.width = "200px";
    img.style.height = "200px";
    qrcodeContainer.appendChild(img);
  }

  function closeWechatModal() {
    var modal = document.getElementById("wechat-modal");
    modal.style.display = "none";
  }

  
  window.onclick = function (event) {
    var modal = document.getElementById("wechat-modal");
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };
</script>


              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">也可以看看</h4>
                  <ul>
                
                
                    <li><a href="/zh-cn/post/mcmc-statics/deterministic-optimization/">确定性优化算法详解：梯度下降的数学本质与代码实战</a></li>
                
                    <li><a href="/zh-cn/post/mcmc-statics/gibbs-sampling/">Gibbs 采样详解：分而治之的降维智慧</a></li>
                
                    <li><a href="/zh-cn/post/mcmc-statics/metropolis-hastings/">Metropolis-Hastings 算法：打破对称性的束缚</a></li>
                
                    <li><a href="/zh-cn/post/mcmc-statics/metropolis/">Metropolis 算法详解：从原理到 Python 实现</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://localhost:1313/zh-cn/post/mcmc-statics/deterministic-optimization/" data-toggle="tooltip" data-placement="top" title="确定性优化算法详解：梯度下降的数学本质与代码实战">&larr; 前一篇</a>
            </li>
          
          
        </ul>
      


      

    </div>
    
    
    <div class="col-lg-3 visible-lg-block">
      
      
      <div class="sidebar-toc">
        <h2 class="sidebar-toc-title">目录</h2>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#随机优化stochastic-optimization">随机优化（Stochastic Optimization）</a>
      <ul>
        <li><a href="#从确定性优化到随机优化">从确定性优化到随机优化</a>
          <ul>
            <li><a href="#问题的定义从确定性世界出发">问题的定义：从确定性世界出发</a></li>
            <li><a href="#欢迎来到随机世界-welcome-to-stochastic-world">欢迎来到随机世界 (Welcome to Stochastic World)</a></li>
          </ul>
        </li>
        <li><a href="#从-mcmc-到优化退火的艺术-the-bridge-simulated-annealing">从 MCMC 到优化——退火的艺术 (The Bridge: Simulated Annealing)</a>
          <ul>
            <li><a href="#算法流程">算法流程</a></li>
            <li><a href="#证明退火算法的正确性pincus-theorem">证明退火算法的正确性：Pincus Theorem</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
      
    </div>
    
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:ele.qiong@gmail.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/ictar" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/qiongjie-xu" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://www.xuqiongjie.com">Qiongjie.X</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2026
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://localhost:1313/zh-cn/">琼呀</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="https://gohugo.io">Hugo v0.147.4</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 移植自 <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="http://localhost:1313/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="http://localhost:1313/js/load-photoswipe.js"></script>









<script src="http://localhost:1313/js/toc-enhancements.js"></script>


    
  </body>
</html>

