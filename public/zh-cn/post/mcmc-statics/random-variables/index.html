

<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>随机变量和采样 - </title>

  <meta name="description" content="了解随机变量、概率密度函数、期望等概念、常见采样方法以及简单分布（均匀、正态、指数）的采样方式">
  <meta name="author" content="Qiongjie.X"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "琼呀",
    
    "url": "http:\/\/localhost:1313\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/localhost:1313\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/localhost:1313\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/localhost:1313\/zh-cn\/post\/mcmc-statics\/random-variables\/",
          "name": "随机变量和采样"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Qiongjie.X"
  },
  "headline": "随机变量和采样",
  "description" : "了解随机变量、概率密度函数、期望等概念、常见采样方法以及简单分布（均匀、正态、指数）的采样方式",
  "inLanguage" : "zh-cn",
  "wordCount":  1487 ,
  "datePublished" : "2025-08-02T00:00:00\u002b00:00",
  "dateModified" : "2025-08-02T00:00:00\u002b00:00",
  "image" : "http:\/\/localhost:1313\/img\/avatar-icon.png",
  "keywords" : [ "随机变量, 采样, 随机试验, 课程笔记, 数学, python" ],
  "mainEntityOfPage" : "http:\/\/localhost:1313\/zh-cn\/post\/mcmc-statics\/random-variables\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/localhost:1313\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/localhost:1313\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="随机变量和采样" />
<meta property="og:description" content="了解随机变量、概率密度函数、期望等概念、常见采样方法以及简单分布（均匀、正态、指数）的采样方式">
<meta property="og:image" content="http://localhost:1313/img/avatar-icon.png" />
<meta property="og:url" content="http://localhost:1313/zh-cn/post/mcmc-statics/random-variables/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="琼呀" />

  <meta name="twitter:title" content="随机变量和采样" />
  <meta name="twitter:description" content="了解随机变量、概率密度函数、期望等概念、常见采样方法以及简单分布（均匀、正态、指数）的采样方式">
  <meta name="twitter:image" content="http://localhost:1313/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='http://localhost:1313/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.147.4">
  <link rel="alternate" href="http://localhost:1313/zh-cn/index.xml" type="application/rss+xml" title="琼呀"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="http://localhost:1313/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://localhost:1313/css/syntax.css" /><link rel="stylesheet" href="http://localhost:1313/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  crossorigin="anonymous"
/>


<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  crossorigin="anonymous"
></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body, {
    delimiters: [
      {left: '$$', right: '$$', display: true},
      {left: '$', right: '$', display: false}
    ]
  });"></script>

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost:1313/zh-cn/">琼呀</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" role="button" tabindex="0">文章</a>
              <div class="navlinks-children">
                
                  <a href="/zh-cn/post/python-geodata">用 Python 玩转遥感数据</a>
                
                  <a href="/zh-cn/post/mcmc-statics">蒙特卡洛-马尔可夫链统计方法</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="项目" href="/zh-cn/">项目</a>
            </li>
          
        
          
            <li>
              <a title="笔记" href="/zh-cn/notes">笔记</a>
            </li>
          
        
          
            <li>
              <a title="标签" href="/zh-cn/tags">标签</a>
            </li>
          
        
          
            <li>
              <a title="关于我" href="/zh-cn/page/about/">关于我</a>
            </li>
          
        

        
          
            <li>
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="琼呀" href="http://localhost:1313/zh-cn/">
            <img class="avatar-img" src="http://localhost:1313/img/avatar-icon.png" alt="琼呀" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>随机变量和采样</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;发表于 August 2, 2025
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1487&nbsp;个字
  
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        
  <aside class="toc">
    <h2>目录</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#随机变量random-variables">随机变量（Random Variables）</a>
      <ul>
        <li><a href="#均匀分布uniform-rv">均匀分布（Uniform RV）</a></li>
        <li><a href="#伯努利随机变量bernouli-rv">伯努利随机变量（Bernouli RV）</a></li>
        <li><a href="#二项随机变量binomial-random-variable">二项随机变量（Binomial Random Variable）</a></li>
        <li></li>
        <li><a href="#指数随机变量exponential-random-variables">指数随机变量（Exponential Random Variables）</a></li>
        <li><a href="#几何随机变量geometric-random-variables">几何随机变量（Geometric Random Variables）</a></li>
        <li><a href="#正态随机变量normal-random-variables">正态随机变量（Normal Random Variables）</a></li>
      </ul>
    </li>
    <li><a href="#随机变量的计算">随机变量的计算</a>
      <ul>
        <li><a href="#随机变量变换random-variable-transformation">随机变量变换（Random Variable Transformation）</a></li>
        <li><a href="#期望运算符mean-operator">期望运算符(Mean Operator)</a></li>
        <li><a href="#误差传播法则propagation-laws">误差传播法则（Propagation Laws）</a></li>
        <li><a href="#样本均值算子sample-mean-operator">样本均值算子（Sample mean operator）</a></li>
      </ul>
    </li>
    <li><a href="#采样方法sample-methods">采样方法（Sample Methods）</a>
      <ul>
        <li><a href="#反函数法inverse-transform-sampling">反函数法（Inverse Transform Sampling）</a></li>
        <li><a href="#采样离散分布">采样离散分布</a></li>
        <li><a href="#采样连续分布">采样连续分布</a></li>
      </ul>
    </li>
    <li><a href="#附录">附录</a>
      <ul>
        <li><a href="#从已知二维随机变量-x-y-中采样其极坐标变换后的随机变量">从已知二维随机变量 (X, Y) 中采样其极坐标变换后的随机变量</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>

<h1 id="随机变量random-variables">随机变量（Random Variables）</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置样式</span>
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>set_theme(style<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;whitegrid&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_discrete_rv</span>(values, pmf, cdf, samples, rv_name):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 准备经验 CDF（ECDF）</span>
</span></span><span style="display:flex;"><span>    n_samples <span style="color:#f92672">=</span> len(samples)
</span></span><span style="display:flex;"><span>    sorted_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sort(samples)
</span></span><span style="display:flex;"><span>    ecdf_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>unique(sorted_samples)
</span></span><span style="display:flex;"><span>    ecdf_y <span style="color:#f92672">=</span> [np<span style="color:#f92672">.</span>sum(sorted_samples <span style="color:#f92672">&lt;=</span> x) <span style="color:#f92672">/</span> n_samples <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> ecdf_x]
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">8</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 理论 PMF</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>stem(values, pmf, basefmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; &#34;</span>, linefmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;-.&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Theoretical PMF: </span><span style="color:#e6db74">{</span>rv_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;f(X=x) = P(X = x)&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 理论 CDF</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>step(values, cdf, where<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;post&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Theoretical CDF: </span><span style="color:#e6db74">{</span>rv_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;F(x) = P(X ≤ x)&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.1</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 采样直方图</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    sns<span style="color:#f92672">.</span>countplot(x<span style="color:#f92672">=</span>samples, hue<span style="color:#f92672">=</span>samples, legend<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, palette<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pastel&#39;</span>, stat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;proportion&#39;</span>, order<span style="color:#f92672">=</span>values)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical Distribution (</span><span style="color:#e6db74">{</span>n_samples<span style="color:#e6db74">}</span><span style="color:#e6db74"> samples)&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Relative Frequency&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 经验 CDF（ECDF）</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>step(ecdf_x, ecdf_y, where<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;post&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Empirical CDF&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;ECDF&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.1</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><h2 id="均匀分布uniform-rv">均匀分布（Uniform RV）</h2>
<h3 id="离散均匀分布discrete-uniform-random-variable">离散均匀分布（Discrete Uniform Random Variable）</h3>
<blockquote>
<p>如果一个随机变量 $X$ 在一组<strong>有限的离散数值集合</strong>中取值，且每个值出现的概率相同，那么它就是一个<strong>离散型均匀随机变量</strong>。</p></blockquote>
<p>示例：</p>
<ul>
<li>掷一个骰子：
$X \in \{1, 2, 3, 4, 5, 6\}$，每个点的概率是 $\frac{1}{6}$</li>
<li>随机选择一张扑克牌（从 1 到 52）</li>
</ul>
<p><strong>数学定义</strong></p>
<p>设 $X \sim \text{DiscreteUniform}(a, b)$，其中 $a$, $b \in \mathbb{Z}$，且 $a \leq b$。</p>
<ul>
<li>
<p>支持集（取值范围，值域）是：</p>
$$
  k \in \{a, a+1, a+2, \dots, b\}
  $$</li>
<li>
<p>每个值的概率是：</p>
$$
  P(X = k) = \frac{1}{b - a + 1}, \quad \text{for } k \in \{a, \dots, b\}
  $$</li>
<li>
<p>概率质量函数（PMF）：
</p>
$$
  f(X=k) = P(X=k) = \left\{
  \begin{aligned}
  \frac{1}{b-a+1}, \text{for } a \le k \le b\\
  0, \text{ otherwise}
  \end{aligned}
  \right.
  $$</li>
<li>
<p>累积分布函数(CDF):
</p>
$$
  F(X=k) = P(X\le k) = \left\{
  \begin{aligned}
  0,  \text{for } k \lt a \\
  \frac{k-a+1}{b-a+1}, \text{for } a \le k \le b\\
  1, \text{ for } k \gt b
  \end{aligned}
  \right.
  $$</li>
<li>
<p>期望（$\mu$）：$\frac{a+b}{2}$</p>
</li>
<li>
<p>方差（$\sigma^2$）：$\frac{(b-a+1)^2-1}{12}$</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置随机种子以保证结果可重复</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 定义参数</span>
</span></span><span style="display:flex;"><span>a, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">6</span>  <span style="color:#75715e"># 均匀分布的范围</span>
</span></span><span style="display:flex;"><span>values <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(a, b<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># 离散取值：1~6</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> len(values)
</span></span><span style="display:flex;"><span>pmf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>ones(n) <span style="color:#f92672">/</span> n  <span style="color:#75715e"># 每个值的概率均等</span>
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(pmf)  <span style="color:#75715e"># 累积分布函数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 抽样</span>
</span></span><span style="display:flex;"><span>n_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>choice(values, size<span style="color:#f92672">=</span>n_samples, p<span style="color:#f92672">=</span>pmf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 可视化：理论分布 + 采样频率对比</span>
</span></span><span style="display:flex;"><span>plot_discrete_rv(values, pmf, cdf, samples, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;DiscreteUniform(</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_4_0.png" alt="png"></p>
<h4 id="采样">采样</h4>
<p>我们使用一个<strong>连续均匀分布 $U \sim \text{Uniform}(0, 1)$</strong> 来生成离散均匀随机数。</p>
<p>步骤：</p>
<ol>
<li>
<p>设区间为整数 $a$ 到 $b$（含端点），总共有 $N = b - a + 1$ 个数</p>
</li>
<li>
<p>生成一个随机数 $U \sim \text{Uniform}(0, 1)$</p>
</li>
<li>
<p>将 $U$ 映射到整数范围内：</p>
$$
   X = a + \left\lfloor U \cdot N \right\rfloor
   $$<p>✅ 这样得到的整数就是 $\{a, a+1, ..., b\}$ 中的一个，且等概率</p>
</li>
</ol>
<p>如果 $a=0, b=1$，则：</p>
<ol>
<li>$N = b - a + 1 = 1 - 0 + 1 = 2$</li>
<li>$U \sim \text{Uniform}(0, 1)$</li>
<li>$X = a + \left\lfloor U \cdot N \right\rfloor = 0 + \left\lfloor U \cdot 2 \right\rfloor = \left\lfloor U \cdot 2 \right\rfloor$</li>
</ol>
<p><strong>总结：</strong></p>
<table>
  <thead>
      <tr>
          <th>步骤</th>
          <th>描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>目标</td>
          <td>从 $\{a, a+1, ..., b\}$ 中等概率采样</td>
      </tr>
      <tr>
          <td>方法</td>
          <td>生成 $U \sim \text{Uniform}(0,1)$，然后 $X = a + \lfloor U \cdot (b - a + 1) \rfloor$</td>
      </tr>
      <tr>
          <td>工具函数</td>
          <td><code>random.random()</code> or <code>random.randint(a, b)</code></td>
      </tr>
      <tr>
          <td>应用</td>
          <td>模拟骰子、轮盘、抽签、均匀整数采样等</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">discrete_uniform_sample</span>(a, b, n):
</span></span><span style="display:flex;"><span>    N <span style="color:#f92672">=</span> b <span style="color:#f92672">-</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># U ~ Uniform(0, 1)</span>
</span></span><span style="display:flex;"><span>    U <span style="color:#f92672">=</span> [random<span style="color:#f92672">.</span>random() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n)] <span style="color:#75715e"># random.random() 返回区间 [0.0, 1.0) 的浮点数</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># X ~ Discrete Uniform(a, b)</span>
</span></span><span style="display:flex;"><span>    X <span style="color:#f92672">=</span> [a<span style="color:#f92672">+</span>int(u<span style="color:#f92672">*</span>N) <span style="color:#66d9ef">for</span> u <span style="color:#f92672">in</span> U]  <span style="color:#75715e"># When u = 0.999, u*N = 0.999 * N, which is close to N-1, so a + int(u*N) will be b.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> U, X
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>discrete_uniform_sample(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)
</span></span></code></pre></div><pre><code>([0.4444854289944321,
  0.951251619861675,
  0.7646892516581814,
  0.9854176841589392,
  0.0983350059391166,
  0.5245935455925463,
  0.962496892423623,
  0.7602027193895072,
  0.3724452123714195,
  0.8460390235179297],
 [0, 1, 1, 1, 0, 1, 1, 1, 0, 1])
</code></pre>
<h5 id="更简洁方式内置函数">更简洁方式（内置函数）</h5>
<p>当然，Python 也提供了直接采样的方法：<code>random.randint(a, b)  # 包含 a 和 b</code></p>
<p>它实现的就是上面的原理。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>)]  <span style="color:#75715e"># 使用内置函数直接采样，验证结果是否正确</span>
</span></span></code></pre></div><pre><code>[0, 1, 1, 0, 0, 1, 0, 0, 0, 0]
</code></pre>
<h5 id="验证采样结果">验证采样结果</h5>
<p>我们采样 10,000 次，看看分布是否均匀。</p>
<p>你会看到 1 到 6 之间的柱状图高度大致相等，这说明我们正确采样。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> comb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>a, b, N <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">30000</span>
</span></span><span style="display:flex;"><span>origin_samples, samples <span style="color:#f92672">=</span> discrete_uniform_sample(a, b, N)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical mean: </span><span style="color:#e6db74">{</span>sum(samples)<span style="color:#f92672">/</span>len(samples)<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 统计频率</span>
</span></span><span style="display:flex;"><span>counts <span style="color:#f92672">=</span> [samples<span style="color:#f92672">.</span>count(k) <span style="color:#f92672">/</span> N <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(a, b<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算理论概率（PMF）</span>
</span></span><span style="display:flex;"><span>theoretical <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(b<span style="color:#f92672">-</span>a<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(a, b<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;PMF = </span><span style="color:#e6db74">{</span>theoretical<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step 5: 可视化</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>bar(range(a, b<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), counts, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Frequency&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>bar(range(a, b<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), theoretical, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Theoretical PMF&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;edge&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Value&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Probability&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Discrete Uniform Sample (</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">~</span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>Empirical mean: 5.515
PMF = [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_10_1.png" alt="png"></p>
<h3 id="连续均匀分布continuous-uniform-random-variable">连续均匀分布（Continuous Uniform Random Variable）</h3>
<p><strong>什么是连续型均匀分布？</strong></p>
<blockquote>
<p>一个随机变量 $X \sim \text{Uniform}(a, b)$，如果它在区间 $[a, b]$ 上的每一个值都等可能地出现，那么我们称它服从<strong>连续均匀分布</strong>。</p></blockquote>
<p><strong>数学定义</strong></p>
<ul>
<li>
<p>支持集（取值范围）：$X \in [a, b]$</p>
</li>
<li>
<p>概率密度函数（PDF）：</p>
$$
  f_X(x) = \begin{cases}
  \frac{1}{b - a} & \text{if } x \in [a, b] \\
  0 & \text{otherwise}
  \end{cases}
  $$</li>
<li>
<p>累积分布函数（CDF）：</p>
$$
  F_X(x) = \begin{cases}
  0 & \text{if } x < a \\
  \frac{x - a}{b - a} & \text{if } a \leq x \leq b \\
  1 & \text{if } x > b
  \end{cases}
  $$</li>
<li>
<p>期望（$\mu$）：$\frac{a+b}{2}$</p>
</li>
<li>
<p>方差（$\sigma^2$）：$\frac{(b-a)^2}{12}$</p>
</li>
</ul>
<p><strong>参考：</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Continuous_uniform_distribution">Wiki: Continuous uniform distribution</a></li>
</ul>
<h4 id="采样-1">采样</h4>
<p><strong>采样原理（Inverse Transform Sampling）</strong></p>
<p>最简单有效的方法是：</p>
<blockquote>
<p>如果 $U \sim \text{Uniform}(0,1)$，那么</p>
$$
> X = a + (b - a) \cdot U \sim \text{Uniform}(a, b)
> $$</blockquote>
<p><em>💡为什么成立？</em></p>
<p>因为：</p>
<ol>
<li>$U \in [0, 1]$，是标准均匀分布</li>
<li>缩放区间长度为 $(b - a)$，再加上 $a$ 相当于“线性映射”</li>
<li>变换后的随机变量 $X$ 在 $[a, b]$ 上也均匀分布</li>
</ol>
<p><strong>采样步骤：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Step 1：生成一个 U ~ Uniform(0, 1)
</span></span><span style="display:flex;"><span>Step 2：通过线性变换 X = a + (b - a) * U
</span></span><span style="display:flex;"><span>Step 3：X 就是你要的 sample from Uniform(a, b)
</span></span></code></pre></div><p><strong>总结表格</strong></p>
<table>
  <thead>
      <tr>
          <th>项目</th>
          <th>内容</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>分布名称</td>
          <td>连续均匀分布 Uniform(a, b)</td>
      </tr>
      <tr>
          <td>PDF</td>
          <td>$f(x) = \frac{1}{b - a}$</td>
      </tr>
      <tr>
          <td>采样方法</td>
          <td>$X = a + (b - a) \cdot U$，其中 $U \sim \text{Uniform}(0,1)$</td>
      </tr>
      <tr>
          <td>Python函数</td>
          <td><code>random.random()</code> 或 <code>random.uniform(a, b)</code></td>
      </tr>
      <tr>
          <td>应用场景</td>
          <td>蒙特卡洛方法、模拟实验、随机初始化等</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_uniform</span>(a, b):
</span></span><span style="display:flex;"><span>    U <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()        <span style="color:#75715e"># U ~ Uniform(0,1)</span>
</span></span><span style="display:flex;"><span>    X <span style="color:#f92672">=</span> a <span style="color:#f92672">+</span> (b <span style="color:#f92672">-</span> a) <span style="color:#f92672">*</span> U        <span style="color:#75715e"># X ~ Uniform(a, b)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> X
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_uniform_list</span>(a, b, n):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_uniform(a, b) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sample_uniform_list(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)
</span></span></code></pre></div><pre><code>[0.6400024988096578,
 0.05979675338996093,
 0.5161926269415474,
 0.4823864030690008,
 0.31338893853775884,
 0.4885049387562129,
 0.7751242044584421,
 0.03653104468277457,
 0.1006986841203773,
 0.05647975387925808]
</code></pre>
<h5 id="直接用内置函数-uniforma-b">直接用内置函数 <code>uniform(a, b)</code></h5>
<p>这是标准库封装好的形式，内部实现其实也是 <code>a + (b - a) * random.random()</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><pre><code>0.8338807889744516
</code></pre>
<h5 id="验证采样效果">验证采样效果</h5>
<p>原理：<strong>我们可以通过计算采样结果的直方图，来验证采样数据是否与模型一致。</strong></p>
<p>我们采样 10,000 个 $X \sim \text{Uniform}(2, 5)$，画出直方图看看分布是否均匀：</p>
<p>✅ 如果看到直方图非常接近平的，说明分布是均匀的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a, b, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>pdf <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> (b <span style="color:#f92672">-</span> a)  <span style="color:#75715e"># 均匀分布的概率密度函数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_uniform_list(a, b, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样结果</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>scatter(range(n), samples, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Sample results from Uniform(</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;n&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Sample Value (X)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样直方图（频率）</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span>N, density<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Histogram of Sample from Uniform(</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Sample Value (X)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Absolute Frequency&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样直方图（相对频率）</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span>N, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hlines(pdf, a, b, colors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, linestyles<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;solid&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PDF&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Histogram of Sample from Uniform(</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Sample Value (X)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;h = Relative Frequency * N (N=</span><span style="color:#e6db74">{</span>N<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_18_0.png" alt="png"></p>
<h2 id="伯努利随机变量bernouli-rv">伯努利随机变量（Bernouli RV）</h2>
<p>又称<strong>两点分布</strong>或者<strong>0-1分布</strong>。<strong>离散</strong>型随机变量。</p>
<p><strong>数学定义</strong></p>
<p>设 $X \sim \text{Bernouli}(p)$，其中 $0 \le p \le 1$。</p>
<ul>
<li>
<p>支持集（取值范围，值域）是：</p>
$$
  k \in \{0, 1\}
  $$</li>
<li>
<p>每个值的概率是：</p>
$$
  P(X = 1) = p \\
  P(X = 0) = 1 - p
  $$</li>
<li>
<p>概率质量函数（PMF）：
</p>
$$
  f(X=k) = P(X=k) = \left\{
  \begin{aligned}
  p, \text{if } k=1\\
  1-p, \text{if } k=0
  \end{aligned}
  \right.
  $$</li>
<li>
<p>累积分布函数(CDF):
</p>
$$
  F(X=k) = P(X\le k) = \left\{
  \begin{aligned}
  0,  \text{if } k \lt 0 \\
  1-p, \text{if } 0 \le k \lt 1\\
  1, \text{ for } k \ge 1
  \end{aligned}
  \right.
  $$</li>
<li>
<p>期望（$\mu$）：$p$</p>
</li>
<li>
<p>方差（$\sigma^2$）：$p(1-p)$</p>
</li>
</ul>
<p>参考：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Bernoulli_distribution">维基百科：伯努利分布</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置随机种子以保证结果可重复</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 定义参数</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>
</span></span><span style="display:flex;"><span>values <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>])  <span style="color:#75715e"># 离散取值：1~6</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> len(values)
</span></span><span style="display:flex;"><span>pmf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>p, p])
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(pmf)  <span style="color:#75715e"># 累积分布函数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 抽样</span>
</span></span><span style="display:flex;"><span>n_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>binomial(n<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, p<span style="color:#f92672">=</span>p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 可视化：理论分布 + 采样频率对比</span>
</span></span><span style="display:flex;"><span>plot_discrete_rv(values, pmf, cdf, samples, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Bernoulli(p=</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_20_0.png" alt="png"></p>
<h3 id="伯努利定理bernouli-theorm">伯努利定理（Bernouli Theorm）</h3>
<p>伯努利定理： 描述了概率与频率之间的关系，当重复次数增加时，事件的相对频率会趋近于其概率。</p>
<p>设 $X_1, X_2, ..., X_n$ 是 $n$ 次独立同分布的伯努利随机变量（即 $X_i \sim \text{Bernoulli}(p)$），令</p>
$$
\bar{X}_n = \frac{1}{n} \sum_{i=1}^n X_i
$$<p>即成功的相对频率。</p>
<p>那么，伯努利定理告诉我们：</p>
$$
\lim_{n \to \infty} \mathbb{P}\left( \left| \bar{X}_n - p \right| > \epsilon \right) = 0 \quad \text{对任意 } \epsilon > 0
$$<p>因此，我们可以利用伯努利定理来验证模拟采样的正确性：</p>
<ol>
<li>计算每个事件的的实际频率 $f_{a_i}$</li>
<li>计算每个事件的相对频率 $f_i = \frac{f_{a_i}}{N}$</li>
<li>将每个事件的相对频率 $f_i$ 与概率 $p$ 进行对比。根据伯努利定理，当 $N$ 变大时，$f_i$ 会逼近 $p$</li>
</ol>
<p><strong>参考：</strong></p>
<ul>
<li><a href="https://proofwiki.org/wiki/Bernoulli%27s_Theorem">ProofWiki: Bernoulli&rsquo;s principle</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> FuncAnimation
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> HTML
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数设置</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>                <span style="color:#75715e"># 成功概率</span>
</span></span><span style="display:flex;"><span>n_trials <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>        <span style="color:#75715e"># 总实验次数</span>
</span></span><span style="display:flex;"><span>interval <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>          <span style="color:#75715e"># 动画间隔时间（ms）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成伯努利实验数据</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>binomial(n<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, p<span style="color:#f92672">=</span>p, size<span style="color:#f92672">=</span>n_trials)
</span></span><span style="display:flex;"><span>cumulative_freq <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(samples) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, n_trials <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建图形</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#ae81ff">1</span>, n_trials)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>axhline(y<span style="color:#f92672">=</span>p, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;True Probability p = </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>line, <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot([], [], lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Empirical Frequency&#39;</span>)
</span></span><span style="display:flex;"><span>text <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>text(<span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.9</span>, <span style="color:#e6db74">&#39;&#39;</span>, transform<span style="color:#f92672">=</span>ax<span style="color:#f92672">.</span>transAxes)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;Number of Trials&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Success Frequency&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Bernoulli Theorem Animation&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 动画更新函数</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(frame):
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, frame <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> cumulative_freq[:frame]
</span></span><span style="display:flex;"><span>    line<span style="color:#f92672">.</span>set_data(x, y)
</span></span><span style="display:flex;"><span>    text<span style="color:#f92672">.</span>set_text(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;n = </span><span style="color:#e6db74">{</span>frame<span style="color:#e6db74">}</span><span style="color:#e6db74">, freq = </span><span style="color:#e6db74">{</span>y[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> line, text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建动画</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -----------------------------</span>
</span></span><span style="display:flex;"><span>ani <span style="color:#f92672">=</span> FuncAnimation(fig, update, frames<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, n_trials <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>),
</span></span><span style="display:flex;"><span>                    interval<span style="color:#f92672">=</span>interval, blit<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Save as GIF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> PillowWriter
</span></span><span style="display:flex;"><span>ani<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;bernoulli_theorem_animation.gif&#34;</span>, writer<span style="color:#f92672">=</span>PillowWriter(fps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>close(fig)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> Image
</span></span><span style="display:flex;"><span>Image(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bernoulli_theorem_animation.gif&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#plt.close()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在 notebook 中显示动画</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#HTML(ani.to_jshtml())</span>
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/bernoulli_theorem_animation.gif" alt="png"></p>
<h3 id="采样-2">采样</h3>
<h4 id="基于均匀分布-uniform0-1">基于均匀分布 Uniform(0, 1)</h4>
<p><strong>🌱 原理</strong></p>
<p>利用一个均匀分布 $U \sim \text{Uniform}(0,1)$ 来实现：</p>
<ul>
<li>如果 $U < p$，输出 1（成功）</li>
<li>否则输出 0（失败）</li>
</ul>
<p>这是因为 Uniform(0,1) 在区间内是均匀的，所以概率小于 $p$ 的那一段恰好就是 “成功”的概率。</p>
<p>🎬 动画说明：
左图：Sampling from Uniform(0,1)</p>
<ul>
<li>每一帧，生成一个 $U∼Uniform(0,1)$ 的样本；</li>
<li>蓝色点按随机高度显示采样值；</li>
<li>红色虚线表示阈值 $p=0.3$，即：
<ul>
<li>$U<p$ ⇒ 伯努利值为 1；</li>
<li>$U≥p$ ⇒ 伯努利值为 0。</li>
</ul>
</li>
</ul>
<p>右图：Bernoulli Sample Counts</p>
<ul>
<li>实时更新 0 和 1 的出现次数柱状图；</li>
<li>最终，1 的数量约为 30%，符合概率 $p=0.3$；</li>
<li>0 的数量约为 70%。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.animation <span style="color:#66d9ef">as</span> animation
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> HTML
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parameters</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>n_frames <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pre-generate uniform samples</span>
</span></span><span style="display:flex;"><span>uniform_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, n_frames)
</span></span><span style="display:flex;"><span>bernoulli_samples <span style="color:#f92672">=</span> (uniform_samples <span style="color:#f92672">&lt;</span> p)<span style="color:#f92672">.</span>astype(int)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set up the figure and axes</span>
</span></span><span style="display:flex;"><span>fig, axs <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>uniform_ax <span style="color:#f92672">=</span> axs[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>bernoulli_ax <span style="color:#f92672">=</span> axs[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize plots</span>
</span></span><span style="display:flex;"><span>uniform_scatter <span style="color:#f92672">=</span> uniform_ax<span style="color:#f92672">.</span>scatter([], [], c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>)
</span></span><span style="display:flex;"><span>bernoulli_bar <span style="color:#f92672">=</span> bernoulli_ax<span style="color:#f92672">.</span>bar([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configure uniform axis</span>
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>axvline(p, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;p = </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Sampling from Uniform(0,1)&#39;</span>)
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;Value&#39;</span>)
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Random Height&#39;</span>)
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>uniform_ax<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configure Bernoulli axis</span>
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1.5</span>)
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, n_frames)
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Bernoulli Sample Counts&#39;</span>)
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;Value&#39;</span>)
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Count&#39;</span>)
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>set_xticks([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>bernoulli_ax<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Store sample counts</span>
</span></span><span style="display:flex;"><span>count_0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>count_1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>y_vals <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Animation update function</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(frame):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> count_0, count_1, x_vals, y_vals
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> uniform_samples[frame]
</span></span><span style="display:flex;"><span>    x_vals<span style="color:#f92672">.</span>append(u)
</span></span><span style="display:flex;"><span>    y_vals<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand())  <span style="color:#75715e"># random y position for scatter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    bern_sample <span style="color:#f92672">=</span> bernoulli_samples[frame]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> bern_sample <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        count_0 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        count_1 <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Update scatter</span>
</span></span><span style="display:flex;"><span>    uniform_scatter<span style="color:#f92672">.</span>set_offsets(np<span style="color:#f92672">.</span>column_stack((x_vals, y_vals)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Update bar chart</span>
</span></span><span style="display:flex;"><span>    bernoulli_bar[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_height(count_0)
</span></span><span style="display:flex;"><span>    bernoulli_bar[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_height(count_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> uniform_scatter, bernoulli_bar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create animation</span>
</span></span><span style="display:flex;"><span>ani <span style="color:#f92672">=</span> animation<span style="color:#f92672">.</span>FuncAnimation(fig, update, frames<span style="color:#f92672">=</span>n_frames, interval<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, blit<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存为 GIF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> PillowWriter
</span></span><span style="display:flex;"><span>ani<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;sample_uniform_to_bernoulli.gif&#34;</span>, writer<span style="color:#f92672">=</span>PillowWriter(fps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>close(fig)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> Image
</span></span><span style="display:flex;"><span>Image(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sample_uniform_to_bernoulli.gif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#plt.close()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在 notebook 中显示动画</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#HTML(ani.to_jshtml())</span>
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/sample_uniform_to_bernoulli.gif" alt="png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_bernoulli</span>(p):
</span></span><span style="display:flex;"><span>    U <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random() <span style="color:#75715e"># U ~ Uniform(0, 1)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> U <span style="color:#f92672">&lt;</span> p <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sample_bernoulli(<span style="color:#ae81ff">0.7</span>)
</span></span></code></pre></div><pre><code>1
</code></pre>
<h5 id="验证">验证</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p, N <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>, <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> [sample_bernoulli(p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(N)]
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical mean: </span><span style="color:#e6db74">{</span>sum(samples)<span style="color:#f92672">/</span>len(samples)<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)  <span style="color:#75715e"># 应该接近 0.7</span>
</span></span></code></pre></div><pre><code>Empirical mean: 0.703
</code></pre>
<h4 id="使用-numpy">使用 <code>numpy</code></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>binomial(n<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, p<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>)
</span></span></code></pre></div><pre><code>1
</code></pre>
<h5 id="验证-1">验证</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p, N <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>, <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> [np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>binomial(n<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, p<span style="color:#f92672">=</span>p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(N)]
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical mean: </span><span style="color:#e6db74">{</span>sum(samples)<span style="color:#f92672">/</span>len(samples)<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)  <span style="color:#75715e"># 应该接近 0.7</span>
</span></span></code></pre></div><pre><code>Empirical mean: 0.702
</code></pre>
<h2 id="二项随机变量binomial-random-variable">二项随机变量（Binomial Random Variable）</h2>
<p>一个随机变量 $X∼Binomial(n,p)$，表示在<strong>重复</strong>进行 $n$ 次<strong>独立</strong>的伯努利试验（每次成功概率为 $p$）中，成功（记为1）发生的<strong>总次数</strong>。$X$ 是离散随机变量。</p>
<p><strong>数学定义</strong></p>
<p>设 $X \sim \text{Binomial}(n, p)$（或者是 $X \sim B(n,p)$），其中 $n \gt 0, 0 \le p \le 1$。</p>
<ul>
<li>
<p>支持集（取值范围，值域）是：</p>
$$
  k \in \{0, \dots, n\}
  $$<ul>
<li>表示成功的次数</li>
</ul>
</li>
<li>
<p>每个值的概率是：</p>
<h2>$$
  P(X = 0) = (1-p)^n\\
  \dots \\
  P(X = k) = \begin{pmatrix} n \\ k \end{pmatrix}p^k(1-p)^{(n-k)} \\
  \dots \\
  P(X = n) = p^n
  $$</h2>
</li>
<li>
<p>概率质量函数（PMF）：
</p>
$$
  f(X=k) = P(X=k) = \begin{pmatrix} n \\ k \end{pmatrix}p^k(1-p)^{(n-k)} \\
  其中，\begin{pmatrix} n \\ k \end{pmatrix} = \frac{n!}{k!(n-k)!}
  $$</li>
<li>
<p>累积分布函数(CDF):
</p>
$$
  F(X=k) = P(X\le k) = \sum _{i=0}^{\lfloor k\rfloor }{n \choose i}p^{i}(1-p)^{n-i}
  $$<ul>
<li>where $\lfloor k\rfloor$ is the &ldquo;floor&rdquo; under k, i.e. the greatest integer less than or equal to k.</li>
</ul>
</li>
<li>
<p>期望（$\mu$）：$np$</p>
<ul>
<li>If $X_{1},\ldots ,X_{n}$ are identical (and independent) Bernoulli random variables with parameter $p$, then $X = X_1 + \dots + X_n$ and $\operatorname {E} [X]=\operatorname {E} [X_{1}+\cdots +X_{n}]=\operatorname {E} [X_{1}]+\cdots +\operatorname {E} [X_{n}]=p+\cdots +p=np.$</li>
</ul>
</li>
<li>
<p>方差（$\sigma^2$）：$np(1-p)$</p>
<ul>
<li>the variance of a sum of independent random variables = the sum of the variances</li>
</ul>
</li>
</ul>
<p><strong>参考：</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Binomial_distribution">Wiki: Binomial distribution</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> binom
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置随机种子以保证结果可重复</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 定义参数</span>
</span></span><span style="display:flex;"><span>n, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0.3</span> <span style="color:#75715e"># X ～ Binomial(n, p)</span>
</span></span><span style="display:flex;"><span>values <span style="color:#f92672">=</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># 离散取值：0, 1, ..., n</span>
</span></span><span style="display:flex;"><span>pmf <span style="color:#f92672">=</span> binom<span style="color:#f92672">.</span>pmf(values, n, p)
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(pmf)  <span style="color:#75715e"># 累积分布函数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 抽样</span>
</span></span><span style="display:flex;"><span>n_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>binomial(n<span style="color:#f92672">=</span>n, p<span style="color:#f92672">=</span>p, size<span style="color:#f92672">=</span>n_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 可视化：理论分布 + 采样频率对比</span>
</span></span><span style="display:flex;"><span>plot_discrete_rv(values, pmf, cdf, samples, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Binomial(n=</span><span style="color:#e6db74">{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">, p=</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_34_0.png" alt="png"></p>
<h3 id="采样-3">采样</h3>
<p>采样 <strong>Binomial 随机变量</strong> $X \sim \text{Binomial}(n, p)$（表示从 $n$ 次独立伯努利试验中成功次数）的方法很多，适用于不同参数范围。下面是目前已知的所有经典和实用方法，按类型归类整理，并指出适用情况。</p>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>主要思想</th>
          <th>适用范围</th>
          <th>是否精确</th>
          <th>是否容易实现</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1. <strong>Bernoulli 重复法</strong></td>
          <td>对 $n$ 次伯努利采样并求和</td>
          <td>任意 $n, p$，尤其是小 $n$</td>
          <td>✅ 精确</td>
          <td>✅ 简单</td>
      </tr>
      <tr>
          <td>2. <strong>反函数采样法（Inverse Transform）</strong></td>
          <td>用 CDF 找第一个使 $F(k) ≥ u$ 的 $k$</td>
          <td>小 $n$ 时可行</td>
          <td>✅ 精确</td>
          <td>⚠️ 易慢</td>
      </tr>
      <tr>
          <td>3. <strong>表查找法（CDF 查表）</strong></td>
          <td>预计算所有 $F(k)$，再查</td>
          <td>小 $n$（&lt;100）</td>
          <td>✅ 精确</td>
          <td>✅ 快速（预计算）</td>
      </tr>
      <tr>
          <td>4. <strong>Rejection Sampling</strong></td>
          <td>构造易采样的 proposal 分布再拒绝</td>
          <td>中等 $n$，或用于模拟</td>
          <td>✅ 精确</td>
          <td>⚠️ 难度高</td>
      </tr>
      <tr>
          <td>5. <strong>正态近似法（Normal Approximation）</strong></td>
          <td>用 $\mathcal{N}(np, np(1-p))$ 近似</td>
          <td>大 $n$，$np(1-p) \ge 10$</td>
          <td>❌ 近似</td>
          <td>✅ 非常快</td>
      </tr>
      <tr>
          <td>6. <strong>Poisson 近似法</strong></td>
          <td>当 $n$ 大、$p$ 小，$\lambda = np$</td>
          <td>$p \le 0.05$，$np \le 10$</td>
          <td>❌ 近似</td>
          <td>✅ 快速</td>
      </tr>
      <tr>
          <td>7. <strong>BTPE 算法（Fast Binomial by Kachitvichyanukul and Schmeiser）</strong></td>
          <td>分段拒绝采样（经典高效）</td>
          <td>任意 $n, p$，特别适合大 $n$</td>
          <td>✅ 精确</td>
          <td>⚠️ 实现复杂</td>
      </tr>
      <tr>
          <td>8. <strong>比特操作法（Bit Trick）</strong></td>
          <td>用位操作模拟多次伯努利</td>
          <td>$n$ 不大（如蒙特卡洛）</td>
          <td>✅ 精确</td>
          <td>⚠️ 特殊优化</td>
      </tr>
      <tr>
          <td>9. <strong>Alias 方法（非主流）</strong></td>
          <td>离散变量的高效采样</td>
          <td>很小 $n$ 且大量重复采样</td>
          <td>✅ 精确</td>
          <td>⚠️ 初始化复杂</td>
      </tr>
  </tbody>
</table>
<p><strong>🔧 推荐使用</strong></p>
<table>
  <thead>
      <tr>
          <th>使用场景</th>
          <th>推荐方法</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>学习理解原理</td>
          <td>伯努利重复采样 / 反函数采样</td>
      </tr>
      <tr>
          <td>小样本、单次采样</td>
          <td>任意（都快）</td>
      </tr>
      <tr>
          <td>大样本、速度优先</td>
          <td>正态近似或 BTPE（使用 <code>numpy.random.binomial</code>）</td>
      </tr>
      <tr>
          <td>小 $p$、稀疏事件</td>
          <td>Poisson 近似</td>
      </tr>
      <tr>
          <td>多次重复采样</td>
          <td>使用查表 / BTPE 算法</td>
      </tr>
  </tbody>
</table>
<p><strong>✅ 总结图示（概念流程）</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Binomial(n, p)
</span></span><span style="display:flex;"><span>│
</span></span><span style="display:flex;"><span>├── 小 n: 直接伯努利重复
</span></span><span style="display:flex;"><span>├── 小 p: 用 Poisson(np)
</span></span><span style="display:flex;"><span>├── 大 n, np(1-p)&gt;10: 用正态(np, np(1-p))
</span></span><span style="display:flex;"><span>├── 任意 n,p: 反函数 or 查表
</span></span><span style="display:flex;"><span>└── 高效工业级: BTPE 算法（NumPy）
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> comb
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_binomial_sample</span>(n, p, samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    验证二项分布采样的正确性
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param n: 二项分布的试验次数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param samples: 采样结果列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: None
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    N <span style="color:#f92672">=</span> len(samples)
</span></span><span style="display:flex;"><span>    empirical_mean <span style="color:#f92672">=</span> sum(samples) <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>    theoretical_mean <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> p
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical mean: </span><span style="color:#e6db74">{</span>empirical_mean<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, Theoretical mean: </span><span style="color:#e6db74">{</span>theoretical_mean<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    empirical_variance <span style="color:#f92672">=</span> sum((x <span style="color:#f92672">-</span> empirical_mean) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> samples) <span style="color:#f92672">/</span> len(samples)
</span></span><span style="display:flex;"><span>    theoretical_variance <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> p <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical variance: </span><span style="color:#e6db74">{</span>empirical_variance<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, Theoretical variance: </span><span style="color:#e6db74">{</span>theoretical_variance<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 统计频率</span>
</span></span><span style="display:flex;"><span>    counts <span style="color:#f92672">=</span> [samples<span style="color:#f92672">.</span>count(k) <span style="color:#f92672">/</span> N <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算理论概率（PMF）</span>
</span></span><span style="display:flex;"><span>    theoretical <span style="color:#f92672">=</span> [comb(n, k) <span style="color:#f92672">*</span> (p <span style="color:#f92672">**</span> k) <span style="color:#f92672">*</span> ((<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p) <span style="color:#f92672">**</span> (n <span style="color:#f92672">-</span> k)) <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>bar(range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), counts, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Frequency&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;edge&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>bar([k <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.4</span> <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)], theoretical, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Theoretical PMF&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;edge&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Number of Successes&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Probability&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Binomial Distribution: n=</span><span style="color:#e6db74">{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">, p=</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><h4 id="方法一伯努利重复法基于伯努利随机变量">方法一：伯努利重复法（基于伯努利随机变量）</h4>
<p>如果你能从伯努利分布中采样，那就可以通过<strong>对 $n$ 次伯努利采样求和</strong>，得到一个二项式样本。</p>
<p>✅ 步骤概览：</p>
<ol>
<li>初始化计数器为 0</li>
<li>重复 n 次以下操作：</li>
</ol>
<ul>
<li>从 [0, 1] 中采样一个伯努利值（成功的概率是 $p$）</li>
<li>如果采样为 1（表示成功），则计数器加一</li>
</ul>
<ol start="3">
<li>最终的计数器数值就是一次二项分布的采样值</li>
</ol>
<p>使用 NumPy 向量化采样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>binomial(n<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, p<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_binomial_mimic</span>(n, p):
</span></span><span style="display:flex;"><span>    count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n): <span style="color:#75715e"># repeat N times Bernouli sampling</span>
</span></span><span style="display:flex;"><span>        u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()  <span style="color:#75715e"># 从 [0,1) 中采样一个均匀变量</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>p <span style="color:#f92672">&lt;=</span> u <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>       <span style="color:#75715e"># 成功就加一</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> count
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_binomial_mimic_list</span>(n, p, num_samples):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_binomial_mimic(n, p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(num_samples)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n, p, num_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>sample_binomial_mimic_list(n, p, num_samples)
</span></span></code></pre></div><pre><code>[2, 5, 6, 4, 4, 4, 7, 4, 8, 5]
</code></pre>
<h5 id="visualize">Visualize</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n, p, num_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0.3</span>, <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_binomial_mimic_list(n, p, num_samples)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span>range(<span style="color:#ae81ff">12</span>), align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>, rwidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Number of Successes&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Frequency&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Sampling from Binomial(n=10, p=0.3)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_41_0.png" alt="png"></p>
<h5 id="验证-2">验证</h5>
<p>验证的思路是：采很多样本，然后画出直方图，再与理论的二项式概率质量函数（PMF）对比。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_binomial_mimic_list(n, p, N)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;Empirical mean: {sum(samples)/len(samples):.3f}&#34;)  # 应该接近 np = 10x0.4 = 4.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify_binomial_sample(n, p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 2.997, Theoretical mean: 3.000
Empirical variance: 2.153, Theoretical variance: 2.100
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_43_1.png" alt="png"></p>
<h4 id="方法二反函数采样法inverse-transform">方法二：反函数采样法（Inverse Transform）</h4>
<p>它是一种非常经典的、<strong>不依赖于重复模拟伯努利分布</strong>的采样方法。不过它<strong>不太适合高 n 的 Binomial</strong>，因为它涉及累积概率的查找和搜索，但在理论上，它是完全可行的，而且 <strong>没有用到伯努利随机变量</strong>！</p>
<p><strong>原理步骤如下：</strong></p>
<ol>
<li>
<p>生成一个均匀随机数 $u \sim \text{Uniform}(0, 1)$</p>
</li>
<li>
<p>依次累加二项式分布的概率质量函数（PMF）：</p>
$$
   F(k) = \sum_{i=0}^{k} P(X=i)
   $$</li>
<li>
<p>找到第一个 $k$，使得 $F(k) \ge u$</p>
</li>
<li>
<p>返回这个 $k$，作为采样结果</p>
</li>
</ol>
<p>这就完成了一次采样。</p>
<p><strong>优缺点分析</strong></p>
<table>
  <thead>
      <tr>
          <th>优点</th>
          <th>缺点</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>理论通用性强</td>
          <td>对高维、高 n 的二项分布效率较低（要计算很多项）</td>
      </tr>
      <tr>
          <td>不需要模拟伯努利</td>
          <td>每次采样都要重新从 k=0 开始扫描</td>
      </tr>
      <tr>
          <td>可用于精确的采样</td>
          <td>无法向量化，不能直接并行加速</td>
      </tr>
  </tbody>
</table>
<p><strong>适合用在：</strong></p>
<ul>
<li>$n$ 较小的情况（如 $n \leq 20$）</li>
<li>教学和理论验证目的</li>
</ul>
<p><strong>📌 总结</strong></p>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>是否用伯努利</th>
          <th>速度</th>
          <th>适用情况</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>累加伯努利</td>
          <td>✅</td>
          <td>快（简单）</td>
          <td>通用、小 n</td>
      </tr>
      <tr>
          <td>逆变换采样</td>
          <td>❌</td>
          <td>中等</td>
          <td>理论验证、非向量化场景</td>
      </tr>
      <tr>
          <td>正态/泊松近似</td>
          <td>❌</td>
          <td>快</td>
          <td>n 大、p 小/中</td>
      </tr>
      <tr>
          <td>表查法 + 二分查找</td>
          <td>❌</td>
          <td>非常快</td>
          <td>固定 n，多次采样</td>
      </tr>
  </tbody>
</table>
<h5 id="辅助示意图理解">辅助示意图理解</h5>
<p>如果你画出 Binomial(n=5, p=0.5) 的 PMF：</p>
<table>
  <thead>
      <tr>
          <th>k</th>
          <th>P(X=k)</th>
          <th>累积和 F(k)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>0.03125</td>
          <td>0.03125</td>
      </tr>
      <tr>
          <td>1</td>
          <td>0.15625</td>
          <td>0.1875</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0.3125</td>
          <td>0.5</td>
      </tr>
      <tr>
          <td>3</td>
          <td>0.3125</td>
          <td>0.8125</td>
      </tr>
      <tr>
          <td>4</td>
          <td>0.15625</td>
          <td>0.96875</td>
      </tr>
      <tr>
          <td>5</td>
          <td>0.03125</td>
          <td>1.0</td>
      </tr>
  </tbody>
</table>
<p>如果你生成一个 $u = 0.4$，你会发现 $F(2) = 0.5 \ge 0.4$，那么就采样出 $k = 2$。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> comb
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算 PMF 和 CDF</span>
</span></span><span style="display:flex;"><span>k_vals <span style="color:#f92672">=</span> list(range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>pmf <span style="color:#f92672">=</span> [comb(n, k) <span style="color:#f92672">*</span> p<span style="color:#f92672">**</span>k <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p)<span style="color:#f92672">**</span>(n <span style="color:#f92672">-</span> k) <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> k_vals]
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(pmf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">####### 采样 ####### </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成一个随机数 u</span>
</span></span><span style="display:flex;"><span>u <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.52</span>  <span style="color:#75715e"># 也可以改成 random.random()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 找到第一个 cdf[k] &gt;= u</span>
</span></span><span style="display:flex;"><span>k_selected <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> k, value <span style="color:#f92672">in</span> enumerate(cdf):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;=</span> value:
</span></span><span style="display:flex;"><span>        k_selected <span style="color:#f92672">=</span> k
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">####### 绘制验证 ####### </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘图</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PMF 图（柱状图）</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>bar(k_vals, pmf, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PMF: P(X = k)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CDF 图（阶梯线）</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>step(k_vals, cdf, where<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mid&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CDF: P(X ≤ k)&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 画出 u 和对应的 k_selected</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axhline(y<span style="color:#f92672">=</span>u, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;u = </span><span style="color:#e6db74">{</span>u<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvline(x<span style="color:#f92672">=</span>k_selected, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;sampled k = </span><span style="color:#e6db74">{</span>k_selected<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 标注</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Inverse Transform Sampling for Binomial(n=</span><span style="color:#e6db74">{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">, p=</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;k&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Probability&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xticks(k_vals)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.05</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_46_0.png" alt="png"></p>
<h5 id="代码实现">代码实现</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> comb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_binomial_inverse</span>(n, p):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 1: generate a uniform random number</span>
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 2: initialize cumulative probability</span>
</span></span><span style="display:flex;"><span>    cumulative <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        prob <span style="color:#f92672">=</span> comb(n, k) <span style="color:#f92672">*</span> (p <span style="color:#f92672">**</span> k) <span style="color:#f92672">*</span> ((<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p) <span style="color:#f92672">**</span> (n <span style="color:#f92672">-</span> k))
</span></span><span style="display:flex;"><span>        cumulative <span style="color:#f92672">+=</span> prob
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;=</span> cumulative:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> k
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> n  <span style="color:#75715e"># fallback</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_binomial_inverse_list</span>(n, p, num_samples):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_binomial_inverse(n, p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(num_samples)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n, p, num_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>sample_binomial_inverse_list(n, p, num_samples)
</span></span></code></pre></div><pre><code>[3, 4, 2, 3, 5, 5, 7, 2, 4, 8]
</code></pre>
<h5 id="可视化">可视化</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n, p, num_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">0.3</span>, <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_binomial_inverse_list(n, p, num_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span>range(<span style="color:#ae81ff">12</span>), align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>, rwidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Number of Successes&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Frequency&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Sampling from Binomial(n=10, p=0.3)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_51_0.png" alt="png"></p>
<h5 id="验证-3">验证</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_binomial_inverse_list(n, p, N)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;Empirical mean: {sum(samples)/len(samples):.3f}&#34;)  # 应该接近 np = 10x0.4 = 4.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify_binomial_sample(n, p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.011, Theoretical mean: 3.000
Empirical variance: 2.097, Theoretical variance: 2.100
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_53_1.png" alt="png"></p>
<h4 id="方法三表查找法cdf-查表">方法三：表查找法（CDF 查表）</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> comb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>binomial_table, binomial_table_n, binomial_table_p <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_binomial_table</span>(n, p):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    生成二项分布的 CDF 查找表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param n: 二项分布的试验次数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: None
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> binomial_table
</span></span><span style="display:flex;"><span>    binomial_table <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    cumulative <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        prob <span style="color:#f92672">=</span> comb(n, k) <span style="color:#f92672">*</span> (p <span style="color:#f92672">**</span> k) <span style="color:#f92672">*</span> ((<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p) <span style="color:#f92672">**</span> (n <span style="color:#f92672">-</span> k))
</span></span><span style="display:flex;"><span>        cumulative <span style="color:#f92672">+=</span> prob
</span></span><span style="display:flex;"><span>        binomial_table[k] <span style="color:#f92672">=</span> cumulative
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_binomial_table</span>(n, p):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 1: generate a uniform random number</span>
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 2: look up in the CDF table</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> binomial_table <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> binomial_table_n <span style="color:#f92672">!=</span> n <span style="color:#f92672">or</span> binomial_table_p <span style="color:#f92672">!=</span> p:
</span></span><span style="display:flex;"><span>        generate_binomial_table(n, p)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 3: find the first k such that CDF[k] &gt;= u</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;=</span> binomial_table[k]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> k
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># If no k found, return n</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> n  <span style="color:#75715e"># fallback</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_binomial_table_list</span>(n, p, num_samples):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_binomial_table(n, p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(num_samples)]
</span></span></code></pre></div><h5 id="验证-4">验证</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_binomial_table_list(n, p, N)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;Empirical mean: {sum(samples)/len(samples):.3f}&#34;)  # 应该接近 np = 10x0.4 = 4.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify_binomial_sample(n, p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.002, Theoretical mean: 3.000
Empirical variance: 2.100, Theoretical variance: 2.100
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_57_1.png" alt="png"></p>
<h4 id="方法四拒绝-采样法rejection-sampling">方法四：拒绝-采样法（Rejection Sampling）</h4>
<p>使用 <strong>Rejection Sampling（接受-拒绝采样）来采样</strong>一个<strong>二项式随机变量</strong>，其实并不是最常见的方法（更常用的是直接采样或用泊松/正态近似），但它在理论上是可行的，尤其在难以直接采样或需要从截断/罕见参数的二项式分布中采样时。</p>
<p><strong>✅ proposal 分布的理想选择：均匀分布 $g(k) = \frac{1}{n+1}$</strong></p>
<ul>
<li>简单易实现；</li>
<li>但若目标分布是偏斜的（如 $p=0.05$），那么大多数 sample 会被拒绝（效率差）；</li>
<li>仍然是教学中最常用示例。</li>
</ul>
<p><strong>⚠️ 注意事项：</strong></p>
<ul>
<li><strong>效率取决于 M</strong>：如果 $p$ 很小或很大，$f(k)$ 会非常偏，导致很低的接受率；</li>
<li>若想更高效，可使用<strong>离散高斯分布、泊松分布、正态近似</strong>等作为更“贴近”目标的 proposal 分布；</li>
<li>Rejection Sampling 的通用性强，但不是采样 Binomial 的首选方法（首选是直接算法、或正态/泊松近似）。</li>
</ul>
<p><strong>✅ 总结</strong></p>
<table>
  <thead>
      <tr>
          <th>步骤</th>
          <th>内容</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>🎯 目标</td>
          <td>从 Binomial(n, p) 中采样</td>
      </tr>
      <tr>
          <td>🧰 方法</td>
          <td>构造 proposal $g(k)$，满足 $f(k) \leq M g(k)$</td>
      </tr>
      <tr>
          <td>📐 采样机制</td>
          <td>采样 $k \sim g(k)$，以概率 $\alpha = \frac{f(k)}{M g(k)}$ 接受</td>
      </tr>
      <tr>
          <td>📉 缺点</td>
          <td>效率受 $p$ 和 $M$ 影响较大，采样较慢</td>
      </tr>
      <tr>
          <td>🧠 优势</td>
          <td>思路简单、分布通用性强</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> binom
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rejection_sample_binomial</span>(n, p, N_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 目标分布：Bin(n, p)</span>
</span></span><span style="display:flex;"><span>    bin_pmf <span style="color:#f92672">=</span> [binom<span style="color:#f92672">.</span>pmf(k, n, p) <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Proposal 分布：Uniform(0, n)</span>
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> (n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 找最大值用于计算 M</span>
</span></span><span style="display:flex;"><span>    M <span style="color:#f92672">=</span> max(bin_pmf) <span style="color:#f92672">/</span> g
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(samples) <span style="color:#f92672">&lt;</span> N_samples:
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>, n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        u <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        accept_prob <span style="color:#f92672">=</span> bin_pmf[k] <span style="color:#f92672">/</span> (M <span style="color:#f92672">*</span> g)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;</span> accept_prob:
</span></span><span style="display:flex;"><span>            samples<span style="color:#f92672">.</span>append(k)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 验证</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> rejection_sample_binomial(n, p, N)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;Empirical mean: {sum(samples)/len(samples):.3f}&#34;)  # 应该接近 np = 10x0.4 = 4.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify_binomial_sample(n, p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.014, Theoretical mean: 3.000
Empirical variance: 2.120, Theoretical variance: 2.100
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_60_1.png" alt="png"></p>
<h4 id="方法五正态近似法normal-approximation">方法五：正态近似法（Normal Approximation）</h4>
<p><strong>原理：De Moivre–Laplace 中心极限定理</strong></p>
<p>当 $n$ 足够大时，二项式分布 $X \sim \text{Bin}(n, p)$ 可由正态分布近似：</p>
$$
X \approx Y \sim \mathcal{N}(\mu, \sigma^2)
$$<p>其中：</p>
<ul>
<li>均值：$\mu = np$</li>
<li>方差：$\sigma^2 = np(1-p)$</li>
</ul>
<p>这意味着我们可以从该正态分布中采样一个值作为近似。</p>
<p><strong>适用条件：</strong></p>
<ul>
<li>$n$ 要足够大</li>
<li>$p$ 不要太接近 0 或 1</li>
</ul>
<p><strong>通常经验法则是：</strong></p>
$$
np \geq 10 \quad \text{且} \quad n(1-p) \geq 10
$$<p><strong>采样方法</strong></p>
<ol>
<li>从标准正态分布 $Z \sim \mathcal{N}(0, 1)$ 采样；</li>
<li>构造 $Y = np + \sqrt{np(1-p)} \cdot Z$</li>
<li>将 $Y$ 四舍五入得到整数 $k$，并裁剪到合法范围 $[0, n]$</li>
</ol>
<p><strong>误差分析</strong></p>
<table>
  <thead>
      <tr>
          <th>项目</th>
          <th>描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>误差来源</strong></td>
          <td>连续 → 离散、近似 tail 偏差</td>
      </tr>
      <tr>
          <td><strong>效果最好</strong></td>
          <td>$p \approx 0.5$ 且 $n$ 足够大</td>
      </tr>
      <tr>
          <td><strong>偏态情况</strong></td>
          <td>当 $p \ll 0.5$ 或 $p \gg 0.5$ 时尾部误差大</td>
      </tr>
      <tr>
          <td><strong>改进方法</strong></td>
          <td>加 continuity correction（见下）</td>
      </tr>
  </tbody>
</table>
<p><strong>🔧 Continuity Correction（连续性修正）</strong></p>
<p>由于正态分布是连续的，而二项式是离散的，<strong>连续性修正</strong>可略微提升精度：</p>
<ul>
<li>将离散值 $k$ 映射到 $[k - 0.5, k + 0.5]$ 的区间上；</li>
<li>采样时加 0.5 或 -0.5 抵消误差：</li>
</ul>
$$
X \approx \mathcal{N}(np, np(1-p)) \Rightarrow X' = \text{round}(Y + 0.5)
$$<p>代码中可尝试 <code>samples = np.floor(samples + 0.5).astype(int)</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> binom
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normal_approx_binomial</span>(n, p, N_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>):
</span></span><span style="display:flex;"><span>    mu <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> p
</span></span><span style="display:flex;"><span>    sigma <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(n <span style="color:#f92672">*</span> p <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(loc<span style="color:#f92672">=</span>mu, scale<span style="color:#f92672">=</span>sigma, size<span style="color:#f92672">=</span>N_samples)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 四舍五入并裁剪</span>
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>round(samples)<span style="color:#f92672">.</span>astype(int)
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(samples, <span style="color:#ae81ff">0</span>, n)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples<span style="color:#f92672">.</span>tolist()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 验证</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> normal_approx_binomial(n, p, N)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;Empirical mean: {sum(samples)/len(samples):.3f}&#34;)  # 应该接近 np = 10x0.4 = 4.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify_binomial_sample(n, p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.019, Theoretical mean: 3.000
Empirical variance: 2.116, Theoretical variance: 2.100
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_63_1.png" alt="png"></p>
<h2 id="指数随机变量exponential-random-variables">指数随机变量（Exponential Random Variables）</h2>
<p><strong>连续型</strong>随机变量。<strong>指数分布</strong>可以用来建模平均发生率恒定、连续、独立的事件发生的间隔。</p>
<p><strong>数学定义</strong></p>
<p>对于一个参数为 $\lambda > 0$ 的指数分布 $X \sim \text{Exp}(\lambda)$：</p>
<ul>
<li>
<p>支持集（取值范围，值域）是：$X \in [0, \infty]$</p>
</li>
<li>
<p>概率密度函数（PDF）：</p>
$$
  f_X(x) = \begin{cases}
    \lambda e^{-\lambda x}, & x \geq 0 \\
    0, & x < 0
    \end{cases}
  $$</li>
<li>
<p>累积分布函数（CDF）：</p>
$$
  F_X(x) = \begin{cases}
    1 - e^{-\lambda x}, & x \geq 0 \\
    0, & x < 0
    \end{cases}
  $$</li>
<li>
<p>期望（$\mu$）：$\frac{1}{\lambda}$</p>
</li>
<li>
<p>方差（$\sigma^2$）：$\frac{1}{\lambda^2}$</p>
</li>
</ul>
<p><strong>参考：</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Exponential_distribution">Wiki: Exponential distribution</a></li>
<li><a href="https://proofwiki.org/wiki/Expectation_of_Exponential_Distribution">ProofWiki: Expectation of Exponential Distribution</a></li>
<li><a href="https://proofwiki.org/wiki/Variance_of_Exponential_Distribution">ProofWiki: Variance of Exponential Distribution</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置随机种子以保证可重复性</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 指数分布参数 λ（速率参数）</span>
</span></span><span style="display:flex;"><span>lambda_val <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样数量</span>
</span></span><span style="display:flex;"><span>n_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 numpy 采样</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>exponential(scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>lambda_val, size<span style="color:#f92672">=</span>n_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建图形</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制采样的直方图（归一化为密度）</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Histogram&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成理论曲线</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, np<span style="color:#f92672">.</span>max(samples), <span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>pdf <span style="color:#f92672">=</span> lambda_val <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>lambda_val <span style="color:#f92672">*</span> x_vals)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_vals, pdf, <span style="color:#e6db74">&#39;r-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Theoretical PDF (λ=</span><span style="color:#e6db74">{</span>lambda_val<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
</span></span><span style="display:flex;"><span>a, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>y_vals <span style="color:#f92672">=</span> a<span style="color:#f92672">+</span>b<span style="color:#f92672">*</span>x_vals
</span></span><span style="display:flex;"><span>ypdf <span style="color:#f92672">=</span> a<span style="color:#f92672">*</span>pdf<span style="color:#f92672">+</span>b
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(y_vals, pdf, <span style="color:#e6db74">&#39;b-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Theoretical PDF (λ=</span><span style="color:#e6db74">{</span>lambda_val<span style="color:#e6db74">}</span><span style="color:#e6db74">;y=</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">*x+</span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 图形设置</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Exponential Distribution Visualization&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_65_0.png" alt="png"></p>
<h3 id="采样-4">采样</h3>
<h4 id="使用反函数法inverse-transform-sampling">使用反函数法（Inverse Transform Sampling）</h4>
<p>假设我们有一个均匀分布 $U∼Uniform(0,1)$，可以用反函数法来采样指数随机变量：</p>
<p>$ X = -\frac{ln(1-U)}{\lambda}$</p>
<p><strong>推导</strong>
$$
F(x) = 1 - e^{-\lambda x} = u\
1 - u = e^{-\lambda x} \
ln(1-u) = -\lambda x \
x = -\frac{ln(1-u)}{\lambda}</p>
<p>$$</p>
<p>👉 这个公式非常常见，也是在模拟指数分布时的基本方法。</p>
<blockquote>
<p>也可以用 <code>numpy.random.exponential(scale=1/lambda_val, size=n_samples)</code></p></blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> math
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_exponential_inverse</span>(lambda_val):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    采样指数分布
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param lambda_val: 指数分布的速率参数 λ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param n_samples: 采样数量
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 采样结果
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()  <span style="color:#75715e"># 从 [0, 1) 中采样一个均匀变量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>math<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>u) <span style="color:#f92672">/</span> lambda_val  <span style="color:#75715e"># 使用逆变换采样公式 X = -ln(1-U)/λ</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_exponential_inverse_list</span>(lambda_val, n_samples):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_exponential_inverse(lambda_val) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 参数设置</span>
</span></span><span style="display:flex;"><span>lambda_val <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用反函数法采样</span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> sample_exponential_inverse_list(lambda_val, n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 验证：绘图</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(X, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Histogram&#39;</span>)
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_vals, lambda_val <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>lambda_val <span style="color:#f92672">*</span> x_vals), <span style="color:#e6db74">&#39;r-&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True PDF&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;X&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;PDF&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Exponential Distribution (λ = </span><span style="color:#e6db74">{:.1f}</span><span style="color:#e6db74">, n = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">)&#39;</span><span style="color:#f92672">.</span>format(lambda_val, n))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_68_0.png" alt="png"></p>
<h2 id="几何随机变量geometric-random-variables">几何随机变量（Geometric Random Variables）</h2>
<h3 id="概述">概述</h3>
<p>它是<strong>离散型</strong>随机变量中非常经典的一个，出现在很多试验直到第一次成功的情景中。</p>
<p>一个<strong>几何随机变量</strong> $X \sim \text{Geometric}(p)$，表示：</p>
<blockquote>
<p><strong>在独立重复伯努利试验中，第一次成功出现的试验编号。</strong></p></blockquote>
<ul>
<li>每次试验都是独立的，成功概率是 $p \in (0,1)$</li>
<li>$X \in \{1, 2, 3, \dots\}$</li>
</ul>
<p><strong>📌 概率质量函数（PMF）</strong></p>
<p>几何分布的概率质量函数为：</p>
$$
P(X = k) = (1 - p)^{k - 1} \cdot p, \quad \text{for } k = 1, 2, 3, \dots
$$<p>这表示：</p>
<ul>
<li>第 $k-1$ 次都失败（概率为 $(1-p)^{k-1}$）；</li>
<li>第 $k$ 次成功（概率为 $p$）。</li>
</ul>
<p><strong>📊 举个例子</strong></p>
<p>比如你在抛一个不公平的硬币，正面（成功）的概率是 $p = 0.3$，你在等第一次出现正面：</p>
<ul>
<li>$P(X = 1) = 0.3$ （第一次就正面）</li>
<li>$P(X = 2) = 0.7 \cdot 0.3 = 0.21$（第一次反面，第二次正面）</li>
<li>$P(X = 3) = 0.7^2 \cdot 0.3 = 0.147$</li>
</ul>
<p><strong>📐 累积分布函数（CDF）</strong></p>
$$
P(X \leq k) = 1 - (1 - p)^k, k=1,2, \dots
$$<p>推导过程：
</p>
$$
F(k) = P(X \leq k) \\
= \sum^k_{i=1}P(X=i) \\
= \sum^k_{i=1}(1 - p)^{i - 1} \cdot p \\
= p\cdot\sum^k_{i=1}(1 - p)^{i - 1}
$$<p>令 $j=i-1$，则：
</p>
$$
F(k) = p\cdot\sum^k_{i=1}(1 - p)^{i - 1} \\
= p\cdot\sum^{k-1}_{j=0}(1 - p)^j \\
= p\cdot\frac{(1-p)^{k-1}-1}{(1-p)-p} \\
= 1-(1-p)^{k-1}
$$<p>🧠 解释直觉：
这个表达式表示，在前 $k$ 次试验中至少成功一次的概率。反过来说，所有前 $k$ 次都失败的概率是 $(1−p)^k$，所以 CDF 是：
</p>
$$
P(至少一次成功) = 1 - P(全部失败) = 1−(1−p)^k
$$<h4 id="-期望">📈 期望</h4>
<p><strong>期望值</strong>（Mean）：</p>
$$
\mathbb{E}[X] = \frac{1}{p}
$$<p><strong>🎯 推导期望 $\mathbb{E}[X]$</strong></p>
<p>我们要计算：</p>
$$
\mathbb{E}[X] = \sum_{k=1}^{\infty} k \cdot (1 - p)^{k-1} \cdot p
$$<p>令 $q = 1 - p$，则变为：</p>
$$
\mathbb{E}[X] = p \sum_{k=1}^{\infty} k q^{k-1}
$$<p>这是一个经典级数：</p>
$$
\sum_{k=1}^{\infty} k q^{k-1} = \frac{1}{(1 - q)^2}
\quad \text{(当 } |q| < 1 \text{)}
$$<p>代入：</p>
$$
\mathbb{E}[X] = p \cdot \frac{1}{(1 - q)^2} = p \cdot \frac{1}{p^2} = \frac{1}{p}
$$<h4 id="-方差">📈 方差</h4>
<p><strong>方差</strong>（Variance）：</p>
$$
\text{Var}(X) = \frac{1 - p}{p^2}
$$<p><strong>📊 推导方差 $\mathrm{Var}(X)$</strong></p>
<p>我们使用公式：</p>
$$
\mathrm{Var}(X) = \mathbb{E}[X^2] - \left(\mathbb{E}[X]\right)^2
$$<p><strong>1️⃣ 推导 $\mathbb{E}[X^2]$</strong></p>
<p>我们要算：</p>
$$
\mathbb{E}[X^2] = \sum_{k=1}^{\infty} k^2 \cdot q^{k-1} \cdot p
= p \cdot \sum_{k=1}^{\infty} k^2 q^{k-1}
$$<p>这是一个已知级数（你可以从公式手册中找到）：</p>
$$
\sum_{k=1}^{\infty} k^2 q^{k-1} = \frac{1 + q}{(1 - q)^3}
$$<p>代入得：</p>
$$
\mathbb{E}[X^2] = p \cdot \frac{1 + q}{(1 - q)^3}
= p \cdot \frac{1 + (1 - p)}{p^3}
= p \cdot \frac{2 - p}{p^3}
= \frac{2 - p}{p^2}
$$<p><strong>2️⃣ 代入方差公式</strong></p>
$$
\mathrm{Var}(X) = \mathbb{E}[X^2] - (\mathbb{E}[X])^2
= \frac{2 - p}{p^2} - \left( \frac{1}{p} \right)^2
= \frac{2 - p - 1}{p^2}
= \frac{1 - p}{p^2}
$$<h4 id="-应用场景举例">💡 应用场景举例</h4>
<ul>
<li>抛硬币直到第一次正面</li>
<li>某机器第一次成功响应的次数</li>
<li>网络中等待第一个成功包到达</li>
<li>马尔科夫链中的第一次跳转时间</li>
</ul>
<p><strong>🧠 小结</strong></p>
<table>
  <thead>
      <tr>
          <th>属性</th>
          <th>几何随机变量</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>类型</td>
          <td>离散型</td>
      </tr>
      <tr>
          <td>取值</td>
          <td>正整数 $\{1,2,3,\dots\}$</td>
      </tr>
      <tr>
          <td>核心思想</td>
          <td>第一次成功的试验编号</td>
      </tr>
      <tr>
          <td>PMF</td>
          <td>$P(X = k) = (1 - p)^{k - 1} \cdot p$</td>
      </tr>
      <tr>
          <td>CDF</td>
          <td>$1 - (1 - p)^k$</td>
      </tr>
      <tr>
          <td>期望</td>
          <td>$\frac{1}{p}$</td>
      </tr>
      <tr>
          <td>方差</td>
          <td>$\frac{1-p}{p^2}$</td>
      </tr>
      <tr>
          <td>采样</td>
          <td>模拟伯努利序列，或用反函数采样法</td>
      </tr>
  </tbody>
</table>
<p><strong>参考：</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Geometric_distribution">Wiki: Geometric distribution</a></li>
<li><a href="https://proofwiki.org/wiki/Geometric_Distribution_Gives_Rise_to_Probability_Mass_Function">ProofWiki: Geometric Distribution Gives Rise to Probability Mass Function</a></li>
<li><a href="https://math.stackexchange.com/questions/2161184/solving-for-the-cdf-of-the-geometric-probability-distribution">Stackexchange: Solving for the CDF of the Geometric Probability Distribution</a></li>
<li><a href="https://proofwiki.org/wiki/Expectation_of_Geometric_Distribution">ProofWiki: Expectation of Geometric Distribution</a></li>
<li><a href="https://proofwiki.org/wiki/Variance_of_Geometric_Distribution">ProofWiki: Variance of Geometric Distribution</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> scipy.stats <span style="color:#66d9ef">as</span> stats
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置随机种子以保证结果可重复</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. 定义参数</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>values <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> len(values)
</span></span><span style="display:flex;"><span>pmf <span style="color:#f92672">=</span> stats<span style="color:#f92672">.</span>geom(p)<span style="color:#f92672">.</span>pmf(values)
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(pmf)  <span style="color:#75715e"># 累积分布函数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 抽样</span>
</span></span><span style="display:flex;"><span>n_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>geometric(p<span style="color:#f92672">=</span>p, size<span style="color:#f92672">=</span>n_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 可视化：理论分布 + 采样频率对比</span>
</span></span><span style="display:flex;"><span>plot_discrete_rv(values, pmf, cdf, samples, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Geometric(p=</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_70_0.png" alt="png"></p>
<h3 id="采样-5">采样</h3>
<p><strong>采样方法对比</strong></p>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>原理</th>
          <th>效率</th>
          <th>优缺点</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>伯努利模拟</td>
          <td>模拟每次试验</td>
          <td>低</td>
          <td>直观但慢，适合教学</td>
      </tr>
      <tr>
          <td>反函数采样</td>
          <td>CDF 反函数</td>
          <td>高</td>
          <td>适合数学背景好者</td>
      </tr>
      <tr>
          <td>查表法</td>
          <td>CDF + 查找</td>
          <td>高</td>
          <td>重复采样快，需预处理</td>
      </tr>
      <tr>
          <td>NumPy 内建</td>
          <td>高效算法</td>
          <td>高</td>
          <td>工程实用，但略黑箱</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy <span style="color:#f92672">import</span> stats
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_geometric_sample</span>(p, samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    验证几何分布采样的正确性
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param samples: 采样结果列表（值域应为 1, 2, 3, ...）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: None
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    N <span style="color:#f92672">=</span> len(samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 均值与方差验证</span>
</span></span><span style="display:flex;"><span>    empirical_mean <span style="color:#f92672">=</span> sum(samples) <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>    theoretical_mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> p
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical mean: </span><span style="color:#e6db74">{</span>empirical_mean<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, Theoretical mean: </span><span style="color:#e6db74">{</span>theoretical_mean<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    empirical_variance <span style="color:#f92672">=</span> sum((x <span style="color:#f92672">-</span> empirical_mean) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> samples) <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>    theoretical_variance <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p) <span style="color:#f92672">/</span> (p <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical variance: </span><span style="color:#e6db74">{</span>empirical_variance<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, Theoretical variance: </span><span style="color:#e6db74">{</span>theoretical_variance<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 统计最大值作为绘图范围</span>
</span></span><span style="display:flex;"><span>    k_max <span style="color:#f92672">=</span> max(samples)
</span></span><span style="display:flex;"><span>    ks <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">1</span>, k_max <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 统计频率（经验 PMF）</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter
</span></span><span style="display:flex;"><span>    counter <span style="color:#f92672">=</span> Counter(samples)
</span></span><span style="display:flex;"><span>    counts <span style="color:#f92672">=</span> [counter<span style="color:#f92672">.</span>get(k, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">/</span> N <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> ks]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 理论 PMF</span>
</span></span><span style="display:flex;"><span>    theoretical <span style="color:#f92672">=</span> stats<span style="color:#f92672">.</span>geom(p)<span style="color:#f92672">.</span>pmf(ks)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>bar([k <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.2</span> <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> ks], counts, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Frequency&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>bar([k <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.2</span> <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> ks], theoretical, width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Theoretical PMF&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, align<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Number of Trials Until First Success (k)&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Probability&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Geometric Distribution Verification (p=</span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><h4 id="方法-1利用-numpy-内置函数">方法 1：利用 NumPy 内置函数</h4>
<p>NumPy 已内置 Geometric 分布采样</p>
<ul>
<li>✅ <strong>优点</strong>：高性能、简洁</li>
<li>❌ <strong>缺点</strong>：适合工程使用，学习原理时不推荐直接使用</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>geometric(p<span style="color:#f92672">=</span>p, size<span style="color:#f92672">=</span>n)<span style="color:#f92672">.</span>tolist()
</span></span><span style="display:flex;"><span>verify_geometric_sample(p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.276, Theoretical mean: 3.333
Empirical variance: 7.363, Theoretical variance: 7.778
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_74_1.png" alt="png"></p>
<h4 id="方法-2反函数采样法">方法 2：反函数采样法</h4>
<p>几何分布有一个封闭形式（close-form）的 CDF，因此可以使用<strong>反函数采样法</strong>（inverse transform sampling）：</p>
$$
X = \left\lceil \frac{\log(1 - U)}{\log(1 - p)} \right\rceil
\quad \text{其中 } U \sim \text{Uniform}(0, 1)
$$<p><strong>原理：</strong></p>
<p>利用 Geometric 分布的 CDF（$F(x) \sim \text{Uniform}(0,1)$）：</p>
$$
F(k) = 1 - (1 - p)^k
$$<p>如果我们从 $U \sim \text{Uniform}(0,1)$ 中得到一个值 $u$，那么有 $1-(1-p)^{i-1} \lt u \le 1-(1-p)^{i} $，其中，$i$ 就是我们要的采样值。我们可以推导出一个封闭形式：
</p>
$$
1-(1-p)^{i-1} \lt u \le 1-(1-p)^{i} \\
-1+(1-p)^{i-1} \gt -u \ge -1+(1-p)^{i} \\
(1-p)^{i-1} \gt 1-u \ge (1-p)^{i} \\
ln((1-p)^{i-1}) \gt ln(1-u) \ge ln((1-p)^{i}) \\
(i-1)\cdot ln(1-p) \gt ln(1-u) \ge i\cdot ln(1-p) \\
i-1 \lt \frac{ln(1-u)}{ln(1-p)} \le i
$$<p>因此，$i = int(\frac{ln(1-u)}{ln(1-p)}) + 1$，其中，$int$ 表示实数部分的整数部分</p>
<p>即：</p>
$$
k = \left\lceil \frac{\log(1 - U)}{\log(1 - p)} \right\rceil
$$<p>其中 $U \sim \text{Uniform}(0,1)$</p>
<blockquote>
<p>实际中，因为 $1 - U$ 与 $U$ 在分布上一致，所以常写为：</p></blockquote>
$$
k = \left\lceil \frac{\log(U)}{\log(1 - p)} \right\rceil
$$<p><strong>优劣：</strong></p>
<ul>
<li>✅ <strong>优点</strong>：效率高，单次采样常数时间</li>
<li>✅ <strong>适合低 $p$</strong> 值时使用</li>
<li>❌ <strong>缺点</strong>：需要计算对数函数，可能略慢于查表法</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_geometric_inverse</span>(p):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    使用逆变换法采样几何分布
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 采样结果
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># 从 [0, 1) 中采样一个均匀变量</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> int(np<span style="color:#f92672">.</span>ceil(np<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> u) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p)))  <span style="color:#75715e"># 使用逆变换公式</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_geometric_inverse_list</span>(p, n_samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    生成几何分布的采样列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param n_samples: 采样数量
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 采样结果列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_geometric_inverse(p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_geometric_inverse_list(p, n)
</span></span><span style="display:flex;"><span>verify_geometric_sample(p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.396, Theoretical mean: 3.333
Empirical variance: 8.143, Theoretical variance: 7.778
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_77_1.png" alt="png"></p>
<h4 id="方法-3查表法cdf-table-lookup">方法 3：查表法（CDF Table Lookup）</h4>
<p><strong>原理：</strong>
提前构建 CDF 表（PMF 累加），再用 Uniform 变量查找对应区间。</p>
<p><strong>步骤：</strong></p>
<ol>
<li>给定 $p$，计算前 $N$ 个概率和 $\text{CDF}(k)$</li>
<li>生成 $U \sim \text{Uniform}(0, 1)$</li>
<li>找到最小的 $k$，使得 $\text{CDF}(k) \geq U$</li>
</ol>
<p><strong>优劣：</strong></p>
<ul>
<li>✅ <strong>优点</strong>：采样快速（O(N) 或更快如二分查找）</li>
<li>✅ <strong>适合重复采样场景</strong></li>
<li>❌ <strong>缺点</strong>：需要预存 CDF 表（内存占用）</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_cdf_table</span>(p, max_k<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    cdf <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    total <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, max_k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        prob <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> p) <span style="color:#f92672">**</span> (k <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> p
</span></span><span style="display:flex;"><span>        total <span style="color:#f92672">+=</span> prob
</span></span><span style="display:flex;"><span>        cdf<span style="color:#f92672">.</span>append(total)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cdf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_geometric_lookup</span>(cdf_table):
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, value <span style="color:#f92672">in</span> enumerate(cdf_table):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;=</span> value:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> len(cdf_table)  <span style="color:#75715e"># fallback</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_geometric_lookup_list</span>(p, n_samples, max_k<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>    cdf_table <span style="color:#f92672">=</span> build_cdf_table(p, max_k)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_geometric_lookup(cdf_table) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_geometric_lookup_list(p, n)
</span></span><span style="display:flex;"><span>verify_geometric_sample(p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.371, Theoretical mean: 3.333
Empirical variance: 7.935, Theoretical variance: 7.778
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_80_1.png" alt="png"></p>
<h4 id="方法-4伯努利试验模拟法bernoulli-trial-simulation">方法 4：伯努利试验模拟法（Bernoulli Trial Simulation）</h4>
<p><strong>原理</strong>：从 $X \sim \text{Geometric}(p)$ 的定义出发：它表示<strong>第一个成功出现的位置</strong>。因此，只要重复投掷伯努利(p)分布的硬币，直到第一次出现“成功”（即为 1）。</p>
<p><strong>步骤：</strong></p>
<ol>
<li>初始化计数器 $k = 1$</li>
<li>重复生成 $U \sim \text{Uniform}(0, 1)$</li>
<li>如果 $1-p \le U \le 1$，表示成功，返回 $k$</li>
<li>否则 $k \leftarrow k + 1$，重复</li>
</ol>
<p><strong>优劣：</strong></p>
<ul>
<li>✅ <strong>优点</strong>：原理直观，适合教学演示</li>
<li>❌ <strong>缺点</strong>：当 $p$ 很小时，可能需要很多次迭代，效率低</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_geometric_mimic</span>(p):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    模拟几何分布采样
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 采样结果
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()  <span style="color:#75715e"># 从 [0, 1) 中采样一个均匀变量</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>p <span style="color:#f92672">&lt;=</span>u <span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">1</span>:  <span style="color:#75715e"># 成功</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> k
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># 失败，增加计数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_geometric_mimic_list</span>(p, n_samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    生成几何分布的采样列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param p: 成功概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param n_samples: 采样数量
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 采样结果列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [sample_geometric_mimic(p) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples)]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_geometric_mimic_list(p, N)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>verify_geometric_sample(p, samples)
</span></span></code></pre></div><pre><code>Empirical mean: 3.339, Theoretical mean: 3.333
Empirical variance: 7.983, Theoretical variance: 7.778
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_83_1.png" alt="png"></p>
<h2 id="正态随机变量normal-random-variables">正态随机变量（Normal Random Variables）</h2>
<h3 id="基础知识">基础知识</h3>
<p>正态分布（Normal Distribution），也叫<strong>高斯分布</strong>，是一种<strong>连续型概率分布</strong>，在统计学中非常重要，是<strong>中心极限定理</strong>的核心分布。它的曲线呈<strong>钟形对称</strong>，在自然界与工程领域中频繁出现。</p>
<h4 id="-概率密度函数pdf">📐 概率密度函数（PDF）</h4>
<p>正态分布的概率密度函数如下：</p>
$$
f(x; \mu, \sigma) = \frac{1}{\sqrt{2\pi \sigma^2}} \exp\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
$$<ul>
<li>$\mu$：均值（位置参数，决定峰值中心）</li>
<li>$\sigma^2$：方差（尺度参数，决定曲线宽度）</li>
<li>$\sigma$：标准差</li>
</ul>
<h4 id="特殊情况标准正态分布">特殊情况：标准正态分布</h4>
<p>当 $\mu = 0, \sigma = 1$ 时：</p>
$$
f(x) = \frac{1}{\sqrt{2\pi}} \exp\left(-\frac{x^2}{2}\right)
$$<h4 id="-形状与特性">📈 形状与特性</h4>
<ul>
<li>
<p><strong>对称性</strong>：关于 $\mu$ 对称</p>
</li>
<li>
<p><strong>单峰性</strong>：均值处最高点</p>
</li>
<li>
<p><strong>左右尾巴无限延伸，但总面积为 1</strong></p>
</li>
<li>
<p><strong>68-95-99.7 规则（经验法则）</strong>：</p>
<ul>
<li>约 68% 的概率集中在 $\mu \pm \sigma$</li>
<li>约 95% 的概率集中在 $\mu \pm 2\sigma$</li>
<li>约 99.7% 的概率集中在 $\mu \pm 3\sigma$</li>
</ul>
</li>
</ul>
<h4 id="-期望与方差的推导标准正态">🧮 期望与方差的推导（标准正态）</h4>
<ul>
<li><strong>期望</strong>：</li>
</ul>
$$
\mathbb{E}[X] = \int_{-\infty}^{\infty} x \cdot f(x) \, dx = 0
$$<ul>
<li><strong>方差</strong>：</li>
</ul>
$$
\mathbb{V}[X] = \mathbb{E}[X^2] = \int_{-\infty}^{\infty} x^2 \cdot f(x) \, dx = 1
$$<p>这些推导需要用到对称性和高斯积分技巧（如换元法或配方法）。</p>
<h4 id="-正态分布的来源与直觉理解中心极限定理clt">🧪 正态分布的来源与直觉理解：<a href="https://en.wikipedia.org/wiki/Central_limit_theorem">中心极限定理（CLT）</a></h4>
<blockquote>
<p><strong>多个独立随机变量的平均值在 n 趋于无穷大时趋于正态分布</strong>，无论原始分布是什么。</p></blockquote>
<p>令 $\{X_{1},\ldots ,X_{n}\}$ 是一个<a href="https://zh.wikipedia.org/wiki/%E7%8B%AC%E7%AB%8B%E5%90%8C%E5%88%86%E5%B8%83">独立同分布（i.i.d）</a>的随机变量序列，它们满足的分布的期望值为$\mu$，方差为 $\sigma ^{2}$。</p>
<p>那么，其<strong>样本均值</strong>为：${\bar {X}}_{n}\equiv {\frac {X_{1}+\cdots +X_{n}}{n}}$。根据大数定理，</p>
<p>这也是为什么正态分布在自然现象中如此普遍：温度、身高误差、测量误差、考试成绩等。</p>
<h4 id="-应用场景">🧠 应用场景</h4>
<ul>
<li>测量误差建模</li>
<li>机器学习中的高斯假设</li>
<li>贝叶斯推理中的先验 / 似然</li>
<li>股票收益建模（粗略）</li>
<li>数据生成 / 模拟 / MC 方法基础分布</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> norm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>pdf <span style="color:#f92672">=</span> norm<span style="color:#f92672">.</span>pdf(x, loc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, pdf, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Standard Normal PDF&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>fill_between(x, pdf, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Standard Normal Distribution&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Probability Density&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_86_0.png" alt="png"></p>
<h3 id="从标准正态随机变量standard-normal-rv中采样">从标准正态随机变量（Standard Normal RV）中采样</h3>
<p>标准正态分布是均值 $\mu = 0$，标准差 $\sigma = 1$ 的正态分布：</p>
$$
f_Z(z) = \frac{1}{\sqrt{2\pi}} \exp\left(-\frac{z^2}{2}\right)
$$<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>原理</th>
          <th>是否推荐</th>
          <th>是否快速</th>
          <th>备注</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>np.random.normal</code></td>
          <td>内置库</td>
          <td>✅</td>
          <td>✅</td>
          <td>最方便</td>
      </tr>
      <tr>
          <td>Box-Muller</td>
          <td>极坐标变换</td>
          <td>✅</td>
          <td>✅</td>
          <td>原理直观，适合教学</td>
      </tr>
      <tr>
          <td>Inverse CDF</td>
          <td>反函数采样</td>
          <td>❌</td>
          <td>❌</td>
          <td>无解析解，需近似或查表</td>
      </tr>
      <tr>
          <td>中心极限定理</td>
          <td></td>
          <td></td>
          <td></td>
          <td>简单直观，教学友好，但精度有限，不适用于高精度模拟</td>
      </tr>
      <tr>
          <td>Rejection Sampling</td>
          <td>接受拒绝机制</td>
          <td>⚠️</td>
          <td>❌</td>
          <td>通用性强，效率低</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> norm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_standard_normal_sample</span>(samples):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    验证标准正态分布采样的正确性
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param samples: 从 N(0,1) 中采样的结果 (list or array)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    N <span style="color:#f92672">=</span> len(samples)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 经验统计量</span>
</span></span><span style="display:flex;"><span>    empirical_mean <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(samples)
</span></span><span style="display:flex;"><span>    empirical_var <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>var(samples)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 理论统计量</span>
</span></span><span style="display:flex;"><span>    theoretical_mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    theoretical_var <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical mean: </span><span style="color:#e6db74">{</span>empirical_mean<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | Theoretical mean: </span><span style="color:#e6db74">{</span>theoretical_mean<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Empirical var: </span><span style="color:#e6db74">{</span>empirical_var<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> | Theoretical var: </span><span style="color:#e6db74">{</span>theoretical_var<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 直方图 + 理论 PDF</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Histogram&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(x, norm<span style="color:#f92672">.</span>pdf(x, loc<span style="color:#f92672">=</span>theoretical_mean, scale<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>sqrt(theoretical_var)), <span style="color:#e6db74">&#39;r-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Theoretical PDF&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;PDF Comparison&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 经验 CDF vs 理论 CDF</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    sorted_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sort(samples)
</span></span><span style="display:flex;"><span>    empirical_cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, N<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(sorted_samples, empirical_cdf, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Empirical CDF&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>plot(x, norm<span style="color:#f92672">.</span>cdf(x, loc<span style="color:#f92672">=</span>theoretical_mean, scale<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>sqrt(theoretical_var)), <span style="color:#e6db74">&#39;r--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Theoretical CDF&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;CDF Comparison&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;CDF&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><h4 id="-方法一用-numpy-直接采样最方便">✅ 方法一：用 NumPy 直接采样（最方便）</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(loc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># verify the sampling results</span>
</span></span><span style="display:flex;"><span>verify_standard_normal_sample(samples)
</span></span></code></pre></div><pre><code>Empirical mean: 0.0045 | Theoretical mean: 0
Empirical var: 0.9778 | Theoretical var: 1
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_90_1.png" alt="png"></p>
<h4 id="-方法二box-muller-变换经典方法">✅ 方法二：Box-Muller 变换（经典方法）</h4>
<p>Box-Muller 变换（<a href="https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform">Box-Muller transform</a>）是一种<strong>从均匀分布采样两个变量，生成两个独立标准正态随机变量</strong>的方法。这个方法是构造性的、非近似的（不像中心极限定理那样是逼近）。</p>
<p><strong>🧠 背后思想：</strong></p>
<p>我们希望从两个<strong>独立</strong>的标准正态分布 $\mathcal{N}(0, 1)$ 中采样出变量 $Z_1$ 和 $Z_2$。</p>
<p>我们已知无法直接从正态分布中采样，但我们可以很容易地从均匀分布中采样两个变量 $U_1, U_2 \sim \text{Uniform}(0, 1)$，然后通过<strong>变量变换</strong>得到 $Z_1, Z_2$。</p>
<p><strong>🧮 数学推导核心步骤</strong></p>
<p>Step 1：将正态分布转为极坐标</p>
<p>2维独立标准正态分布的联合概率密度函数为：</p>
$$
f_{XY}(x, y) = f_X(x)f_Y(y) = \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}} \cdot \frac{1}{\sqrt{2\pi}} e^{-\frac{y^2}{2}} = \frac{1}{2\pi} e^{-\frac{x^2 + y^2}{2}}
$$<p>如果我们用<a href="https://zh.wikipedia.org/zh-hans/%E6%9E%81%E5%9D%90%E6%A0%87%E7%B3%BB">极坐标</a>表示 $x = r\cos\theta, y = r\sin\theta$，则：</p>
$$
f(r, \theta) = f(x,y) \cdot |J| = \frac{1}{2\pi} e^{-\frac{r^2}{2}} \cdot r
$$<p>其中 $|J| = r$ 是雅可比行列式（面积拉伸），也就是说：</p>
$$
f_{R,\Theta}(r, \theta) = \underbrace{r e^{-r^2/2}}_{\text{与 } r \text{ 有关}} \cdot \underbrace{\frac{1}{2\pi}}_{\text{与 } \theta \text{ 有关}}
$$<blockquote>
<p>这表示 $R$ 和 $\Theta$ 是<strong>相互独立</strong>的随机变量！</p></blockquote>
<p>所以联合 pdf 变成：</p>
$$
f(r, \theta) = \frac{r}{2\pi} e^{-\frac{r^2}{2}} \quad \text{for } r \in [0, \infty), \theta \in [0, 2\pi)
$$<p>Step 2：构造采样变量</p>
<p>所以我们只需要想办法分别从以下两个分布中采样：</p>
<ul>
<li>$\Theta \sim \text{Uniform}(0, 2\pi)$</li>
<li>$R \sim \text{PDF } f_R(r) = r e^{-r^2/2},\quad r \geq 0$</li>
</ul>
<p>我们看 $R$ 的分布：</p>
$$
f_R(r) = r e^{-r^2/2}
$$<p>对比：设 $U_1 \sim \text{Uniform}(0,1)$，我们令：</p>
$$
R = \sqrt{-2 \ln U_1}
$$<p>我们可以反向验证：这个 R 的分布的概率密度函数正是：</p>
$$
f_R(r) = \frac{d}{dr} \mathbb{P}(R \leq r) = \frac{d}{dr} \mathbb{P}(U_1 \geq e^{-r^2/2}) = \frac{d}{dr} \left( 1 - e^{-r^2/2} \right) = r e^{-r^2/2}
$$<p>所以这个变量变换是正确的。</p>
<p>另一方面，在二维正态联合分布下，角度方向是均匀的：</p>
$$
f_\Theta(\theta) = \frac{1}{2\pi},\quad \theta \in [0, 2\pi)
$$<p>所以只需要一个均匀分布 $U_2 \sim \text{Uniform}(0,1)$，通过线性缩放即可：</p>
$$
\Theta = 2\pi U_2
$$<p><strong>✅ 最终变换</strong></p>
<p>将 $R = \sqrt{-2 \ln U_1}$，$\Theta = 2\pi U_2$ 带入：</p>
$$
Z_1 = R \cos\Theta = \sqrt{-2 \ln U_1} \cdot \cos(2\pi U_2) \\
Z_2 = R \sin\Theta = \sqrt{-2 \ln U_1} \cdot \sin(2\pi U_2)
$$<p>这两个变量就是我们希望得到的<strong>独立标准正态变量</strong>。</p>
<p><strong>📌 Box-Muller 的优点和缺点</strong></p>
<table>
  <thead>
      <tr>
          <th>优点</th>
          <th>缺点</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>数学严谨，生成值精确服从正态分布</td>
          <td>需要使用对数和三角函数，较慢</td>
      </tr>
      <tr>
          <td>每次采样两个正态样本</td>
          <td>不适合嵌入式设备、GPU 等需性能优化场合</td>
      </tr>
      <tr>
          <td>适用于理解极坐标变换与正态分布的关系</td>
          <td>不能高效矢量化为 SIMD 代码</td>
      </tr>
  </tbody>
</table>
<p><strong>🚀 小结</strong></p>
<p>Box-Muller 是一个 <strong>理论完美</strong> 的标准正态分布采样方法，具有如下特点：</p>
<ul>
<li>利用两个独立的 $U(0,1)$ 样本</li>
<li>构造两个 $\mathcal{N}(0,1)$ 独立样本</li>
<li>变换方式基于二维极坐标系统和雅可比推导</li>
<li>是一种标准的“从简单分布变换为复杂分布”的经典案例</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> norm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">box_muller_sample</span>(n_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>, visualize<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 1: 生成两个均匀分布变量</span>
</span></span><span style="display:flex;"><span>    U1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, n_samples)
</span></span><span style="display:flex;"><span>    U2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, n_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 2: Box-Muller变换</span>
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>log(U1))
</span></span><span style="display:flex;"><span>    theta <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>pi <span style="color:#f92672">*</span> U2
</span></span><span style="display:flex;"><span>    Z1 <span style="color:#f92672">=</span> R <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>cos(theta)
</span></span><span style="display:flex;"><span>    Z2 <span style="color:#f92672">=</span> R <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sin(theta)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> visualize:
</span></span><span style="display:flex;"><span>        num_bins <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>hist(Z1, bins<span style="color:#f92672">=</span>num_bins, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Z1&#39;</span>)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>plot(x, norm<span style="color:#f92672">.</span>pdf(x), <span style="color:#e6db74">&#39;r--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Standard Normal PDF&#39;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Z1 ~ N(0,1)&#34;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>hist(Z2, bins<span style="color:#f92672">=</span>num_bins, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Z2&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>plot(x, norm<span style="color:#f92672">.</span>pdf(x), <span style="color:#e6db74">&#39;r--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Standard Normal PDF&#39;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Z2 ~ N(0,1)&#34;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>suptitle(<span style="color:#e6db74">&#34;Box-Muller Sampling of Standard Normal Distribution&#34;</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Z1, Z2
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>box_muller_sample(n_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>, visualize<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_93_0.png" alt="png"></p>
<pre><code>(array([ 1.48779139,  0.98464068, -0.80586692, ..., -0.52369914,
        -0.56467099, -2.07728924], shape=(10000,)),
 array([ 1.22339848, -0.80627553,  0.55483184, ..., -1.4385899 ,
         2.53391275, -0.82037306], shape=(10000,)))
</code></pre>
<h4 id="-方法三反函数采样法理论可行实际但不可行">✅ 方法三：反函数采样法（理论可行，实际但不可行）</h4>
<ul>
<li>
<p>用反函数采样法：设 $U \sim \text{Uniform}(0,1)$，则令：</p>
$$
  Z = F^{-1}(U)
  $$<p>其中 $F$ 是正态分布的 CDF，$F^{-1}$ 是它的反函数（即分位数函数 / probit 函数）。</p>
</li>
<li>
<p><strong>问题</strong>：标准正态分布的 CDF 没有解析反函数，所以<strong>不能用基本函数表达</strong>，但可以通过查表或近似（如 Beasley-Springer 算法）。</p>
</li>
</ul>
<h4 id="-方法四利用中心极限定理central-limit-theorem-clt-进行采样">✅ 方法四：利用中心极限定理（Central Limit Theorem, CLT） 进行采样</h4>
<p>使用 <strong>中心极限定理（Central Limit Theorem, CLT）</strong> 进行采样，是一种经典且直观的方式来生成近似 <strong>标准正态分布</strong> 的样本。这种方法常用于教学演示，原理简单，但在实际高精度模拟中不常用。</p>
<p><strong>🧠 Step-by-step：为什么 CLT 可以用来采样标准正态分布</strong></p>
<p>我们以如下问题为目标：</p>
<blockquote>
<p>能否通过一组简单的<strong>独立随机变量</strong>（例如均匀分布）来构造一个近似服从标准正态分布 $\mathcal{N}(0, 1)$ 的变量？</p></blockquote>
<p>答案是：<strong>可以！</strong> 这就是中心极限定理的威力。</p>
<p><strong>🎯 Step 1: 中心极限定理的核心内容</strong></p>
<blockquote>
<p><strong>中心极限定理（CLT）</strong>：
假设你有一组独立同分布（i.i.d）的随机变量 $X_1, X_2, \dots, X_n$，每个变量的期望值为 $\mu$，方差为 $\sigma^2$。那么：</p></blockquote>
$$
Z_n = \frac{\sum_{i=1}^n X_i - n\mu}{\sqrt{n\sigma^2}} \xrightarrow{d} \mathcal{N}(0,1)
$$<p>当 $n \to \infty$，这个标准化的和（或者平均值）<strong>在分布上趋近于标准正态分布</strong>。</p>
<p><strong>📌 Step 2: 用均匀分布来举例说明</strong></p>
<p>我们选一个简单的分布，例如 <strong>Uniform(0, 1)</strong> 分布：</p>
<ul>
<li>它的期望 $\mu = 0.5$</li>
<li>它的方差 $\sigma^2 = \frac{1}{12}$</li>
</ul>
<p>我们采样 $n$ 个这样的变量 $U_1, \dots, U_n$，然后构造如下变量：</p>
$$
Z = \frac{\sum_{i=1}^n U_i - n\mu}{\sqrt{n\sigma^2}} = \frac{\sum_{i=1}^n (U_i - 0.5)}{\sqrt{n \cdot \frac{1}{12}}}
$$<p>也就是说：</p>
$$
Z = \sum_{i=1}^n (U_i - 0.5) \cdot \sqrt{12 / n}
$$<p>这个变量 $Z$ 会越来越接近标准正态分布。</p>
<blockquote>
<p>$n$的取值取决于所选择的分布。对于均匀分布，$n$的值可以很小就可以快速收敛。</p></blockquote>
<p><strong>🧪 Step 3: 实验演示构造过程</strong></p>
<p>设 $n = 12$，那么：</p>
$$
Z = \sum_{i=1}^{12} (U_i - 0.5)
$$<p>为什么乘 $\sqrt{12}$？</p>
<p>因为：</p>
<ul>
<li>每个 $U_i - 0.5$ 是均值为 0、方差为 $1/12$ 的变量；</li>
<li>相加之后的和方差为 $n \cdot \frac{1}{12}$，</li>
<li>为了标准化（变成方差为 1 的变量），要乘以 $\frac{1}{\sqrt{n \cdot \frac{1}{12}}} = \sqrt{12 / n}$。</li>
</ul>
<p><strong>✨ 对于标准正态采样：</strong></p>
<p>我们可以使用如下构造方式：</p>
$$
Z = \frac{1}{\sqrt{n}} \sum_{i=1}^n (U_i - \mu)
$$<ul>
<li>$U_i \sim \text{Uniform}(a,b)$（或其他分布）</li>
<li>$\mu$ 是 $U_i$ 的期望，例如对 $U(0,1)$ 是 $0.5$</li>
<li>当 $n$ 越大时，$Z \approx N(0,1)$</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_normal_via_clt</span>(a<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, b<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, n<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>, num_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    利用中心极限定理从 Uniform(a, b) 采样生成近似标准正态分布的样本
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param a: Uniform 分布下界
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param b: Uniform 分布上界
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param n: 每次采样的 Uniform 个数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param num_samples: 总共生成多少个样本
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 一个近似标准正态的样本数组
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算均值和标准差</span>
</span></span><span style="display:flex;"><span>    mu <span style="color:#f92672">=</span> (a <span style="color:#f92672">+</span> b) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    sigma <span style="color:#f92672">=</span> (b <span style="color:#f92672">-</span> a) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>sqrt(<span style="color:#ae81ff">12</span>) <span style="color:#75715e"># 均匀分布的标准差</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 1: 从 Uniform(a, b) 中生成 n 个样本，重复 num_samples 次</span>
</span></span><span style="display:flex;"><span>    uniform_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(a, b, size<span style="color:#f92672">=</span>(num_samples, n))
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(uniform_samples.shape) #(num_samples, n)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Step 2: 对每一组样本求和并标准化</span>
</span></span><span style="display:flex;"><span>    sample_sums <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(uniform_samples, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#75715e"># (num_samples,)</span>
</span></span><span style="display:flex;"><span>    z_samples <span style="color:#f92672">=</span> (sample_sums <span style="color:#f92672">-</span> n <span style="color:#f92672">*</span> mu) <span style="color:#f92672">/</span> (np<span style="color:#f92672">.</span>sqrt(n) <span style="color:#f92672">*</span> sigma)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> z_samples
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> sample_normal_via_clt(a<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, b<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, n<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, num_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">100000</span>)
</span></span><span style="display:flex;"><span>verify_standard_normal_sample(samples)
</span></span></code></pre></div><pre><code>Empirical mean: 0.0034 | Theoretical mean: 0
Empirical var: 1.0084 | Theoretical var: 1
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_97_1.png" alt="png"></p>
<h4 id="-方法五拒绝采样rejection-sampling">✅ 方法五：拒绝采样（Rejection Sampling）</h4>
<ul>
<li>使用易采样的 proposal 分布（如 Cauchy、Laplace 等），通过接受率控制生成标准正态。</li>
<li>不推荐新手一开始就用，但适合了解各种采样框架。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> norm, laplace
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 目标分布: 标准正态</span>
</span></span><span style="display:flex;"><span>target_pdf <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x: norm<span style="color:#f92672">.</span>pdf(x)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># proposal: Laplace 分布</span>
</span></span><span style="display:flex;"><span>proposal_pdf <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x: laplace<span style="color:#f92672">.</span>pdf(x)
</span></span><span style="display:flex;"><span>proposal_sampler <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> size: laplace<span style="color:#f92672">.</span>rvs(size<span style="color:#f92672">=</span>size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># M 是 f(x)/q(x) 的上界，估计为最大值（略大于实际最大）</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>max(target_pdf(x_vals) <span style="color:#f92672">/</span> proposal_pdf(x_vals)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样函数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rejection_sample</span>(n):
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(samples) <span style="color:#f92672">&lt;</span> n:
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> proposal_sampler(<span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        u <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;</span> target_pdf(x) <span style="color:#f92672">/</span> (M <span style="color:#f92672">*</span> proposal_pdf(x)):
</span></span><span style="display:flex;"><span>            samples<span style="color:#f92672">.</span>append(x)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>array(samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成样本</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> rejection_sample(<span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sampled (AR)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, norm<span style="color:#f92672">.</span>pdf(x), label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Target N(0,1)&#34;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, M <span style="color:#f92672">*</span> proposal_pdf(x), <span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;M * Proposal (M=</span><span style="color:#e6db74">{</span>M<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Rejection Sampling from N(0,1)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_99_0.png" alt="png"></p>
<h1 id="随机变量的计算">随机变量的计算</h1>
<h2 id="随机变量变换random-variable-transformation">随机变量变换（Random Variable Transformation）</h2>
<h3 id="线性变换">线性变换</h3>
<p><strong>🎯 问题描述</strong></p>
<p>设：</p>
<ul>
<li>$X$ 是一个连续型随机变量，已知其概率密度函数（pdf）为 $f_X(x)$，</li>
<li>$a \neq 0$, $b \in \mathbb{R}$ 是常数，</li>
<li>定义 $Y = aX + b$，</li>
<li>求 $Y$ 的概率密度函数 $f_Y(y)$。</li>
</ul>
<p><strong>🧠 基本原理</strong></p>
<p>这是单调变换下的密度函数变换规则：</p>
$$
f_Y(y) = f_X\left( \frac{y - b}{a} \right) \cdot \left| \frac{1}{a} \right|
$$<blockquote>
<p>⚠️ 注意绝对值符号是因为 $a$ 有可能是负数。</p></blockquote>
<p><strong>📌 推导过程</strong></p>
<p>我们来系统推导一下这个公式。</p>
<p>第一步：从CDF出发</p>
<p>先求出 $Y$ 的 CDF（累积分布函数）：</p>
<ul>
<li>如果 $a > 0$：</li>
</ul>
$$
F_Y(y) = P(Y \leq y) = P(aX + b \leq y) = P\left(X \leq \frac{y - b}{a} \right) = F_X\left( \frac{y - b}{a} \right)
$$<p>然后对 $y$ 求导：</p>
$$
f_Y(y) = \frac{d}{dy} F_X\left( \frac{y - b}{a} \right) = f_X\left( \frac{y - b}{a} \right) \cdot \frac{1}{a}
$$<ul>
<li>如果 $a < 0$：</li>
</ul>
$$
F_Y(y) = P(aX + b \leq y) = P\left(X \geq \frac{y - b}{a} \right) = 1 - F_X\left( \frac{y - b}{a} \right)
$$<p>然后：</p>
$$
f_Y(y) = \frac{d}{dy} \left[ 1 - F_X\left( \frac{y - b}{a} \right) \right] = -f_X\left( \frac{y - b}{a} \right) \cdot \frac{1}{a}
$$<p>因为 $a < 0$，所以结果仍然是：</p>
$$
f_Y(y) = f_X\left( \frac{y - b}{a} \right) \cdot \left| \frac{1}{a} \right|
$$<p><strong>✅ 结论（变换公式）</strong></p>
<p>不管 $a > 0$ 还是 $a < 0$，统一公式为：</p>
$$
\boxed{
f_Y(y) = f_X\left( \frac{y - b}{a} \right) \cdot \left| \frac{1}{a} \right|
}
$$<h4 id="-示例">🧪 示例：$X \sim \text{Exponential}(\lambda)$，$Y = 2X + 3$</h4>
<p>原始 pdf：</p>
$$
f_X(x) = \lambda e^{-\lambda x}, \quad x \geq 0
$$<p>令 $Y = 2X + 3$，那么：</p>
<ul>
<li>$a = 2$, $b = 3$</li>
<li>$ f_Y(y) = f_X\left( \frac{y - 3}{2} \right) \cdot \frac{1}{2} = \lambda e^{-\lambda \cdot \frac{y - 3}{2}} \cdot \frac{1}{2}, \quad y \geq 3$</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parameters</span>
</span></span><span style="display:flex;"><span>lambda_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># parameter for Exponential distribution</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the original PDF of X ~ Exp(lambda)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f_X</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> lambda_ <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>lambda_ <span style="color:#f92672">*</span> x) <span style="color:#f92672">*</span> (x <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the transformed PDF of Y = aX + b</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f_Y</span>(y):
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> (y <span style="color:#f92672">-</span> b) <span style="color:#f92672">/</span> a
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> f_X(x) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> abs(a)) <span style="color:#f92672">*</span> (y <span style="color:#f92672">&gt;=</span> b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create x and y ranges</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>y_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Evaluate PDFs</span>
</span></span><span style="display:flex;"><span>fx_vals <span style="color:#f92672">=</span> f_X(x_vals)
</span></span><span style="display:flex;"><span>fy_vals <span style="color:#f92672">=</span> f_Y(y_vals)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_vals, fx_vals, label<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$f_X(x)$ (Exponential)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(y_vals, fy_vals, label<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$f_Y(y)$ (Transformed)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;PDF of X and Y = aX + b (a=2, b=3)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x or y&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_103_0.png" alt="png"></p>
<h3 id="非线性变换nonlinear-transformation">非线性变换（nonlinear transformation）</h3>
<p>非常好！讨论**非线性变换（nonlinear transformation）**是理解概率论与统计推理的关键部分。我们分步骤深入讲解：</p>
<p><strong>🧠 问题：非线性变换下如何求随机变量的分布？</strong></p>
<p>设：</p>
<ul>
<li>$X$ 是一个已知连续型随机变量，有密度函数 $f_X(x)$</li>
<li>定义新变量：$Y = g(X)$，其中 $g$ 是一个 <strong>可微的、严格单调的函数</strong></li>
</ul>
<p>我们想要求出 $Y$ 的概率密度函数 $f_Y(y)$。</p>
<p><strong>🧮 理论结果：变换法公式</strong></p>
<p>对于单调可微函数 $g$，有：</p>
$$
f_Y(y) = f_X\big(g^{-1}(y)\big) \cdot \left| \frac{d}{dy} g^{-1}(y) \right|
$$<p>这个公式被称作<strong>变换法（Change of Variables）<strong>或</strong>反函数法（Inverse Method）</strong>。</p>
<p><strong>✅ 步骤总结（以单调递增函数为例）</strong></p>
<ol>
<li>写出 $Y = g(X)$</li>
<li>推出反函数 $X = g^{-1}(Y)$</li>
<li>计算反函数的导数 $\frac{d}{dy} g^{-1}(y)$</li>
<li>将这些代入变换公式，得出 $f_Y(y)$</li>
</ol>
<h4 id="-举例其中">📌 举例：$Y = \sqrt{X}$，其中 $X \sim \text{Uniform}(0, 1)$</h4>
<p>我们来一步一步操作这个变换。</p>
<ol>
<li>原始变量：</li>
</ol>
$$
f_X(x) = 1, \quad 0 \le x \le 1
$$<ol start="2">
<li>非线性变换：</li>
</ol>
$$
Y = g(X) = \sqrt{X} \Rightarrow X = g^{-1}(Y) = Y^2
$$<ol start="3">
<li>求导：</li>
</ol>
$$
\frac{d}{dy} g^{-1}(y) = \frac{d}{dy} (Y^2) = 2y
$$<ol start="4">
<li>代入公式：</li>
</ol>
$$
f_Y(y) = f_X(Y^2) \cdot \left| \frac{d}{dy} Y^2 \right| = 1 \cdot 2y = 2y
$$<p>定义域：</p>
<ul>
<li>因为 $X \in [0, 1] \Rightarrow Y \in [0, 1]$</li>
</ul>
<p>所以：</p>
$$
f_Y(y) = 
\begin{cases}
2y, & 0 \le y \le 1 \\
0, & \text{otherwise}
\end{cases}
$$<p>这是一个三角形形状的密度函数！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the original PDF: X ~ Uniform(0, 1)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f_X</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>ones_like(x) <span style="color:#f92672">*</span> ((x <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;</span> (x <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the transformation: Y = sqrt(X) =&gt; X = Y^2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f_Y</span>(y):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y <span style="color:#f92672">*</span> ((y <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;</span> (y <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create value ranges</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">1.2</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>y_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">1.2</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Evaluate PDFs</span>
</span></span><span style="display:flex;"><span>fx_vals <span style="color:#f92672">=</span> f_X(x_vals)
</span></span><span style="display:flex;"><span>fy_vals <span style="color:#f92672">=</span> f_Y(y_vals)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot the PDFs</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_vals, fx_vals, label<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$f_X(x)$: Uniform(0, 1)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(y_vals, fy_vals, label<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$f_Y(y)$: $Y = \sqrt</span><span style="color:#e6db74">{X}</span><span style="color:#e6db74">$&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;&#34;&#34;PDF Transformation: $Y = \sqrt</span><span style="color:#e6db74">{X}</span><span style="color:#e6db74">$ with $X \sim U(0, 1)$&#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x or y&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>&lt;&gt;:24: SyntaxWarning: invalid escape sequence '\s'
&lt;&gt;:24: SyntaxWarning: invalid escape sequence '\s'
/var/folders/mx/684cy0qs5zd3c_pdx4wy4pkc0000gn/T/ipykernel_15262/4117088612.py:24: SyntaxWarning: invalid escape sequence '\s'
  plt.title(&quot;&quot;&quot;PDF Transformation: $Y = \sqrt{X}$ with $X \sim U(0, 1)$&quot;&quot;&quot;)
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_105_1.png" alt="png"></p>
<h2 id="期望运算符mean-operator">期望运算符(Mean Operator)</h2>
<h3 id="基础">基础</h3>
<p><strong>🔍 什么是 Mean Operator？</strong></p>
<p>“Mean operator”是指<strong>对随机变量取期望的运算符</strong>。
在概率论中，我们通常使用符号：</p>
$$
\mathbb{E}[X]
$$<p>来表示随机变量 $X$ 的期望（也称<strong>平均值</strong>、<strong>期望值</strong>、<strong>均值</strong>）。
这个运算可以看成是对随机变量在其分布下的“加权平均”。</p>
<h4 id="-离散型随机变量的期望">📊 离散型随机变量的期望</h4>
<p>如果 $X$ 是一个离散型随机变量，取值为 $x_1, x_2, \dots$，概率为 $P(X = x_i) = p_i$，
那么其期望为：</p>
$$
\mathbb{E}[X] = \sum_{i} x_i \cdot p_i
$$<p><strong>例子：</strong></p>
<p>投一枚公平的硬币，令 $X = 1$ 表示正面，$X = 0$ 表示反面：</p>
$$
\mathbb{E}[X] = 1 \cdot \frac{1}{2} + 0 \cdot \frac{1}{2} = \frac{1}{2}
$$<h4 id="-连续型随机变量的期望">📈 连续型随机变量的期望</h4>
<p>如果 $X$ 是一个连续随机变量，具有概率密度函数（PDF） $f_X(x)$，
那么其期望为：</p>
$$
\mathbb{E}[X] = \int_{-\infty}^{\infty} x \cdot f_X(x) \, dx
$$<p><strong>例子：</strong></p>
<p>若 $X \sim \text{Uniform}(0, 1)$，即 $f_X(x) = 1$ for $x \in [0, 1]$，则：</p>
$$
\mathbb{E}[X] = \int_0^1 x \cdot 1 \, dx = \left[ \frac{1}{2}x^2 \right]_0^1 = \frac{1}{2}
$$<h4 id="-mean-operator-vs-实际平均">🔁 Mean Operator vs 实际平均</h4>
<p>期望是理论上的平均值，是对整个<strong>概率分布</strong>而言的。而现实中我们往往只能观察到有限的样本：</p>
$$
\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i
$$<p>这叫做<strong>样本均值（sample mean）</strong>，它是用来近似估计 $\mathbb{E}[X]$ 的。根据<strong>大数定律</strong>，当样本数量趋近于无穷大时，样本均值会收敛到理论期望。</p>
<h4 id="-mean-operator-的性质线性">🧮 Mean Operator 的性质（线性）</h4>
<p>设 $X, Y$ 是随机变量，$a, b$ 是常数，则：</p>
<ol>
<li>线性性（Linearity）：</li>
</ol>
$$
\mathbb{E}[aX + bY] = a \mathbb{E}[X] + b \mathbb{E}[Y]
$$<ol start="2">
<li>恒等函数的期望：</li>
</ol>
$$
\mathbb{E}[c] = c \quad \text{(常数的期望就是它本身)}
$$<h5 id="对于函数的期望">对于函数的期望</h5>
<p>设 $X$ 是一个随机变量，我们希望计算 $g(X)$ 的期望：</p>
$$
\mathbb{E}[g(X)]
$$<h6 id="-离散型推导">✅ 离散型推导</h6>
<p>假设 $X$ 是离散型随机变量，取值集合为 $\{x_1, x_2, \dots, x_n\}$，概率质量函数为 $p(x_i) = P(X = x_i)$。</p>
<p>我们要计算 $\mathbb{E}[g(X)]$，意思是对每个可能的取值 $x_i$，取函数值 $g(x_i)$，再乘以其出现的概率，再加总起来。</p>
<p><strong>🔍 推导：</strong></p>
$$
\mathbb{E}[g(X)] = \sum_{i=1}^{n} g(x_i) \cdot P(X = x_i)
$$<blockquote>
<p>✅ 本质是“对随机变量函数值的加权平均”，权重就是其发生概率。</p></blockquote>
<h6 id="-连续型推导">✅ 连续型推导：</h6>
<p>设 $X$ 是连续型随机变量，其概率密度函数为 $f_X(x)$，我们希望计算 $\mathbb{E}[g(X)]$。</p>
<p><strong>🔍 推导：</strong></p>
<p>我们可以使用积分的方式，将所有可能的 $x$ 上的 $g(x)$ 值进行加权平均，权重是 $f_X(x)$：</p>
$$
\mathbb{E}[g(X)] = \int_{-\infty}^{\infty} g(x) \cdot f_X(x) \, dx
$$<blockquote>
<p>✅ 本质上仍然是“加权平均”：对每个可能的 $x$，用密度函数给出的权重。</p></blockquote>
<h6 id="-举例讲解">📌 举例讲解</h6>
<p>例子一：🎲 离散型例子。</p>
<p>设 $X$ 是掷一个四面骰子的结果（均匀离散分布），取值为 $\{1,2,3,4\}$，每个概率 $p(x) = 1/4$。</p>
<p>我们定义 $g(X) = X^2$，计算其期望：</p>
$$
\mathbb{E}[X^2] = \sum_{x=1}^{4} x^2 \cdot \frac{1}{4} = \frac{1}{4}(1^2 + 2^2 + 3^2 + 4^2) = \frac{1}{4}(1 + 4 + 9 + 16) = \frac{30}{4} = 7.5
$$<hr>
<p>例子二：📈 连续型例子。</p>
<p>设 $X \sim \text{Uniform}(0, 1)$，密度函数 $f_X(x) = 1$ for $x \in [0, 1]$。</p>
<p>取函数 $g(x) = x^2$，计算：</p>
$$
\mathbb{E}[X^2] = \int_0^1 x^2 \cdot 1 \, dx = \left[ \frac{x^3}{3} \right]_0^1 = \frac{1}{3}
$$<hr>
<h6 id="-与直接期望的区别">🔁 与直接期望的区别</h6>
<ul>
<li>$\mathbb{E}[X]$：是原始随机变量的期望；</li>
<li>$\mathbb{E}[g(X)]$：是对 $X$ 做函数变换后的期望，<strong>不等于</strong> $g(\mathbb{E}[X])$（除非 $g$ 是线性函数）！</li>
</ul>
<p>例如上例中：</p>
<ul>
<li>$\mathbb{E}[X] = 0.5$，</li>
<li>$g(x) = x^2$，</li>
<li>$g(\mathbb{E}[X]) = (0.5)^2 = 0.25 \neq \mathbb{E}[X^2] = \frac{1}{3}$</li>
</ul>
<hr>
<h6 id="-总结">📚 总结</h6>
<table>
  <thead>
      <tr>
          <th>类型</th>
          <th>定义</th>
          <th>公式</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>离散型</td>
          <td>$\mathbb{E}[g(X)] = \sum g(x_i) \cdot P(X = x_i)$</td>
          <td>加权平均</td>
      </tr>
      <tr>
          <td>连续型</td>
          <td>$\mathbb{E}[g(X)] = \int g(x) \cdot f_X(x) \, dx$</td>
          <td>加权积分</td>
      </tr>
  </tbody>
</table>
<h2 id="误差传播法则propagation-laws">误差传播法则（Propagation Laws）</h2>
<p><strong>Propagation laws</strong>（误差传播定律），也叫作<strong>uncertainty propagation</strong>，是指当你通过某个函数 $Y = g(X_1, X_2, \dots, X_n)$ 来计算一个变量时，如果输入变量 $X_i$ 都有不确定性（通常以方差或标准差表示），那么我们想知道输出变量 $Y$ 的不确定性是多少。</p>
<p>这套理论的核心是如何推导：</p>
$$
\text{Var}(Y) \quad \text{或者} \quad \sigma_Y
$$<h3 id="-一元情形只有一个变量">✅ 一元情形（只有一个变量）</h3>
<p>]
设 $Y = g(X)$，而 $X$ 是一个随机变量，均值 $\mu_X$，方差 $\sigma_X^2$，</p>
<p>如果 $g$ 是光滑函数（可微），并且 $X$ 的波动不大，可以使用一阶泰勒展开近似：</p>
$$
Y \approx g(\mu_X) + g'(\mu_X)(X - \mu_X)
$$<p>于是可以近似得到：</p>
$$
\boxed{\text{Var}(Y) \approx \left(g'(\mu_X)\right)^2 \cdot \text{Var}(X)}
$$<h3 id="-多元情形多个输入变量">✅ 多元情形（多个输入变量）</h3>
<p>设输出变量：</p>
$$
Y = g(X_1, X_2, \dots, X_n)
$$<p>我们可以展开一阶<a href="https://en.wikipedia.org/wiki/Taylor_series">泰勒展开式</a>：</p>
$$
Y \approx g(\boldsymbol{\mu}) + \sum_{i=1}^{n} \frac{\partial g}{\partial x_i} (X_i - \mu_i)
$$<p>于是得到方差的近似传播式：</p>
$$
\boxed{\text{Var}(Y) \approx \sum_{i=1}^{n} \left(\frac{\partial g}{\partial x_i}\right)^2 \cdot \text{Var}(X_i) + 2 \sum_{i < j} \frac{\partial g}{\partial x_i} \cdot \frac{\partial g}{\partial x_j} \cdot \text{Cov}(X_i, X_j)}
$$<ul>
<li>如果 $X_1, \dots, X_n$ <strong>独立</strong>，协方差项为 0，简化为：</li>
</ul>
$$
\boxed{\text{Var}(Y) \approx \sum_{i=1}^{n} \left(\frac{\partial g}{\partial x_i}\right)^2 \cdot \text{Var}(X_i)}
$$<h3 id="-示例讲解">📐 示例讲解</h3>
<h4 id="-例子-1乘法传播">🎯 例子 1：乘法传播</h4>
<p>设 $Y = XY$，其中 $X \sim N(\mu_X, \sigma_X^2)$，$Y \sim N(\mu_Y, \sigma_Y^2)$，且 $X, Y$ 独立。</p>
<ul>
<li>$g(X, Y) = XY$</li>
</ul>
<p>我们有：</p>
<ul>
<li>$\frac{\partial g}{\partial X} = Y$</li>
<li>$\frac{\partial g}{\partial Y} = X$</li>
</ul>
<p>代入传播公式（用期望近似导数）：</p>
$$
\text{Var}(XY) \approx (\mu_Y)^2 \sigma_X^2 + (\mu_X)^2 \sigma_Y^2
$$<hr>
<h4 id="-例子-2温度换算线性变换">📊 例子 2：温度换算（线性变换）</h4>
<p>摄氏温度 $C \sim N(\mu, \sigma^2)$，换算成华氏温度：</p>
$$
F = 1.8 C + 32
$$<p>由于是线性变换，直接使用公式：</p>
$$
\text{Var}(F) = (1.8)^2 \cdot \text{Var}(C)
$$<hr>
<h3 id="-小结表格">📌 小结表格</h3>
<table>
  <thead>
      <tr>
          <th>形式</th>
          <th>描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>一元变换</td>
          <td>$\text{Var}(Y) \approx (g'(\mu))^2 \cdot \text{Var}(X)$</td>
      </tr>
      <tr>
          <td>多元独立变量</td>
          <td>$\text{Var}(Y) \approx \sum (\partial g / \partial x_i)^2 \cdot \text{Var}(X_i)$</td>
      </tr>
      <tr>
          <td>多元相关变量</td>
          <td>加上协方差项</td>
      </tr>
      <tr>
          <td>线性变换</td>
          <td>精确成立：$Y = aX + b \Rightarrow \text{Var}(Y) = a^2 \cdot \text{Var}(X)$</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-注意事项">⚠️ 注意事项</h3>
<ul>
<li>该方法是<strong>近似</strong>方法，准确性取决于函数在局部的线性程度；</li>
<li>适用于输入误差<strong>较小</strong>的情况；</li>
<li>更高阶误差可以用<strong>二阶泰勒展开</strong>改进；</li>
<li>若分布不是正态分布，结果依然是近似的。</li>
</ul>
<h3 id="为什么可以用-x-在均值附近的线性近似">为什么可以用 X 在均值附近的线性近似？</h3>
<p>我们说：</p>
<blockquote>
<p>设随机变量 $X$ 有均值 $\mu_X$，函数 $Y = g(X)$，
那么我们可以用 <strong>X 在均值附近的线性近似</strong>：</p></blockquote>
$$
g(X) \approx g(\mu_X) + g'(\mu_X)(X - \mu_X)
$$<p>你问的是：<strong>这一步为什么可以这么做？有什么依据？</strong></p>
<p>✅ 这一步其实是使用了“泰勒一阶展开”（Taylor Expansion）</p>
<h4 id="-1-什么是泰勒展开">🌟 1. 什么是泰勒展开？</h4>
<p>泰勒展开是用一个函数在某点的导数信息，近似表示这个函数在附近的值。</p>
<p>对一个可导函数 $g(x)$，在点 $x = a$ 处进行泰勒展开，有：</p>
$$
g(x) = g(a) + g'(a)(x - a) + \frac{g''(a)}{2!}(x - a)^2 + \cdots
$$<p>如果我们只保留<strong>一阶项</strong>（也就是导数那一项），就叫：</p>
$$
\boxed{
g(x) \approx g(a) + g'(a)(x - a)
}
\quad \text{（一阶泰勒展开）}
$$<h4 id="-2-为什么在误差传播里这么用">🌟 2. 为什么在误差传播里这么用？</h4>
<p>设 $X$ 是一个<strong>带噪声的输入量</strong>，我们知道它的均值是 $\mu_X$，方差是 $\sigma_X^2$，但它总有一些波动。</p>
<p>我们关心的是：当 $X$ 在 $\mu_X$ 附近波动时，输出 $Y = g(X)$ 会怎样波动？</p>
<p>于是我们在 $\mu_X$ 附近进行线性近似：</p>
$$
g(X) \approx g(\mu_X) + g'(\mu_X)(X - \mu_X)
$$<p>这个式子的意义是：</p>
<ul>
<li>$g(\mu_X)$：是平均输出</li>
<li>$g'(\mu_X)(X - \mu_X)$：是输入 $X$ 波动带来的<strong>线性变化</strong></li>
</ul>
<p>这种线性逼近在 $X$ 变动不大的时候是很合理的 —— 就像我们画图时用直线近似曲线的一小段。</p>
<h4 id="-图像直观理解">📈 图像直观理解</h4>
<ol>
<li>画一条函数曲线 $y = g(x)$，比如 $g(x) = \log x$</li>
<li>在 $x = \mu_X$ 画一条切线</li>
<li>看看这条切线在附近是否与原函数差不多</li>
</ol>
<p>这就是泰勒展开的一阶逼近，它告诉我们：</p>
<blockquote>
<p>如果你只关心“函数在平均点附近是怎么变的”，那么只看导数（斜率）就足够。</p></blockquote>
<h4 id="-为什么一阶就足够">🔍 为什么一阶就足够？</h4>
<p>因为我们关注的是<strong>方差</strong>的传播：</p>
<ul>
<li>方差只取决于函数的<strong>一阶变化速度</strong>，即 $g'(x)$；</li>
<li>如果你保留高阶项，比如 $(x - \mu)^2$，你需要知道高阶导数，分析会复杂很多；</li>
<li>在误差很小（即 $X$ 的波动很小）时，一阶项就主导了误差传播的行为。</li>
</ul>
<h4 id="-总结一句话">✅ 总结一句话：</h4>
<p>我们用：</p>
$$
g(X) \approx g(\mu_X) + g'(\mu_X)(X - \mu_X)
$$<p>是因为：</p>
<ul>
<li>这是<strong>一阶泰勒展开</strong>，用于在 $\mu_X$ 附近逼近函数；</li>
<li>当输入误差很小时，这是非常好的近似；</li>
<li>这个逼近能帮助我们分析输出 $Y$ 的波动（即方差）是如何由输入 $X$ 的波动造成的。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定义非线性函数和它的导数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">g</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>log(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">g_prime</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 取均值点 mu</span>
</span></span><span style="display:flex;"><span>mu <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 原函数值</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> g(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 一阶线性近似：在 mu 附近</span>
</span></span><span style="display:flex;"><span>y_approx <span style="color:#f92672">=</span> g(mu) <span style="color:#f92672">+</span> g_prime(mu) <span style="color:#f92672">*</span> (x <span style="color:#f92672">-</span> mu)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘图</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, y, label<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$g(x) = \log(x)$&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, y_approx, <span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Linear approximation at $\mu=1$&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvline(mu, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;:&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$\mu_X$&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 标记点</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>scatter([mu], [g(mu)], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>text(mu<span style="color:#f92672">+</span><span style="color:#ae81ff">0.02</span>, g(mu)<span style="color:#f92672">+</span><span style="color:#ae81ff">0.1</span>, <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$g(\mu_X)$&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Function $g(x)$ and Its Linear Approximation at $\mu_X$&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;x&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;g(x)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>&lt;&gt;:24: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:31: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:24: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:31: SyntaxWarning: invalid escape sequence '\m'
/var/folders/mx/684cy0qs5zd3c_pdx4wy4pkc0000gn/T/ipykernel_15262/692038390.py:24: SyntaxWarning: invalid escape sequence '\m'
  plt.plot(x, y_approx, '--', label='Linear approximation at $\mu=1$', color='red')
/var/folders/mx/684cy0qs5zd3c_pdx4wy4pkc0000gn/T/ipykernel_15262/692038390.py:31: SyntaxWarning: invalid escape sequence '\m'
  plt.title('Function $g(x)$ and Its Linear Approximation at $\mu_X$')
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_110_1.png" alt="png"></p>
<h2 id="样本均值算子sample-mean-operator">样本均值算子（Sample mean operator）</h2>
<p>在统计中，<strong>sample mean operator</strong> 就是将一个随机变量的若干个独立样本求平均的操作：</p>
<p>给定某个随机变量 $X$，我们从中独立采样 $n$ 个样本：</p>
$$
X_1, X_2, \dots, X_n \sim \text{i.i.d. from } X
$$<p>则样本均值（sample mean）定义为：</p>
$$
\bar{X}_n = \frac{1}{n} \sum_{i=1}^{n} X_i
$$<p>这个操作就叫做 sample mean operator：它接受一个样本序列，输出平均值。</p>
<blockquote>
<p><strong>Sample mean operator 是从数据中估计总体均值的最基本工具，具有无偏性、方差随样本数降低、集中性和正态性等重要性质。</strong></p></blockquote>
<h3 id="-sample-mean-的重要性质">📌 sample mean 的重要性质</h3>
<h4 id="1-无偏性unbiasedness">1. <strong>无偏性（Unbiasedness）</strong></h4>
$$
\mathbb{E}[\bar{X}_n] = \mathbb{E}\left[\frac{1}{n} \sum_{i=1}^n X_i\right] = \frac{1}{n} \sum_{i=1}^n \mathbb{E}[X_i] = \mu
$$<p>👉 说明：样本均值是总体均值的无偏估计。</p>
<h4 id="2-方差">2. <strong>方差</strong></h4>
$$
\mathrm{Var}[\bar{X}_n] = \frac{1}{n^2} \sum_{i=1}^n \mathrm{Var}[X_i] = \frac{\sigma^2}{n}
$$<p>👉 意义：样本均值的方差随着样本数增加而减小。</p>
<h4 id="3-集中性大数定律">3. <strong>集中性（大数定律）</strong></h4>
<p>根据<strong>大数定律</strong>（Law of Large Numbers）：</p>
$$
\bar{X}_n \xrightarrow{a.s.} \mu \quad \text{as } n \to \infty
$$<p>👉 意义：样本均值几乎必然收敛到总体均值。</p>
<hr>
<h4 id="4-近似正态分布中心极限定理">4. <strong>近似正态分布（中心极限定理）</strong></h4>
<p>当 $n$ 很大时，根据中心极限定理：</p>
$$
\bar{X}_n \approx \mathcal{N}\left(\mu, \frac{\sigma^2}{n} \right)
$$<p>👉 意义：无论原始分布如何，样本均值在大样本下近似服从正态分布。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 假设原始分布 X 是指数分布（不是正态）</span>
</span></span><span style="display:flex;"><span>X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>exponential(scale<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>, size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10000</span>,))  <span style="color:#75715e"># 原始样本</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 不同样本数量下的 sample mean</span>
</span></span><span style="display:flex;"><span>sample_sizes <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">100</span>]
</span></span><span style="display:flex;"><span>means <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> sample_sizes:
</span></span><span style="display:flex;"><span>    sample_means <span style="color:#f92672">=</span> [np<span style="color:#f92672">.</span>mean(np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>choice(X, n, replace<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>)]
</span></span><span style="display:flex;"><span>    means<span style="color:#f92672">.</span>append(sample_means)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化不同 n 下的 sample mean 分布</span>
</span></span><span style="display:flex;"><span>fig, axs <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>, len(sample_sizes), figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, n <span style="color:#f92672">in</span> enumerate(sample_sizes):
</span></span><span style="display:flex;"><span>    axs[i]<span style="color:#f92672">.</span>hist(means[i], bins<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;skyblue&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    axs[i]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;n=</span><span style="color:#e6db74">{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    axs[i]<span style="color:#f92672">.</span>axvline(np<span style="color:#f92672">.</span>mean(X), color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True Mean&#39;</span>)
</span></span><span style="display:flex;"><span>    axs[i]<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>suptitle(<span style="color:#e6db74">&#39;Sample Mean Distribution as Sample Size Increases&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_112_0.png" alt="png"></p>
<h3 id="利用-sample-mean-operator-来近似计算一些无法解析求解的积分">利用 sample mean operator 来近似计算一些无法解析求解的积分</h3>
<p>这其实就是<strong>蒙特卡洛积分（Monte Carlo Integration）<strong>的核心思想。我们可以利用 sample mean operator 来</strong>近似计算一些无法解析求解的积分</strong>，特别是在高维或复杂函数情形下。</p>
<p><strong>🧠 思路总览：用样本均值近似积分</strong></p>
<p>设我们想计算一个积分：</p>
$$
I = \int_a^b f(x)\,dx
$$<p>若这个积分无法解析求出，可以把它看成期望：</p>
$$
I = (b - a) \cdot \mathbb{E}_{X \sim \mathcal{U}(a, b)}[f(X)]
$$<p>其中，$X$ 是均匀随机变量</p>
<h4 id="-为什么可以这样变">✅ 为什么可以这样变？</h4>
<p>如果 $X \sim \mathcal{U}(a, b)$，那么它的密度是：</p>
$$
p(x) = \frac{1}{b-a}, \quad x \in [a, b]
$$<p>所以：</p>
$$
\mathbb{E}[f(X)] = \int_a^b f(x) \cdot p(x)\,dx = \int_a^b f(x) \cdot \frac{1}{b-a} \, dx
= \frac{1}{b-a} \int_a^b f(x)\,dx
$$<p>整理得：</p>
$$
\int_a^b f(x)\,dx = (b - a) \cdot \mathbb{E}[f(X)]
$$<h4 id="-用样本均值近似期望">📌 用样本均值近似期望</h4>
<p>我们可以从 $X \sim \mathcal{U}(a, b)$ 中采样 $n$ 个样本 $x_1, x_2, \dots, x_n$，计算：</p>
$$
\mathbb{E}[f(X)] \approx \frac{1}{n} \sum_{i=1}^{n} f(x_i)
$$<p>因此：</p>
$$
\int_a^b f(x)\,dx \approx \frac{b - a}{n} \sum_{i=1}^n f(x_i)
$$<h4 id="-拓展为什么这很有用">📚 拓展：为什么这很有用？</h4>
<ul>
<li>
<p>在<strong>高维空间</strong>或<strong>复杂积分（比如贝叶斯推断中）</strong>，没有解析解时：</p>
<ul>
<li>你无法用牛顿积分；</li>
<li>你可以只依赖样本！</li>
</ul>
</li>
</ul>
<h4 id="-总结一句话-1">✅ 总结一句话</h4>
<blockquote>
<p><strong>通过把积分转化为期望，我们可以利用 sample mean operator 和均匀采样来近似任何无法解析求解的积分 —— 这就是蒙特卡洛积分的核心。</strong></p></blockquote>
<h4 id="-python-实现monte-carlo-积分">✅ Python 实现：Monte Carlo 积分</h4>
<p>我们来试试计算：</p>
$$
I = \int_0^1 e^{-x^2}\,dx
$$<p>这里，</p>
<ul>
<li>$a = 0, b = 1$</li>
<li>$f(x) = e^{-x^2}$</li>
</ul>
<p>这是无法解析求出的（其实这就是误差函数 erf 的一部分），但我们可以数值估算它。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 被积函数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 积分区间</span>
</span></span><span style="display:flex;"><span>a, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Monte Carlo 采样数量</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>x_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(a, b, n) <span style="color:#75715e"># 1️⃣ 均匀采样 [a, b] 区间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 样本均值估计</span>
</span></span><span style="display:flex;"><span>estimate <span style="color:#f92672">=</span> (b <span style="color:#f92672">-</span> a) <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>mean(f(x_samples)) <span style="color:#75715e"># 2️⃣ 计算样本均值并乘以区间长度</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[Estimate Value] Monte Carlo estimate of ∫₀¹ e^(-x²) dx ≈ </span><span style="color:#e6db74">{</span>estimate<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 计算真实值</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.special <span style="color:#f92672">import</span> erf
</span></span><span style="display:flex;"><span>true_val <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(np<span style="color:#f92672">.</span>pi)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> erf(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[True Value] The true value of ∫₀¹ e^(-x²) dx ≈ </span><span style="color:#e6db74">{</span>true_val<span style="color:#e6db74">:</span><span style="color:#e6db74">.6f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><pre><code>[Estimate Value] Monte Carlo estimate of ∫₀¹ e^(-x²) dx ≈ 0.743534
[True Value] The true value of ∫₀¹ e^(-x²) dx ≈ 0.746824
</code></pre>
<h1 id="采样方法sample-methods">采样方法（Sample Methods）</h1>
<p><strong>又见：</strong></p>
<ul>
<li><a href="./extra-Sampling%20from%20discrete_continuous%20distributions.pdf">Sampling from discrete distributions</a> | <a href="https://dept.stat.lsa.umich.edu/~jasoneg/Stat406/lab5.pdf">Online version</a></li>
</ul>
<h2 id="反函数法inverse-transform-sampling">反函数法（Inverse Transform Sampling）</h2>
<p>给定概率密度/质量函数 $f_X(x)$，则：</p>
<ol>
<li>计算 $F_X(x)$</li>
<li>基于均匀随机变量获得一个值</li>
<li>计算 $F_X^{-1}(u)$ 从而得到 $x$。这个 $x$ 就是我们想要的采样值。</li>
</ol>
<p>想象你画了 CDF 曲线 $F_X(x)$，横轴是$x$，纵轴是概率$[0,1]$。</p>
<ul>
<li>随机生成一个 $u \in [0,1]$</li>
<li>找到这个 $u$ 在 CDF 上对应的横坐标：这就是你要的样本 $x$</li>
</ul>
<p>注意：</p>
<blockquote>
<p>当我们已经知道了CDF，并且可以从这个CDF获得一个封闭形式（close form）的函数，就可以使用这个方法</p></blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> plotly.graph_objs <span style="color:#66d9ef">as</span> go
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> plotly.subplots <span style="color:#f92672">import</span> make_subplots
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 目标分布：指数分布 X ~ Exp(λ=1)</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>cdf_vals <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>x_vals)  <span style="color:#75715e"># CDF of Exp(1)</span>
</span></span><span style="display:flex;"><span>inv_cdf <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> u: <span style="color:#f92672">-</span>np<span style="color:#f92672">.</span>log(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> u)  <span style="color:#75715e"># x = 反函数 F⁻¹(u)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 随机采样 5 个均匀数</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>u_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sort(np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>x_samples <span style="color:#f92672">=</span> inv_cdf(u_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建子图：左侧显示 CDF 映射过程，右侧显示 Histogram</span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> make_subplots(rows<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cols<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>                    subplot_titles<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;Inverse Transform Sampling&#34;</span>, <span style="color:#e6db74">&#34;Histogram of Transformed Samples&#34;</span>),
</span></span><span style="display:flex;"><span>                    column_widths<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0.6</span>, <span style="color:#ae81ff">0.4</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 左图：CDF 曲线</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>x_vals, y<span style="color:#f92672">=</span>cdf_vals, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lines&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CDF F(x)&#39;</span>, line<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)),
</span></span><span style="display:flex;"><span>              row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加每个 u 值的水平线和对应的 x 映射</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> u, x <span style="color:#f92672">in</span> zip(u_samples, x_samples):
</span></span><span style="display:flex;"><span>    fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0</span>, x], y<span style="color:#f92672">=</span>[u, u], mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lines&#39;</span>,
</span></span><span style="display:flex;"><span>                             line<span style="color:#f92672">=</span>dict(dash<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dot&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>), showlegend<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>), row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>[x], y<span style="color:#f92672">=</span>[u], mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;markers+text&#39;</span>,
</span></span><span style="display:flex;"><span>                             marker<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>),
</span></span><span style="display:flex;"><span>                             text<span style="color:#f92672">=</span>[<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;x=</span><span style="color:#e6db74">{</span>x<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>], textposition<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;top right&#39;</span>, showlegend<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>), row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加 u 样本点</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>len(u_samples), y<span style="color:#f92672">=</span>u_samples, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;markers&#39;</span>,
</span></span><span style="display:flex;"><span>                         marker<span style="color:#f92672">=</span>dict(symbol<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;line-ns-open&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>),
</span></span><span style="display:flex;"><span>                         name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;u ~ Uniform(0,1)&#39;</span>), row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 右图：x 样本的直方图</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Histogram(x<span style="color:#f92672">=</span>x_samples, nbinsx<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled X&#39;</span>, marker_color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>), row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 布局设置</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_layout(height<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">900</span>, title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Inverse Transform Sampling Visualization (Exponential RV)&#34;</span>,
</span></span><span style="display:flex;"><span>                  showlegend<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_xaxes(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x&#34;</span>, row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_yaxes(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;F(x) or u&#34;</span>, row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_xaxes(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sampled x&#34;</span>, row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_yaxes(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Frequency&#34;</span>, row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, col<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><h3 id="为什么我们可以用均匀分布来采样其他任意分布比如伯努利指数正态等">为什么我们可以用均匀分布来采样其他任意分布（比如伯努利、指数、正态等）</h3>
<p>这背后的理论基础是 <strong>概率论中关于</strong> <strong>分布函数（CDF）和其反函数的性质</strong>。核心思想是：概率积分变换（Probability Integral Transform）</p>
<p><strong>定理（概率积分变换 / Probability Integral Transform）</strong>：</p>
<blockquote>
<p>若随机变量 $X$ 的分布函数是 $F_X(x)$，且 $F_X$ 是严格单调的连续函数，那么
<strong>$U = F_X(X) \sim \text{Uniform}(0,1)$</strong>，
反过来，<strong>$X = F_X^{-1}(U)$</strong> 也服从原始分布 $X$。</p></blockquote>
<p>换句话说：</p>
<ul>
<li><strong>你可以把任何分布的采样问题，变成 Uniform(0,1) 的采样问题 + 一个反函数变换。</strong></li>
</ul>
<h4 id="-为什么这个成立">🧠 为什么这个成立？</h4>
<p>我们来直观推导一下第二个方向（也是我们用来“生成任意分布”的方向）：</p>
<p><strong>假设：</strong></p>
<ul>
<li>$U \sim \text{Uniform}(0,1)$</li>
<li>设 $Y = F^{-1}(U)$，我们想证明 $Y \sim F$</li>
</ul>
<p><strong>证明：</strong></p>
<p>我们来计算 $Y = F^{-1}(U)$ 的 CDF，也就是：</p>
$$
P(Y \leq y)
$$<p>由于 $Y = F^{-1}(U)$，那么：</p>
$$
P(Y \leq y) = P(F^{-1}(U) \leq y)
$$<p><strong>✅ 第一步：运用反函数的单调性</strong></p>
<p><strong>前提条件：$F$ 是连续、严格递增的函数</strong>（这是保证反函数存在并单调的关键）。</p>
<p>所以我们可以对不等式 $F^{-1}(U) \leq y$ 应用函数 $F$，变成：</p>
$$
F^{-1}(U) \leq y \quad \Leftrightarrow \quad U \leq F(y)
$$<p>这是非常关键的一步！我们把 <strong>“关于 $Y$” 的事件</strong> 转化成了 <strong>“关于 $U$” 的事件</strong>。</p>
<p><strong>✅ 第二步：使用 $U \sim \text{Uniform}(0,1)$</strong></p>
$$
P(U \leq F(y)) = F(y)
$$<p>为什么呢？因为：</p>
<ul>
<li>$U \sim \text{Uniform}(0,1)$</li>
<li>所以 <strong>$P(U \leq u) = u$</strong>，对于 $u \in [0,1]$</li>
<li>而 $F(y) \in [0,1]$，因为 $F$ 是一个合法的分布函数</li>
</ul>
<p>所以：</p>
$$
P(U \leq F(y)) = F(y)
$$<p><strong>✅ 综合起来：</strong></p>
$$
P(Y \leq y) = P(F^{-1}(U) \leq y) = P(U \leq F(y)) = F(y)
$$<p>因此，<strong>$Y$ 的分布函数就是 $F$</strong>，所以我们说 $Y \sim F$。</p>
<h4 id="-应用举例">🎯 应用举例：</h4>
<ul>
<li>
<p><strong>伯努利采样：</strong></p>
<ul>
<li>
<p>如果 $U < p$，我们就输出 1，否则输出 0，相当于：</p>
$$
    F^{-1}(u) = 
    \begin{cases}
    1 & u < p \\
    0 & u \ge p
    \end{cases}
    $$</li>
</ul>
</li>
<li>
<p><strong>指数分布采样：</strong></p>
<ul>
<li>Exponential 的 CDF 是 $F(x) = 1 - e^{-\lambda x}$</li>
<li>反函数是 $F^{-1}(u) = -\frac{1}{\lambda} \ln(1 - u)$</li>
</ul>
</li>
</ul>
<h4 id="-直觉总结">💡 直觉总结</h4>
<p>你可以把 Uniform(0,1) 理解为“抽签”，然后用每种分布的<strong>分布函数</strong>告诉我们这个“抽签号”对应什么“事件”或“数值”。</p>
<h4 id="-为什么我们要这样做">📊 为什么我们要这样做？</h4>
<ol>
<li><strong>Uniform(0,1)</strong> 是最容易模拟的分布：几乎所有语言都有 <code>random()</code>。</li>
<li>如果能把任何分布转化为 Uniform，就能统一采样流程，简化算法设计。</li>
<li>用在：<strong>蒙特卡洛方法、MCMC、生成模型、仿真系统……</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Target distribution: Exponential(lambda=1)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> expon
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate Uniform samples</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>U <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, n)
</span></span><span style="display:flex;"><span>U_sorted <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sort(U)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Compute inverse CDF (quantile function) for exponential</span>
</span></span><span style="display:flex;"><span>Y <span style="color:#f92672">=</span> expon<span style="color:#f92672">.</span>ppf(U_sorted)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prepare plot</span>
</span></span><span style="display:flex;"><span>fig, axs <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot CDF of Exponential</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> expon<span style="color:#f92672">.</span>cdf(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>plot(x, cdf, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CDF of Exponential(λ=1)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>scatter(Y, U_sorted, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;(Y, U)&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Inverse Transform Sampling Visualization&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;u = F(y)&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot histogram of sampled Y</span>
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hist(Y, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled Y&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>plot(x, expon<span style="color:#f92672">.</span>pdf(x), color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True PDF&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#39;Sampled Distribution via Inverse Transform&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;Density&#39;</span>)
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>axs[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_120_0.png" alt="png"></p>
<h3 id="离散型反函数采样">离散型反函数采样</h3>
<p><strong>反函数法（Inverse Transform Sampling）</strong> 并不只适用于连续型随机变量，它同样适用于<strong>离散型随机变量</strong>，原理是类似的，只是操作略有不同。下面我将详细为你讲解离散型随机变量上的应用。</p>
<p>而对于<strong>离散分布</strong>，$F_X(x)$ 是阶梯函数（跳跃），我们不能用“解析反函数”，但可以通过<strong>查找法实现“反函数”的效果</strong>。</p>
<h4 id="-离散型反函数采样核心步骤">🧮 离散型反函数采样：核心步骤</h4>
<p>我们通过<strong>累积概率表</strong>来代替反函数，主要流程如下：</p>
<ol>
<li>
<p>有一个离散型 RV $X$，其可能取值为 $x_1, x_2, ..., x_n$，概率为 $p_1, p_2, ..., p_n$</p>
</li>
<li>
<p>构造其 <strong>累积分布函数（CDF）</strong>：</p>
$$
   F(x_k) = \sum_{i=1}^k p_i
   $$</li>
<li>
<p>从 $u \sim \text{Uniform}(0, 1)$ 中采样</p>
</li>
<li>
<p>找到第一个使得 $F(x_k) \geq u$ 的 $x_k$，这就是采样值</p>
</li>
</ol>
<h4 id="-示例采样离散变量-x其中">✅ 示例：采样离散变量 X，其中：</h4>
<ul>
<li>$P(X=1) = 0.1$</li>
<li>$P(X=2) = 0.3$</li>
<li>$P(X=3) = 0.4$</li>
<li>$P(X=4) = 0.2$</li>
</ul>
<p>那么 CDF 为：</p>
<table>
  <thead>
      <tr>
          <th>值 $x$</th>
          <th>概率 $p$</th>
          <th>累积 $F(x)$</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>0.1</td>
          <td>0.1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0.3</td>
          <td>0.4</td>
      </tr>
      <tr>
          <td>3</td>
          <td>0.4</td>
          <td>0.8</td>
      </tr>
      <tr>
          <td>4</td>
          <td>0.2</td>
          <td>1.0</td>
      </tr>
  </tbody>
</table>
<p>如果你采到 $u = 0.75$，你会落在 $F(x=3)=0.8$，所以输出 3；
如果 $u = 0.85$，你会输出 4。</p>
<h4 id="-总结-1">✅ 总结</h4>
<table>
  <thead>
      <tr>
          <th>对象类型</th>
          <th>是否能用反函数法？</th>
          <th>如何实现？</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>连续型 RV</td>
          <td>✅ 是</td>
          <td>用解析或数值方式计算 $F^{-1}(u)$</td>
      </tr>
      <tr>
          <td>离散型 RV</td>
          <td>✅ 是</td>
          <td>用查找 + 累积分布函数模拟 $F^{-1}(u)$</td>
      </tr>
  </tbody>
</table>
<h2 id="采样离散分布">采样离散分布</h2>
<h3 id="采样一个二维有限离散型随机变量2d-finite-discrete-random-variable">采样一个二维有限离散型随机变量（2D Finite Discrete Random Variable）</h3>
<p>采样一个<strong>二维有限离散型随机变量（2D Finite Discrete Random Variable）</strong>，本质上就是从一个给定的<strong>联合概率分布表 $P(X = x_i, Y = y_j)$</strong> 中生成随机样本对 $(x_i, y_j)$。</p>
<p><strong>✅ 总结</strong></p>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>原理</th>
          <th>适用场景</th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>展平联合分布 + 反函数采样</td>
          <td>一维化处理所有 $(x,y)$ 对</td>
          <td>联合概率矩阵已知</td>
          <td></td>
      </tr>
      <tr>
          <td>边缘 + 条件采样</td>
          <td>先采 $X$，再采 (Y</td>
          <td>X)</td>
          <td>更复杂/结构化的模型</td>
      </tr>
  </tbody>
</table>
<h4 id="-方法一展平反函数采样">✅ 方法一：展平+反函数采样</h4>
<p><strong>核心思路：</strong></p>
<p>将二维联合分布<strong>展平</strong>为一维，然后做<strong>累积概率表 + 反函数采样（Inverse CDF Sampling）</strong>。</p>
<p><strong>🔢 步骤：</strong></p>
<ol>
<li>创建所有可能的值对 $(x_i, y_j)$；</li>
<li>展平联合概率表 $P(x_i, y_j)$；</li>
<li>构造累积分布函数（CDF）；</li>
<li>从 $[0,1]$ 上采样 $u$，找第一个 $u \leq \text{CDF}[k]$；</li>
<li>返回对应的 $(x_i, y_j)$。</li>
</ol>
<p><strong>✅ 假设你已有联合分布表</strong></p>
<p>比如：</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>y=0</th>
          <th>y=1</th>
          <th>y=2</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>x=0</td>
          <td>0.1</td>
          <td>0.2</td>
          <td>0.1</td>
      </tr>
      <tr>
          <td>x=1</td>
          <td>0.1</td>
          <td>0.2</td>
          <td>0.1</td>
      </tr>
      <tr>
          <td>x=2</td>
          <td>0.05</td>
          <td>0.05</td>
          <td>0.1</td>
      </tr>
  </tbody>
</table>
<p>这个二维分布的总概率是 1。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">flatten_joint_distribution</span>(x_vals, y_vals, joint_probs):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    展平二维联合分布矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param joint_probs: 二维联合分布矩阵
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 展平后的概率分布
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 展平联合分布</span>
</span></span><span style="display:flex;"><span>    flattened <span style="color:#f92672">=</span> joint_probs<span style="color:#f92672">.</span>flatten()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(&#34;Flatten joint probabilities:&#34;, flattened)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 所有可能的(x, y)组合（顺序与flattened一致）</span>
</span></span><span style="display:flex;"><span>    xy_pairs <span style="color:#f92672">=</span> [(x, y) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> x_vals <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> y_vals]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#print(&#34;XY pairs:&#34;, xy_pairs)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> flattened, xy_pairs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_2d_discrete_inverse_transform</span>(x_vals, y_vals, joint_probs):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># flatten the joint distribution</span>
</span></span><span style="display:flex;"><span>    flattened, xy_pairs <span style="color:#f92672">=</span> flatten_joint_distribution(x_vals, y_vals, joint_probs)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># apply inverse transform sampling</span>
</span></span><span style="display:flex;"><span>    cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(flattened)
</span></span><span style="display:flex;"><span>    u <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>random()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, threshold <span style="color:#f92672">in</span> enumerate(cdf):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;=</span> threshold:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> xy_pairs[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> xy_pairs[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]  <span style="color:#75715e"># fallback for u ~ 1.0</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定义二维离散联合分布</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>y_vals <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>joint_probs <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.1</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.1</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.1</span>]
</span></span><span style="display:flex;"><span>])  <span style="color:#75715e"># shape (3, 3)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> np<span style="color:#f92672">.</span>isclose(joint_probs<span style="color:#f92672">.</span>sum(), <span style="color:#ae81ff">1.0</span>), <span style="color:#e6db74">&#34;Joint probabilities must sum to 1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> [sample_2d_discrete_inverse_transform(x_vals, y_vals, joint_probs) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(N)]
</span></span><span style="display:flex;"><span>x_sample, y_sample <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化联合频率</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;x&#39;</span>: x_sample, <span style="color:#e6db74">&#39;y&#39;</span>: y_sample})
</span></span><span style="display:flex;"><span>pivot_table <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>crosstab(df[<span style="color:#e6db74">&#39;x&#39;</span>], df[<span style="color:#e6db74">&#39;y&#39;</span>], normalize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;all&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>heatmap(joint_probs, annot<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YlGnBu&#34;</span>, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.3f&#34;</span>, xticklabels<span style="color:#f92672">=</span>y_vals, yticklabels<span style="color:#f92672">=</span>x_vals)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Theoretical Joint Distribution from Samples&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Y&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;X&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>heatmap(pivot_table, annot<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YlGnBu&#34;</span>, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.3f&#34;</span>, xticklabels<span style="color:#f92672">=</span>y_vals, yticklabels<span style="color:#f92672">=</span>x_vals)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Empirical Joint Distribution from Samples&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Y&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;X&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_126_0.png" alt="png"></p>
<h4 id="-方法二边缘--条件分布采样法marginal--conditional-sampling">✅ 方法二：“边缘 + 条件分布采样法”（Marginal + Conditional Sampling）</h4>
<p>这种方法在概率论、贝叶斯建模中非常常见，逻辑也更直观，尤其适用于结构化概率模型（如贝叶斯网）或条件概率信息清晰的场景。</p>
<p>采样一个二维离散随机变量 $(X, Y)$ 的基本思路是：</p>
<blockquote>
<p>先从边缘分布 $P(X = x_i)$ 中采样一个 $x_i$，
然后根据这个 $x_i$，从条件分布 $P(Y = y_j \mid X = x_i)$ 中采样一个 $y_j$。</p></blockquote>
<p><strong>🧮 数学基础</strong></p>
<p>联合概率可分解为：</p>
$$
P(X = x_i, Y = y_j) = P(X = x_i) \cdot P(Y = y_j \mid X = x_i)
$$<p>所以我们可以按这个顺序采样！</p>
<p><strong>✅ 举个具体例子</strong></p>
<p>如果我们有联合分布表 $P(X,Y)$：</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>y=0</th>
          <th>y=1</th>
          <th>y=2</th>
          <th>合计</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>x=0</td>
          <td>0.1</td>
          <td>0.2</td>
          <td>0.1</td>
          <td>0.4</td>
      </tr>
      <tr>
          <td>x=1</td>
          <td>0.1</td>
          <td>0.2</td>
          <td>0.1</td>
          <td>0.4</td>
      </tr>
      <tr>
          <td>x=2</td>
          <td>0.05</td>
          <td>0.05</td>
          <td>0.1</td>
          <td>0.2</td>
      </tr>
  </tbody>
</table>
<p>那么<strong>边缘分布</strong>（对Y求和）：</p>
$$
P(X = 0) = 0.4,\quad P(X = 1) = 0.4,\quad P(X = 2) = 0.2
$$<p>以及<strong>条件分布</strong> $P(Y = y_j \mid X = x_i)$（每一行归一化）：</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>y=0</th>
          <th>y=1</th>
          <th>y=2</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>x=0</td>
          <td>0.25</td>
          <td>0.5</td>
          <td>0.25</td>
      </tr>
      <tr>
          <td>x=1</td>
          <td>0.25</td>
          <td>0.5</td>
          <td>0.25</td>
      </tr>
      <tr>
          <td>x=2</td>
          <td>0.25</td>
          <td>0.25</td>
          <td>0.5</td>
      </tr>
  </tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_2d_marginal_conditional</span>(x_vals, y_vals, joint_probs):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算边缘分布 P(X)</span>
</span></span><span style="display:flex;"><span>    P_X <span style="color:#f92672">=</span> joint_probs<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># shape (3,)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 计算条件分布 P(Y | X)</span>
</span></span><span style="display:flex;"><span>    P_Y_given_X <span style="color:#f92672">=</span> joint_probs <span style="color:#f92672">/</span> P_X[:, np<span style="color:#f92672">.</span>newaxis]  <span style="color:#75715e"># 每行除以对应 P(X)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. 采样 X</span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>choices(x_vals, weights<span style="color:#f92672">=</span>P_X)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    x_idx <span style="color:#f92672">=</span> x_vals<span style="color:#f92672">.</span>index(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. 根据 P(Y|X=x) 采样 Y</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>choices(y_vals, weights<span style="color:#f92672">=</span>P_Y_given_X[x_idx])[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (x, y)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 值域</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>y_vals <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 联合概率矩阵</span>
</span></span><span style="display:flex;"><span>joint_probs <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.1</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.1</span>],
</span></span><span style="display:flex;"><span>    [<span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.1</span>]
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>  <span style="color:#75715e"># 采样次数</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 采样</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> [sample_2d_marginal_conditional(x_vals, y_vals, joint_probs) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(N)]
</span></span><span style="display:flex;"><span>x_sample, y_sample <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> seaborn <span style="color:#66d9ef">as</span> sns
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;x&#39;</span>: x_sample, <span style="color:#e6db74">&#39;y&#39;</span>: y_sample})
</span></span><span style="display:flex;"><span>pivot_table <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>crosstab(df[<span style="color:#e6db74">&#39;x&#39;</span>], df[<span style="color:#e6db74">&#39;y&#39;</span>], normalize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;all&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>heatmap(joint_probs, annot<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YlGnBu&#34;</span>, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.3f&#34;</span>, xticklabels<span style="color:#f92672">=</span>y_vals, yticklabels<span style="color:#f92672">=</span>x_vals)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Theoretical Joint Distribution from Marginal + Conditional Sampling&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Y&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;X&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>sns<span style="color:#f92672">.</span>heatmap(pivot_table, annot<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YlGnBu&#34;</span>, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.3f&#34;</span>, xticklabels<span style="color:#f92672">=</span>y_vals, yticklabels<span style="color:#f92672">=</span>x_vals)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Empirical Joint Distribution from Marginal + Conditional Sampling&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Y&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;X&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_129_0.png" alt="png"></p>
<h2 id="采样连续分布">采样连续分布</h2>
<h3 id="格点采样器grid-sampler">格点采样器（Grid sampler）</h3>
<p><strong>格点采样器（Grid Sampler）</strong> 是一种基于二进制细分区间的<strong>递归采样方法</strong>，适用于<strong>近似从任意连续分布中采样</strong>，前提是我们可以<strong>计算任意区间的概率质量（积分）</strong>。</p>
<p>这个方法是<strong>用于高精度数值采样的构造性方法</strong>，特别适合：</p>
<ul>
<li>分布没有封闭形式的逆CDF；</li>
<li>但我们可以计算其 CDF 或区间概率；</li>
<li>想从该分布中精确采样。</li>
</ul>
<h4 id="-原理概述以-01-区间为例">🔁 原理概述（以 [0,1] 区间为例）</h4>
<p>目标：从某个连续概率密度函数 $f(x)$ 定义在 [0,1] 上采样。</p>
<blockquote>
<p>📖 即使随机变量是定义在区间$[a,b]$上的，我们也可以通过<strong>线性变换</strong>将其转换到$[0,1]$。别忘了最后采样后，需要再做一次线性逆变换。</p></blockquote>
<p><strong>🧱 Step 1: 二进制划分区间</strong></p>
<p>我们将区间 [0, 1] 分成 $2^N$ 个子区间，比如 $N = 3$ 时：</p>
<ul>
<li>000 → $[0, \frac{1}{8})$</li>
<li>001 → $[\frac{1}{8}, \frac{2}{8})$</li>
<li>&hellip;</li>
<li>111 → $[\frac{7}{8}, 1)$</li>
</ul>
<p>这些可以对应为 <strong>二进制编码的区间编号</strong>。</p>
<p><strong>🧠 Step 2: 利用条件概率构建一个样本点</strong></p>
<p>我们不一次性计算所有 $2^N$ 个区间的概率，而是通过一个<strong>逐位决策过程</strong>来“走”进一个区间。</p>
<p>假设我们已经生成了前 $k$ 位： $b_1 b_2 \dots b_k$</p>
<p>那么这一部分所对应的区间是：</p>
$$
I_k = \left[\frac{b}{2^k}, \frac{b+1}{2^k}\right), \quad b = \sum_{i=1}^k b_i \cdot 2^{k-i}
$$<p>下一位的值 $b_{k+1} \in \{0, 1\}$ 将进一步把 $I_k$ 分成左半或右半。</p>
<p>我们通过<strong>计算条件概率</strong>：</p>
$$
\mathbb{P}(b_{k+1} = 0 \mid b_1 b_2 \dots b_k) = \frac{\mathbb{P}(x \in \text{left half of } I_k)}{\mathbb{P}(x \in I_k)}
$$<p>用这个条件概率掷一个硬币，决定下一位是 0 还是 1。重复 $N$ 次，就得到了一个近似采样结果：</p>
$$
x = \sum_{i=1}^N b_i \cdot 2^{-i} \text{, where } b_i = \{0,1\}
$$<h4 id="-总结流程">📌 总结流程</h4>
<ol>
<li>
<p><strong>初始区间</strong>：[0,1]</p>
</li>
<li>
<p><strong>每一步</strong>：</p>
<ul>
<li>将当前区间分为左右两半</li>
<li>计算左半区间的概率 $p_L$</li>
<li>用 $p_L$ 进行伯努利采样，决定是走左边（bit=0）还是右边（bit=1）</li>
</ul>
</li>
<li>
<p><strong>迭代 N 次后</strong>，你就得到了一个二进制表达 $b_1b_2...b_N$</p>
</li>
<li>
<p><strong>最终采样值</strong>：$x = \sum_{i=1}^N b_i \cdot 2^{-i}$，属于 [0,1] 上的某个子区间中</p>
</li>
</ol>
<blockquote>
<p>我们也可以一次构造所有区间的概率，将其转换为离散型，再使用离散型随机变量的采样方法（例如，反函数法）进行采样。</p></blockquote>
<h4 id="-优点">✅ 优点</h4>
<ul>
<li><strong>适用于任意连续分布</strong>，只要能计算区间概率</li>
<li><strong>无需求逆CDF或标准变换</strong></li>
<li>可用于严格采样、测试、模拟复杂分布</li>
</ul>
<h4 id="-注意事项-1">⚠️ 注意事项</h4>
<ul>
<li>精度由 $N$ 控制：越大越精确，但计算代价越高；
<ul>
<li>$\epsilon=log_2N$</li>
</ul>
</li>
<li>必须能计算任意区间 $[a,b]$ 的概率：例如通过 CDF 函数；</li>
<li>和普通“先采 uniform 再求逆CDF”的方式不同，这是一种构造性的、位级别的采样方式。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置参数</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span> <span style="color:#75715e"># 树的深度（也即将 [0,1] 划分为 2^6 = 64 个区间）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">draw_path</span>(ax, level, x0, x1, path<span style="color:#f92672">=</span>[]):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> level <span style="color:#f92672">&gt;</span> N:
</span></span><span style="display:flex;"><span>        x_mid <span style="color:#f92672">=</span> (x0 <span style="color:#f92672">+</span> x1) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>level
</span></span><span style="display:flex;"><span>        ax<span style="color:#f92672">.</span>plot(x_mid, y, <span style="color:#e6db74">&#39;ko&#39;</span>)  <span style="color:#75715e"># 画叶子节点</span>
</span></span><span style="display:flex;"><span>        bin_label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(str(b) <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> path)
</span></span><span style="display:flex;"><span>        ax<span style="color:#f92672">.</span>text(x_mid, y <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.2</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>bin_label<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    x_mid <span style="color:#f92672">=</span> (x0 <span style="color:#f92672">+</span> x1) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>level
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(x_mid, y, <span style="color:#e6db74">&#39;ko&#39;</span>)  <span style="color:#75715e"># 当前节点</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 左边</span>
</span></span><span style="display:flex;"><span>    draw_path(ax, level <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, x0, x_mid, path <span style="color:#f92672">+</span> [<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot([x_mid, (x0 <span style="color:#f92672">+</span> x_mid) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>], [y, y <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;gray&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 右边</span>
</span></span><span style="display:flex;"><span>    draw_path(ax, level <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, x_mid, x1, path <span style="color:#f92672">+</span> [<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot([x_mid, (x1 <span style="color:#f92672">+</span> x_mid) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>], [y, y <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;gray&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 画图</span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>draw_path(ax, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#f92672">-</span>N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.5</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">1.05</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_yticks([])
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#34;Interval on [0,1]&#34;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Grid Sampling: Binary Tree Partition (N=6)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>, axis<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_132_0.png" alt="png"></p>
<h4 id="-举例">🧪 举例：$\text{Beta}(2,5)$）</h4>
<p><strong>目标</strong>：我们已知一个连续分布（如 Beta 分布）的 PDF，可以计算任意区间的概率，但不能直接反解其 CDF。</p>
<h5 id="step-1-将区间-0-1-离散化为-2ⁿ-个子区间">Step 1: 将区间 [0, 1] 离散化为 2ⁿ 个子区间</h5>
<p>比如 <code>N = 10</code>，将 <code>[0,1]</code> 均分为 1024 个小区间，每个区间宽度为 $\Delta x = \frac{1}{1024}$。</p>
<h5 id="step-2-在每个子区间的中点处计算-pdf并用这些近似概率来构造离散-pmf">Step 2: 在每个子区间的中点处计算 PDF，并用这些近似概率来构造离散 PMF</h5>
<p>我们用 beta.pdf 计算每个中点的概率密度，归一化得到一组近似的概率值 $p_i$，形成一个离散分布。</p>
<h5 id="step-3-构建-cdf然后使用一个-uniform01-随机变量-u-来查找-u-落入哪个累积概率区间">Step 3: 构建 CDF，然后使用一个 Uniform(0,1) 随机变量 <code>u</code> 来查找 <code>u</code> 落入哪个累积概率区间</h5>
<p>我们用 <code>np.searchsorted(cdf, u)</code> 找到对应区间，再返回该区间中点作为采样值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> beta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置 beta 分布参数</span>
</span></span><span style="display:flex;"><span>a, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>  <span style="color:#75715e"># Beta(2,5)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 样本数量和分割深度</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>  <span style="color:#75715e"># 将区间 [0,1] 分为 2^N = 1024 个小区间</span>
</span></span><span style="display:flex;"><span>num_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构建区间划分</span>
</span></span><span style="display:flex;"><span>intervals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>N <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>midpoints <span style="color:#f92672">=</span> (intervals[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> intervals[<span style="color:#ae81ff">1</span>:]) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># 区间中点</span>
</span></span><span style="display:flex;"><span>probs <span style="color:#f92672">=</span> beta<span style="color:#f92672">.</span>pdf(midpoints, a, b) <span style="color:#75715e"># 区间中点的概率密度</span>
</span></span><span style="display:flex;"><span>probs <span style="color:#f92672">/=</span> probs<span style="color:#f92672">.</span>sum()  <span style="color:#75715e"># 归一化成概率，从而获得一个新的离散分布</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构建累积分布函数（CDF）</span>
</span></span><span style="display:flex;"><span>cdf <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cumsum(probs) <span style="color:#75715e"># 基于这个新的离散分布构建 CDF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Grid sampling: 在每次采样时只用一个均匀随机数查找所属区间</span>
</span></span><span style="display:flex;"><span>uniform_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand(num_samples)
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> u <span style="color:#f92672">in</span> uniform_samples:
</span></span><span style="display:flex;"><span>    idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>searchsorted(cdf, u)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 选择该区间的中点作为采样值</span>
</span></span><span style="display:flex;"><span>    samples<span style="color:#f92672">.</span>append(midpoints[idx])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化结果</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>pdf <span style="color:#f92672">=</span> beta<span style="color:#f92672">.</span>pdf(x, a, b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sampled Histogram&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, pdf, <span style="color:#e6db74">&#39;r-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Beta PDF a=</span><span style="color:#e6db74">{</span>a<span style="color:#e6db74">}</span><span style="color:#e6db74">, b=</span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Sampling Beta(2,5) using Grid Sampler (ε=</span><span style="color:#e6db74">{</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>N)<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Density&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_134_0.png" alt="png"></p>
<h4 id="另一种实现以-beta25-分布为例">另一种实现：以 Beta(2,5) 分布为例</h4>
<p>步骤：每次将区间一分为二，计算左边的概率，用它进行伯努利采样，最终拼出一个二进制小数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> beta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">grid_sampler</span>(cdf_func, N):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    使用 Grid Sampler 从 [0,1] 上采样
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param cdf_func: 累积分布函数（例如 scipy.stats.beta(a,b).cdf）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param N: 迭代次数（控制精度）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :return: 采样值 x ∈ [0,1]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    left, right <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>    x_bits <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(N):
</span></span><span style="display:flex;"><span>        mid <span style="color:#f92672">=</span> (left <span style="color:#f92672">+</span> right) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        p_left <span style="color:#f92672">=</span> (cdf_func(mid) <span style="color:#f92672">-</span> cdf_func(left)) <span style="color:#f92672">/</span> (cdf_func(right) <span style="color:#f92672">-</span> cdf_func(left))  <span style="color:#75715e"># 归一化条件概率</span>
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> p_left  <span style="color:#75715e"># 伯努利采样</span>
</span></span><span style="display:flex;"><span>        x_bits<span style="color:#f92672">.</span>append(<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">if</span> b <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 更新区间</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> b:
</span></span><span style="display:flex;"><span>            right <span style="color:#f92672">=</span> mid
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            left <span style="color:#f92672">=</span> mid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 将二进制结果转换为 [0,1] 上的小数值</span>
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> sum(bit <span style="color:#f92672">*</span> (<span style="color:#ae81ff">0.5</span> <span style="color:#f92672">**</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#66d9ef">for</span> i, bit <span style="color:#f92672">in</span> enumerate(x_bits))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置参数</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>  <span style="color:#75715e"># 精度控制</span>
</span></span><span style="display:flex;"><span>samples <span style="color:#f92672">=</span> [grid_sampler(beta(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>cdf, N) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10000</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可视化</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sampled via Grid Sampler&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x, beta<span style="color:#f92672">.</span>pdf(x, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>), label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Beta(2,5) PDF&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Grid Sampling from Beta(2,5)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Density&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_136_0.png" alt="png"></p>
<h3 id="接受-拒绝采样acceptance-rejection-sampling">接受-拒绝采样（Acceptance-Rejection Sampling）</h3>
<p>Acceptance-Rejection Sampling（接受-拒绝采样，简称 AR 采样）是一种非常重要且直观的 <strong>从复杂分布中采样的方法</strong>，特别适合当：</p>
<ul>
<li>✅ 目标分布的 <strong>概率密度函数（PDF）可计算</strong>；</li>
<li>🚫 目标分布的 <strong>CDF 无法反解</strong>，不能直接使用反函数采样；</li>
<li>✅ 你有一个<strong>容易采样的辅助分布（proposal distribution）</strong>。</li>
</ul>
<p><strong>🧠 基本思想</strong></p>
<p>如果你不能直接从复杂分布 $p(x)$ 采样，那就：</p>
<ol>
<li>从一个容易采样的分布 $q(x)$ 采样；</li>
<li>然后“筛选”出落在目标分布 $p(x)$ 下的点！</li>
</ol>
<h4 id="-理论基础">📌 理论基础</h4>
<p>从易采样的分布中<strong>筛选出</strong>服从 $p(x)$ 的样本</p>
<p>我们引入一个 proposal distribution $q(x)$，并要求存在常数 $M \geq 1$，使得：</p>
$$
p(x) \leq M q(x),\quad \text{对所有 } x
$$<p>这样，$Mq(x)$ 就是 $p(x)$ 的“上界”。</p>
<h5 id="-理论基础一联合分布与边缘分布">✅ 理论基础一：<strong>联合分布与边缘分布</strong></h5>
<p>我们构造一个二维联合分布：</p>
$$
(x, u) \sim \text{joint distribution}, \quad x \sim q(x),\quad u \sim \text{Uniform}(0, 1)
$$<p>然后定义一个二维区域：</p>
$$
\mathcal{A} = \left\{ (x, u) : u \leq \frac{p(x)}{Mq(x)} \right\}
$$<p>那么我们在 $(x, u) \in \mathcal{A}$ 中保留的 $x$，其<strong>边缘分布</strong>就是 $p(x)$！</p>
<p>这点可从联合密度推导：</p>
<p>设联合密度为：</p>
$$
f(x, u) = q(x) \cdot \mathbb{1}\left( 0 \leq u \leq \frac{p(x)}{Mq(x)} \right)
$$<p>那么对 $x$ 的边缘密度：</p>
$$
f_{\text{accepted}}(x) = \int_0^{\frac{p(x)}{Mq(x)}} q(x) \, du = q(x)\cdot \frac{p(x)}{Mq(x)} = \frac{p(x)}{M}
$$<p>即每个保留下来的 $x$，分布比例为 $\propto p(x)$。说明接受的样本正比于 $p(x)$，即我们从 $p(x)$ 中采样了！</p>
<h5 id="-理论基础二抽样一致性">✅ 理论基础二：<strong>抽样一致性</strong></h5>
<p>虽然我们使用了“拒绝”的机制，但这其实就等价于<strong>对一个更大的分布进行条件采样</strong>：</p>
<p>我们从联合分布 $f(x, u) = q(x) \cdot \text{Unif}[0, Mq(x)]$ 中采样，然后保留符合条件的点。</p>
<p><strong>保留下来的 $x$</strong> 的分布是：</p>
$$
p_{\text{accept}}(x) = \frac{p(x)}{M}
\Rightarrow \text{Normalize后仍是 } p(x)
$$<h4 id="-算法步骤">🎲 算法步骤</h4>
<p>对于每个样本：</p>
<ol>
<li>从 proposal 分布 $q(x)$ 中采样一个候选点 $x \sim q(x)$</li>
<li>从均匀分布 $u \sim \text{Uniform}(0,1)$ 采一个辅助变量</li>
<li>接受 $x$ 当且仅当：</li>
</ol>
$$
u \leq \frac{f(x)}{M \cdot q(x)}
$$<p>否则拒绝，重新采样。</p>
<h4 id="-接受率和效率">📈 接受率和效率</h4>
<p>接受率（acceptance rate）为：</p>
$$
\text{Accept Rate} = \frac{1}{M}
$$<p>因此，<strong>选择尽可能接近 $f(x)$ 的 $M \cdot q(x)$</strong> 很重要，这样可以减少浪费。</p>
<h4 id="-优点-1">✅ 优点</h4>
<ul>
<li>不需要归一化常数 $Z$，可用于复杂分布（如未归一化的 posterior）</li>
<li>理论简单，直观</li>
</ul>
<h4 id="-缺点">⚠️ 缺点</h4>
<ul>
<li>接受率可能非常低（尤其是高维情况下）</li>
<li>必须找到合适的 proposal 分布和合理的 M</li>
</ul>
<p><strong>🧠 总结一句话</strong></p>
<blockquote>
<p><strong>接受-拒绝采样就是用一个容易采样的“外壳”包住目标分布，然后随机撒点，留下落在目标区域的那些点。</strong></p></blockquote>
<h4 id="又见">又见</h4>
<ul>
<li><a href="https://bocaiwen.github.io/accept-reject-sampling.html">接受/拒绝采样 (Accept-Reject Sampling)</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> plotly.graph_objects <span style="color:#66d9ef">as</span> go
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.stats <span style="color:#f92672">import</span> beta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置目标分布和 proposal</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> beta<span style="color:#f92672">.</span>pdf(x, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">g</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1.0</span>  <span style="color:#75715e"># Uniform(0,1) 上的密度</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设定常数 M</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>fx_vals <span style="color:#f92672">=</span> f(x_vals)
</span></span><span style="display:flex;"><span>gx_vals <span style="color:#f92672">=</span> g(x_vals)
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>max(fx_vals)  <span style="color:#75715e"># M &gt;= max(f(x)/g(x))，在这个例子中 g(x)=1，所以M=max(f(x))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 开始采样</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>x_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, N)
</span></span><span style="display:flex;"><span>u_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, N)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>accepted_x <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>accepted_y <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>rejected_x <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>rejected_y <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> x, u <span style="color:#f92672">in</span> zip(x_samples, u_samples):
</span></span><span style="display:flex;"><span>    threshold <span style="color:#f92672">=</span> f(x) <span style="color:#f92672">/</span> M
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> u <span style="color:#f92672">&lt;</span> threshold:
</span></span><span style="display:flex;"><span>        accepted_x<span style="color:#f92672">.</span>append(x)
</span></span><span style="display:flex;"><span>        accepted_y<span style="color:#f92672">.</span>append(u <span style="color:#f92672">*</span> M)  <span style="color:#75715e"># 映射回 f(x) 的高度空间</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        rejected_x<span style="color:#f92672">.</span>append(x)
</span></span><span style="display:flex;"><span>        rejected_y<span style="color:#f92672">.</span>append(u <span style="color:#f92672">*</span> M)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建交互图</span>
</span></span><span style="display:flex;"><span>fig <span style="color:#f92672">=</span> go<span style="color:#f92672">.</span>Figure()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 目标分布 f(x)</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>x_vals, y<span style="color:#f92672">=</span>fx_vals, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lines&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Target f(x)&#39;</span>, line<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Proposal 分布 M * g(x)</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>x_vals, y<span style="color:#f92672">=</span>[M <span style="color:#f92672">*</span> g(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> x_vals], mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lines&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Mg(x)&#39;</span>, line<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, dash<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dash&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Accepted samples</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>accepted_x, y<span style="color:#f92672">=</span>accepted_y, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;markers&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Accepted&#39;</span>, marker<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Rejected samples</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>add_trace(go<span style="color:#f92672">.</span>Scatter(x<span style="color:#f92672">=</span>rejected_x, y<span style="color:#f92672">=</span>rejected_y, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;markers&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rejected&#39;</span>, marker<span style="color:#f92672">=</span>dict(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, opacity<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>update_layout(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Acceptance-Rejection Sampling with Joint Distribution View&#39;</span>,
</span></span><span style="display:flex;"><span>                  xaxis_title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x&#39;</span>, yaxis_title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;y&#39;</span>,
</span></span><span style="display:flex;"><span>                  height<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, width<span style="color:#f92672">=</span><span style="color:#ae81ff">800</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.animation <span style="color:#66d9ef">as</span> animation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Target distribution: p(x) ∝ exp(-x^2 / 2) (standard normal, unnormalized)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">p</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Proposal distribution: uniform over [-3, 3]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">q</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>full_like(x, <span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># M such that p(x) &lt;= M * q(x)</span>
</span></span><span style="display:flex;"><span>M <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>pi) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span>)  <span style="color:#75715e"># since max(p) = 1 when x=0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generate samples</span>
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>n_samples <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>x_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>, n_samples)
</span></span><span style="display:flex;"><span>u_vals <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(<span style="color:#ae81ff">0</span>, M <span style="color:#f92672">*</span> q(x_vals), n_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create acceptance mask</span>
</span></span><span style="display:flex;"><span>accept <span style="color:#f92672">=</span> u_vals <span style="color:#f92672">&lt;=</span> p(x_vals)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Prepare animation frames</span>
</span></span><span style="display:flex;"><span>x_range <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">500</span>)
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>frames <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, n_samples, <span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>clear()
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(x_range, p(x_range), label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Target p(x)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(x_range, M <span style="color:#f92672">*</span> q(x_range), label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;M * q(x)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(x_vals[:i], u_vals[:i], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rejected&#39;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(x_vals[:i][accept[:i]], u_vals[:i][accept[:i]], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Accepted&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, M <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.1</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>max(q(x_range)))
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Acceptance-Rejection Sampling&#34;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;upper right&#39;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Capture the current frame</span>
</span></span><span style="display:flex;"><span>    frame <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>gcf()<span style="color:#f92672">.</span>canvas<span style="color:#f92672">.</span>copy_from_bbox(ax<span style="color:#f92672">.</span>bbox)
</span></span><span style="display:flex;"><span>    frames<span style="color:#f92672">.</span>append([plt<span style="color:#f92672">.</span>scatter([], [])])  <span style="color:#75715e"># dummy to hold frames</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Re-render using FuncAnimation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(i):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>clear()
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(x_range, p(x_range), label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Target p(x)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(x_range, M <span style="color:#f92672">*</span> q(x_range), label<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;M * q(x) (M=</span><span style="color:#e6db74">{</span>M<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(x_vals[:i], u_vals[:i], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rejected&#39;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>scatter(x_vals[:i][accept[:i]], u_vals[:i][accept[:i]], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Accepted&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, M <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.1</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>max(q(x_range)))
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Acceptance-Rejection Sampling (Step </span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;upper right&#39;</span>)
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ani <span style="color:#f92672">=</span> animation<span style="color:#f92672">.</span>FuncAnimation(fig, update, frames<span style="color:#f92672">=</span>range(<span style="color:#ae81ff">0</span>, n_samples, <span style="color:#ae81ff">20</span>), interval<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Save as GIF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> PillowWriter
</span></span><span style="display:flex;"><span>ani<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;acceptance_rejection_sampling.gif&#34;</span>, writer<span style="color:#f92672">=</span>PillowWriter(fps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>close(fig)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> Image
</span></span><span style="display:flex;"><span>Image(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;acceptance_rejection_sampling.gif&#34;</span>)
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/acceptance_rejection_sampling.gif" alt="png"></p>
<h1 id="附录">附录</h1>
<h2 id="从已知二维随机变量-x-y-中采样其极坐标变换后的随机变量">从已知二维随机变量 (X, Y) 中采样其极坐标变换后的随机变量</h2>
<p>从已知二维随机变量 $(X, Y)$ 中采样其极坐标变换后的随机变量 $(R^2, \alpha)$，其中：</p>
<ul>
<li>$r^2 = x^2 + y^2$，范围为 $(0, \infty)$</li>
<li>$\alpha = \arctan(y/x)$，范围为 $(0, 2\pi)$</li>
</ul>
<h3 id="-1-变量变换和雅可比jacobian推导">🧮 1. 变量变换和雅可比（Jacobian）推导</h3>
<p>我们定义新的变量：</p>
$$
\begin{cases}
u(x,y) = r^2 = x^2 + y^2 \\
v(x,y) = \alpha = \arctan\left(\frac{y}{x}\right)
\end{cases}
\Rightarrow
\begin{cases}
x = \sqrt{u} \cos v \\
y = \sqrt{u} \sin v
\end{cases}
$$<p>计算 <a href="https://zh.wikipedia.org/wiki/%E9%9B%85%E5%8F%AF%E6%AF%94%E7%9F%A9%E9%98%B5">Jacobian</a>：</p>
<p>我们计算从 $(u, v)$ 到 $(x, y)$ 的雅可比行列式：</p>
$$
J = 
\begin{vmatrix}
\frac{\partial x}{\partial u} & \frac{\partial x}{\partial v} \\
\frac{\partial y}{\partial u} & \frac{\partial y}{\partial v}
\end{vmatrix}
$$<p>先求导：</p>
<ul>
<li>$\frac{\partial x}{\partial u} = \frac{1}{2\sqrt{u}} \cos v$</li>
<li>$\frac{\partial x}{\partial v} = -\sqrt{u} \sin v$</li>
<li>$\frac{\partial y}{\partial u} = \frac{1}{2\sqrt{u}} \sin v$</li>
<li>$\frac{\partial y}{\partial v} = \sqrt{u} \cos v$</li>
</ul>
<p>代入 Jacobian：</p>
$$
J = 
\left| 
\begin{matrix}
\frac{1}{2\sqrt{u}} \cos v & -\sqrt{u} \sin v \\
\frac{1}{2\sqrt{u}} \sin v & \sqrt{u} \cos v
\end{matrix}
\right|
= \frac{1}{2\sqrt{u}} \cos v \cdot \sqrt{u} \cos v + \sqrt{u} \sin v \cdot \frac{1}{2\sqrt{u}} \sin v
= \frac{1}{2}(\cos^2 v + \sin^2 v) = \frac{1}{2}
$$<p>所以雅可比行列式为：</p>
$$
|J| = \frac{1}{2}
$$<h3 id="-2-密度函数变换公式">🧪 2. 密度函数变换公式</h3>
<p>若 $(X, Y)$ 的联合密度为 $f_{X,Y}(x,y)$，则变换后：</p>
$$
f_{R^2, \alpha}(u, v) = f_{X,Y}(x(u,v), y(u,v)) \cdot \left|J\right|^{-1} = 2 f_{X,Y}(\sqrt{u} \cos v, \sqrt{u} \sin v)
$$<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构建 (x, y) 网格</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span>X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 原始坐标系下的函数：r^2 = x^2 + y^2, alpha = arctan2(y, x)</span>
</span></span><span style="display:flex;"><span>R2 <span style="color:#f92672">=</span> X<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> Y<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>Alpha <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arctan2(Y, X)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制 r^2 等高线</span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r2_levels <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">3.0</span>]
</span></span><span style="display:flex;"><span>alpha_levels <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span>np<span style="color:#f92672">.</span>pi, <span style="color:#f92672">-</span>np<span style="color:#f92672">.</span>pi<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, np<span style="color:#f92672">.</span>pi<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, np<span style="color:#f92672">.</span>pi]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cont1 <span style="color:#f92672">=</span> ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>contour(X, Y, R2, levels<span style="color:#f92672">=</span>r2_levels, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Blues&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>clabel(cont1, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;r²=</span><span style="color:#e6db74">%.1f</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Contours of $r^2 = x^2 + y^2$&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;y&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#34;equal&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 绘制 alpha 等高线</span>
</span></span><span style="display:flex;"><span>cont2 <span style="color:#f92672">=</span> ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>contour(X, Y, Alpha, levels<span style="color:#f92672">=</span>alpha_levels, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coolwarm&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>clabel(cont2, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;α=</span><span style="color:#e6db74">%.2f</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;Contours of $\alpha = \arctan2(y, x)$&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;y&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#34;equal&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/1_mcmc_basics_142_0.png" alt="png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> FuncAnimation
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> HTML
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建网格</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)
</span></span><span style="display:flex;"><span>points <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>stack([X<span style="color:#f92672">.</span>ravel(), Y<span style="color:#f92672">.</span>ravel()], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 非线性变换（模拟 Jacobian 拉伸效果）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">transform</span>(points, alpha):
</span></span><span style="display:flex;"><span>    x, y <span style="color:#f92672">=</span> points[:, <span style="color:#ae81ff">0</span>], points[:, <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> y<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    theta <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arctan2(y, x)
</span></span><span style="display:flex;"><span>    r_new <span style="color:#f92672">=</span> r <span style="color:#f92672">+</span> alpha <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sin(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> theta)  <span style="color:#75715e"># 添加扰动模拟形变</span>
</span></span><span style="display:flex;"><span>    x_new <span style="color:#f92672">=</span> r_new <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>cos(theta)
</span></span><span style="display:flex;"><span>    y_new <span style="color:#f92672">=</span> r_new <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sin(theta)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>stack([x_new, y_new], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 初始化画布</span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>scat <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>scatter(points[:, <span style="color:#ae81ff">0</span>], points[:, <span style="color:#ae81ff">1</span>], s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_aspect(<span style="color:#e6db74">&#39;equal&#39;</span>)
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Jacobian Deformation Demo&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 帧更新函数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(frame):
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>sin(frame <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    new_points <span style="color:#f92672">=</span> transform(points, alpha)
</span></span><span style="display:flex;"><span>    scat<span style="color:#f92672">.</span>set_offsets(new_points)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> scat,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 动画</span>
</span></span><span style="display:flex;"><span>ani <span style="color:#f92672">=</span> FuncAnimation(fig, update, frames<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, interval<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, blit<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存为 GIF（可选）</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> matplotlib.animation <span style="color:#f92672">import</span> PillowWriter
</span></span><span style="display:flex;"><span>ani<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;jacobian_area_deformation.gif&#34;</span>, writer<span style="color:#f92672">=</span>PillowWriter(fps<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>close(fig)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> Image
</span></span><span style="display:flex;"><span>Image(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;jacobian_area_deformation.gif&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#HTML(ani.to_jshtml())</span>
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/2_random-variables/jacobian_area_deformation.gif" alt="png"></p>
<h3 id="-3-采样方案设计">🎯 3. 采样方案设计</h3>
<h4 id="-一般步骤">✅ 一般步骤：</h4>
<ol>
<li>
<p>从已知联合分布 $f_{X,Y}(x,y)$ 中采样一组 $(x,y)$</p>
</li>
<li>
<p>将其转换为极坐标形式：</p>
$$
   r^2 = x^2 + y^2, \quad \alpha = \arctan2(y, x)
   $$</li>
<li>
<p>得到样本 $(r^2, \alpha)$</p>
</li>
</ol>
<h4 id="-反过来若你有-如何采样">✅ 反过来：若你有 $f_{R^2, \alpha}(r^2, \alpha)$，如何采样？</h4>
<ul>
<li>
<p>方法一（<strong>反函数采样</strong>）：若 $r^2$ 和 $\alpha$ 可独立分布表示，直接分别采样再组合。</p>
</li>
<li>
<p>方法二（<strong>接受-拒绝采样</strong>）：设计 proposal distribution，比如：</p>
<ul>
<li>$r^2 \sim \text{Gamma}(k, \theta)$</li>
<li>$\alpha \sim \text{Uniform}(0, 2\pi)$</li>
</ul>
<p>然后利用目标密度 $f_{R^2, \alpha}$ 与 proposal 做比值，使用 rejection rule 接受或拒绝。</p>
</li>
</ul>


        
          <div class="blog-tags">
            
              
              <a href="http://localhost:1313/zh-cn/tags/%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F/">随机变量</a>&nbsp;
            
              
              <a href="http://localhost:1313/zh-cn/tags/%E9%87%87%E6%A0%B7/">采样</a>&nbsp;
            
              
              <a href="http://localhost:1313/zh-cn/tags/%E9%9A%8F%E6%9C%BA%E8%AF%95%E9%AA%8C/">随机试验</a>&nbsp;
            
              
              <a href="http://localhost:1313/zh-cn/tags/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a>&nbsp;
            
              
              <a href="http://localhost:1313/zh-cn/tags/%E6%95%B0%E5%AD%A6/">数学</a>&nbsp;
            
              
              <a href="http://localhost:1313/zh-cn/tags/python/">python</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2frandom-variables%2f&amp;text=%e9%9a%8f%e6%9c%ba%e5%8f%98%e9%87%8f%e5%92%8c%e9%87%87%e6%a0%b7&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2frandom-variables%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2frandom-variables%2f&amp;title=%e9%9a%8f%e6%9c%ba%e5%8f%98%e9%87%8f%e5%92%8c%e9%87%87%e6%a0%b7" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2frandom-variables%2f&amp;title=%e9%9a%8f%e6%9c%ba%e5%8f%98%e9%87%8f%e5%92%8c%e9%87%87%e6%a0%b7" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2frandom-variables%2f&amp;title=%e9%9a%8f%e6%9c%ba%e5%8f%98%e9%87%8f%e5%92%8c%e9%87%87%e6%a0%b7" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=http%3a%2f%2flocalhost%3a1313%2fzh-cn%2fpost%2fmcmc-statics%2frandom-variables%2f&amp;description=%e9%9a%8f%e6%9c%ba%e5%8f%98%e9%87%8f%e5%92%8c%e9%87%87%e6%a0%b7" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">也可以看看</h4>
                  <ul>
                
                
                    <li><a href="/zh-cn/post/mcmc-statics/probability/">什么是概率？</a></li>
                
                    <li><a href="/zh-cn/post/python-geodata/01-intro/">第 1 课：遥感数据与 Python 环境入门</a></li>
                
                    <li><a href="/zh-cn/notes/%E6%A6%82%E7%8E%87%E8%AE%BA%E4%B8%8E%E6%95%B0%E7%90%86%E7%BB%9F%E8%AE%A1_%E9%9A%8F%E6%9C%BA%E4%BA%8B%E4%BB%B6%E5%8F%8A%E5%85%B6%E6%A6%82%E7%8E%87/">【课程笔记】概率论与数理统计｜随机事件及其概率</a></li>
                
                    <li><a href="/zh-cn/notes/%E6%A6%82%E7%8E%87%E8%AE%BA%E4%B8%8E%E6%95%B0%E7%90%86%E7%BB%9F%E8%AE%A1_%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/">【课程笔记】概率论与数理统计｜预备知识</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
          
            <li class="next">
              <a href="http://localhost:1313/zh-cn/post/mcmc-statics/probability/" data-toggle="tooltip" data-placement="top" title="什么是概率？">后一篇 &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:ele.qiong@gmail.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/ictar" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/qiongjie-xu" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://www.xuqiongjie.com">Qiongjie.X</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2025
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://localhost:1313/zh-cn/">琼呀</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="https://gohugo.io">Hugo v0.147.4</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 移植自 <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="http://localhost:1313/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="http://localhost:1313/js/load-photoswipe.js"></script>










    
  </body>
</html>

