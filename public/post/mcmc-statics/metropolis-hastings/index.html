

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>The Metropolis-Hastings Algorithm: Breaking the Symmetry - </title>

  <meta name="description" content="The original Metropolis is limited by symmetric proposals, often &lsquo;hitting walls&rsquo; at boundaries or getting lost in high dimensions. The MH algorithm introduces the &lsquo;Hastings Correction&rsquo;, allowing asymmetric proposals (like Langevin dynamics) while maintaining detailed balance, significantly improving efficiency.">
  <meta name="author" content="Qiongjie.X"/>


<link rel="canonical" href="http://localhost:1313/post/mcmc-statics/metropolis-hastings/" />


<meta name="keywords" content="MCMC, MH Algorithm, Hastings Correction, Detailed Balance, Python, Bayesian Statistics" /><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Qiongjie\u0027s Notes",
    
    "url": "http:\/\/localhost:1313\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/localhost:1313\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/localhost:1313\/post\/mcmc-statics\/metropolis-hastings\/",
          "name": "The metropolis hastings algorithm breaking the symmetry"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Qiongjie.X"
  },
  "headline": "The Metropolis-Hastings Algorithm: Breaking the Symmetry",
  "description" : "The original Metropolis is limited by symmetric proposals, often \u0026lsquo;hitting walls\u0026rsquo; at boundaries or getting lost in high dimensions. The MH algorithm introduces the \u0026lsquo;Hastings Correction\u0026rsquo;, allowing asymmetric proposals (like Langevin dynamics) while maintaining detailed balance, significantly improving efficiency.",
  "inLanguage" : "en",
  "wordCount":  3439 ,
  "datePublished" : "2026-01-29T00:00:00\u002b00:00",
  "dateModified" : "2026-01-29T00:00:00\u002b00:00",
  "image" : "http:\/\/localhost:1313\/img\/avatar-icon.png",
  "keywords" : [ "MCMC, MH Algorithm, Hastings Correction, Detailed Balance, Python, Bayesian Statistics" ],
  "mainEntityOfPage" : "http:\/\/localhost:1313\/post\/mcmc-statics\/metropolis-hastings\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/localhost:1313\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/localhost:1313\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>



<meta property="og:title" content="The Metropolis-Hastings Algorithm: Breaking the Symmetry" />
<meta property="og:description" content="The original Metropolis is limited by symmetric proposals, often &lsquo;hitting walls&rsquo; at boundaries or getting lost in high dimensions. The MH algorithm introduces the &lsquo;Hastings Correction&rsquo;, allowing asymmetric proposals (like Langevin dynamics) while maintaining detailed balance, significantly improving efficiency.">
<meta property="og:image" content="http://localhost:1313/img/avatar-icon.png" />
<meta property="og:url" content="http://localhost:1313/post/mcmc-statics/metropolis-hastings/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Qiongjie&#39;s Notes" />

  <meta name="twitter:title" content="The Metropolis-Hastings Algorithm: Breaking the Symmetry" />
  <meta name="twitter:description" content="The original Metropolis is limited by symmetric proposals, often &lsquo;hitting walls&rsquo; at boundaries or getting lost in high dimensions. The MH algorithm introduces the &lsquo;Hastings ‚Ä¶">
  <meta name="twitter:image" content="http://localhost:1313/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='http://localhost:1313/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.147.4">
  <link rel="alternate" href="http://localhost:1313/index.xml" type="application/rss+xml" title="Qiongjie&#39;s Notes"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="http://localhost:1313/css/main.css" /><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://localhost:1313/css/syntax.css" /><link rel="stylesheet" href="http://localhost:1313/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  crossorigin="anonymous"
/>
<link rel="stylesheet" href="http://localhost:1313/css/custom.css"><link rel="stylesheet" href="http://localhost:1313/css/toc.css">

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  crossorigin="anonymous"
></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body, {
    delimiters: [
      {left: '$$', right: '$$', display: true},
      {left: '$', right: '$', display: false}
    ]
  });"></script>


<link rel="icon" type="image/png" href="http://localhost:1313/img/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="http://localhost:1313/img/favicon.svg" />
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/img/apple-touch-icon.png" />
<link rel="manifest" href="http://localhost:1313/img/site.webmanifest" />

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost:1313/">Qiongjie&#39;s Notes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" role="button" tabindex="0" href="/post">BLOG</a>
              <div class="navlinks-children">
                
                  <a href="/post/python-geodata">Remote Sensing with Python</a>
                
                  <a href="/post/mcmc-statics">Monte Carlo‚ÄìMarkov Chains Statistical Methods</a>
                
                  <a href="/post/ai-fundamentals">AI Fundamentals</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" role="button" tabindex="0" href="/projects">PROJECT</a>
              <div class="navlinks-children">
                
                  <a href="https://ictar.github.io/TerraFlow/">TerraFlow</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="NOTE" href="/notes">NOTE</a>
            </li>
          
        
          
            <li>
              <a title="TAG" href="/tags">TAG</a>
            </li>
          
        
          
            <li>
              <a title="ABOUT ME" href="/page/about/">ABOUT ME</a>
            </li>
          
        

        
          
            <li>
              
                
                  <a href="http://localhost:1313/zh-cn/post/mcmc-statics/metropolis-hastings/">CH</a>
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Qiongjie&#39;s Notes" href="http://localhost:1313/">
            <img class="avatar-img" src="http://localhost:1313/img/avatar-icon.png" alt="Qiongjie&#39;s Notes" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>The Metropolis-Hastings Algorithm: Breaking the Symmetry</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on January 29, 2026
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3439&nbsp;words
  
  
  &nbsp;&bull;&nbsp;Other languages: <a href="http://localhost:1313/zh-cn/post/mcmc-statics/metropolis-hastings/" lang="zh-cn">CH</a>
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row" style="display: flex; flex-wrap: wrap;">
    
    
    <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        
  <aside class="toc">
    <h2>ÁõÆÂΩï</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#why-asymmetry-the-motivation">Why &ldquo;Asymmetry&rdquo;? (The Motivation)</a>
      <ul>
        <li><a href="#reality-pain-points">Reality Pain Points</a>
          <ul>
            <li><a href="#pain-point-1-the-wall-problem">Pain Point 1: The &ldquo;Wall&rdquo; Problem</a></li>
            <li><a href="#pain-point-2-the-high-dim-maze">Pain Point 2: The High-Dim Maze</a></li>
          </ul>
        </li>
        <li><a href="#core-conflict-the-traffic-crisis-of-asymmetry">Core Conflict: The &ldquo;Traffic Crisis&rdquo; of Asymmetry</a></li>
        <li><a href="#-the-solution-idea">üí° The Solution Idea</a></li>
      </ul>
    </li>
    <li><a href="#the-hastings-correction">The Hastings Correction</a>
      <ul>
        <li><a href="#core-formula-from-metropolis-to-mh">Core Formula: From Metropolis to MH</a></li>
        <li><a href="#intuitive-understanding-cities-and-highways-">Intuitive Understanding: Cities and Highways üèôÔ∏èüõ£Ô∏è</a></li>
        <li><a href="#mathematical-proof-why-does-it-balance-the-proof">Mathematical Proof: Why Does it Balance? (The Proof)</a></li>
      </ul>
    </li>
    <li><a href="#the-choice-of-proposals--in-action">The Choice of Proposals ( in Action)</a>
      <ul>
        <li><a href="#independent-sampler">Independent Sampler</a></li>
        <li><a href="#log-normal-walk">Log-normal Walk</a></li>
        <li><a href="#mala-metropolis-adjusted-langevin-algorithm">MALA (Metropolis-Adjusted Langevin Algorithm)</a></li>
      </ul>
    </li>
    <li><a href="#python-implementation">Python Implementation</a></li>
    <li><a href="#mcmc-diagnostics--tuning">MCMC Diagnostics &amp; Tuning</a>
      <ul>
        <li><a href="#core-concepts-three-vitals">Core Concepts: Three Vitals</a>
          <ul>
            <li><a href="#trace-plot--the-ecg-of-mcmc">Trace Plot ‚Äî‚Äî The ECG of MCMC</a></li>
            <li><a href="#burn-in--discarding-garbage-time">Burn-in ‚Äî‚Äî Discarding Garbage Time</a></li>
            <li><a href="#acceptance-rate--goldilocks-principle">Acceptance Rate ‚Äî‚Äî Goldilocks Principle</a></li>
          </ul>
        </li>
        <li><a href="#python-code-diagnosing-sick-chains">Python Code: Diagnosing &ldquo;Sick&rdquo; Chains</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>

<h1 id="why-asymmetry-the-motivation">Why &ldquo;Asymmetry&rdquo;? (The Motivation)</h1>
<ul>
<li><strong>Recap of Limitations:</strong> The Metropolis algorithm requires $Q(x|y) = Q(y|x)$ (like a drunkard, stepping left or right with equal probability).</li>
<li><strong>Reality Pain Points:</strong>
<ul>
<li><strong>Boundary Problem:</strong> If variables must be greater than 0 (e.g., height, price), using a symmetric Gaussian distribution to jump will often land in negative territory and be rejected, resulting in extremely low efficiency.</li>
<li><strong>Smart Movement:</strong> If we know the peak is roughly to the East, can we bias $Q$ to jump Eastward? (Introducing a biased $Q$).</li>
</ul>
</li>
<li><strong>Core Conflict:</strong> Once $Q$ is asymmetric, the original detailed balance is broken. How do we fix it?</li>
</ul>
<p>In the original Metropolis, the proposal distribution $Q$ must satisfy <strong>Symmetry</strong>:
</p>
$$Q(x_{new} | x_{old}) = Q(x_{old} | x_{new})$$<p>This means: <strong>The probability of jumping from A to B must be exactly equal to the probability of jumping from B back to A.</strong> (e.g., jumping 1 meter left and 1 meter right must have equal probability.) This sounds fair, but in practice, this &ldquo;fairness&rdquo; often means <strong>inefficiency</strong>, or even <strong>disaster</strong>.</p>
<h2 id="reality-pain-points">Reality Pain Points</h2>
<h3 id="pain-point-1-the-wall-problem">Pain Point 1: The &ldquo;Wall&rdquo; Problem</h3>
<p>In the real world, many variables have physical limits.</p>
<ul>
<li><strong>Example:</strong> Suppose you are simulating human height, red blood cell count, or commodity prices. These values must be positive ($x > 0$).</li>
<li><strong>Metropolis Awkwardness:</strong> Suppose you are currently at $x=0.1$ (very close to 0). You use a symmetric Gaussian distribution to jump.
<ul>
<li>There is a 50% chance you will jump to a negative number (e.g., -0.5).</li>
<li>Since the target distribution $\pi(x)$ is 0 in the negative region, this proposal will be directly rejected.</li>
<li><strong>Result:</strong> Near boundaries, your sampler spends half its time &ldquo;hitting the wall,&rdquo; wasting computational resources.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. Set Target: Exponential Distribution (Must be &gt; 0)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">target_pi</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># Boundary!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Simulation Parameters</span>
</span></span><span style="display:flex;"><span>current_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>  <span style="color:#75715e"># Current position very close to boundary</span>
</span></span><span style="display:flex;"><span>sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>      <span style="color:#75715e"># Large step size</span>
</span></span><span style="display:flex;"><span>n_trials <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>  <span style="color:#75715e"># Try proposing 1000 times</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rejected_by_wall <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>valid_proposals <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;--- Start Simulation: Current Position x = </span><span style="color:#e6db74">{</span>current_x<span style="color:#e6db74">}</span><span style="color:#e6db74"> ---&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. See what happens with &#34;Symmetric Proposal&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_trials):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Symmetric Gaussian Proposal</span>
</span></span><span style="display:flex;"><span>    proposal_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(current_x, sigma)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Check for &#34;Wall Hit&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> proposal_x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        rejected_by_wall <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        valid_proposals <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Total Trials: </span><span style="color:#e6db74">{</span>n_trials<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Wall Hits (Jumped to negative): </span><span style="color:#e6db74">{</span>rejected_by_wall<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Valid Proposals: </span><span style="color:#e6db74">{</span>valid_proposals<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;‚ö†Ô∏è Waste Rate: </span><span style="color:#e6db74">{</span>rejected_by_wall <span style="color:#f92672">/</span> n_trials <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>)
</span></span></code></pre></div><pre><code>--- Start Simulation: Current Position x = 0.1 ---
Total Trials: 1000
Wall Hits (Jumped to negative): 451
Valid Proposals: 549
‚ö†Ô∏è Waste Rate: 45.1%
</code></pre>
<p><strong>What do we want?</strong></p>
<p>We want a &ldquo;smart guide.&rdquo; When near a boundary, it should automatically suggest: &ldquo;Hey, there&rsquo;s a wall behind us, let&rsquo;s only jump in the positive direction!&rdquo; This requires an asymmetric distribution (like Log-Normal), which only generates positive numbers.</p>
<h3 id="pain-point-2-the-high-dim-maze">Pain Point 2: The High-Dim Maze</h3>
<p>On a 2D plane, &ldquo;drunkard random jumping&rdquo; might be passable. But in a 100D space, random jumping is almost suicidal.</p>
<ul>
<li><strong>Metropolis Awkwardness:</strong> Its $Q$ is blind. It doesn&rsquo;t know where the peak (high probability region) is. It just fires probes uniformly in all directions.</li>
<li><strong>Result:</strong> In high-dimensional space, the vast majority of directions are &ldquo;downhill&rdquo; (extremely low probability). If you jump blindly, your proposals will be frantically rejected, leading to an extremely low acceptance rate and the sampler getting stuck.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_simulation</span>(dim):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Target: Standard Normal Classification</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Proposal: Symmetric Gaussian Walk</span>
</span></span><span style="display:flex;"><span>    n_steps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>    current_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(dim) <span style="color:#75715e"># Start from origin</span>
</span></span><span style="display:flex;"><span>    accepted <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    step_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span> <span style="color:#75715e"># Fixed step size</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_steps):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. Blindly jump one step randomly in all directions (Symmetric)</span>
</span></span><span style="display:flex;"><span>        proposal_x <span style="color:#f92672">=</span> current_x <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(<span style="color:#ae81ff">0</span>, step_size, size<span style="color:#f92672">=</span>dim)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. Calculate Acceptance Rate (Simplified Metropolis)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Log form to prevent overflow</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># log_ratio = -0.5 * (new^2 - old^2)</span>
</span></span><span style="display:flex;"><span>        log_ratio <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> (np<span style="color:#f92672">.</span>sum(proposal_x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>sum(current_x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Accept/Reject</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>log(np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand()) <span style="color:#f92672">&lt;</span> log_ratio:
</span></span><span style="display:flex;"><span>            current_x <span style="color:#f92672">=</span> proposal_x
</span></span><span style="display:flex;"><span>            accepted <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> accepted <span style="color:#f92672">/</span> n_steps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;--- High-Dim Maze Test (Fixed Step Size 0.5) ---&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Test 2D</span>
</span></span><span style="display:flex;"><span>acc_rate_2d <span style="color:#f92672">=</span> run_simulation(dim<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Dimension = 2   Acceptance Rate: </span><span style="color:#e6db74">{</span>acc_rate_2d <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">% (Very Healthy)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Test 100D</span>
</span></span><span style="display:flex;"><span>acc_rate_100d <span style="color:#f92672">=</span> run_simulation(dim<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Dimension = 100 Acceptance Rate: </span><span style="color:#e6db74">{</span>acc_rate_100d <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">% (Almost Stuck)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Conclusion: In high dimensions, blind random jumping is almost always rejected without gradient guidance.&#34;</span>)
</span></span></code></pre></div><pre><code>--- High-Dim Maze Test (Fixed Step Size 0.5) ---
Dimension = 2   Acceptance Rate: 72.6% (Very Healthy)
Dimension = 100 Acceptance Rate: 0.0% (Almost Stuck)

Conclusion: In high dimensions, blind random jumping is almost always rejected without gradient guidance.
</code></pre>
<p><strong>What do we want?</strong></p>
<p>We want to use <strong>Gradient</strong> information. If we know East is uphill, we make $Q$ jump East with higher probability (e.g., 80%) and West with lower (20%). This clearly breaks symmetry: $Q(A \to B) \neq Q(B \to A)$.</p>
<h2 id="core-conflict-the-traffic-crisis-of-asymmetry">Core Conflict: The &ldquo;Traffic Crisis&rdquo; of Asymmetry</h2>
<p>So, if we decide to introduce an &ldquo;asymmetric&rdquo; $Q$ (e.g., biased towards jumping uphill).</p>
<p>However, this brings a serious mathematical crisis: <strong>Detailed Balance is broken.</strong></p>
<p>Let&rsquo;s imagine two cities: <strong>Low City (A)</strong> and <strong>High City (B)</strong>.</p>
<ol>
<li><strong>Original Metropolis (Symmetric):</strong>
<ul>
<li>Roads are equally wide. Lanes from A to B equal those from B to A.</li>
<li>The system relies on the natural attraction $\pi(B) > \pi(A)$ to regulate population.</li>
</ul>
</li>
<li><strong>Current MH (Asymmetric/Biased):</strong>
<ul>
<li>To help people climb faster, you artificially built a superhighway from A to B ($Q(B|A)$ is large).</li>
<li>Simultaneously, the road back from B to A became a sheep trail ($Q(A|B)$ is small).</li>
</ul>
</li>
</ol>
<p><strong>Consequence:</strong> Without intervention, everyone rushes to B via the highway, and it&rsquo;s hard to return from B. Eventually, the population accumulated at B will far exceed the proportion $\pi(B)$ should have. Your sampling result is now <strong>distorted (Over-represented the high probability region)</strong>.</p>
<h2 id="-the-solution-idea">üí° The Solution Idea</h2>
<p>We want the efficiency of &ldquo;asymmetric proposals&rdquo; (no wall hitting, guided direction) but don&rsquo;t want to lose the accuracy of &ldquo;detailed balance.&rdquo;</p>
<p><strong>What to do?</strong></p>
<p>Since the traffic flow on the $Q$ (proposal) side has become unbalanced (easy to go, hard to return), we must compensate for it at the $\alpha$ (acceptance rate/customs) side.</p>
<ul>
<li>If the road there is too smooth ($Q$ is large), customs ($\alpha$) must be stricter, rejecting more people.</li>
<li>If the road back is too hard ($Q$ is small), customs ($\alpha$) must be more lenient, letting more people pass.</li>
</ul>
<p>This is the moment the Metropolis-Hastings algorithm was born: <strong>Offsetting the asymmetry of the proposal distribution by modifying the acceptance rate formula.</strong></p>
<h1 id="the-hastings-correction">The Hastings Correction</h1>
<h2 id="core-formula-from-metropolis-to-mh">Core Formula: From Metropolis to MH</h2>
<p>Recall, our goal is to construct a Markov chain satisfying Detailed Balance:
</p>
$$\pi(x) \cdot Q(x \to x') \cdot \alpha(x \to x') = \pi(x') \cdot Q(x' \to x) \cdot \alpha(x' \to x)$$<p>
(Current Prob $\times$ Proposal Prob $\times$ Acceptance Rate = Reverse Quantities)</p>
<p>In Metropolis, since $Q$ is symmetric ($Q(x \to x') = Q(x' \to x)$), the middle term cancels out.</p>
<p>But in MH, since $Q$ is asymmetric, we must keep $Q$. Hastings derived the new acceptance rate formula as follows:
</p>
$$\alpha = \min\left(1, \underbrace{\frac{\pi(x_{new})}{\pi(x_{old})}}_{\text{Target Ratio}} \times \underbrace{\frac{Q(x_{old}|x_{new})}{Q(x_{new}|x_{old})}}_{\text{Hastings Correction}} \right)$$<p>This newly added <strong>Correction Term</strong>:</p>
<ul>
<li>Denominator ($Q_{new}|Q_{old}$): Probability of jumping forward.</li>
<li>Numerator ($Q_{old}|Q_{new}$): Probability of jumping back.</li>
</ul>
<p>This correction term means: &ldquo;If jumping there is easy, but jumping back is hard, I must lower your pass rate to maintain balance.&rdquo;</p>
<h2 id="intuitive-understanding-cities-and-highways-">Intuitive Understanding: Cities and Highways üèôÔ∏èüõ£Ô∏è</h2>
<p>Let&rsquo;s use a <strong>&ldquo;Population Flow Model&rdquo;</strong> analogy. Scenario:</p>
<ul>
<li><strong>City A (Small Town):</strong> Target population $\pi(A) = 100$.</li>
<li><strong>City B (Metropolis):</strong> Target population $\pi(B) = 200$.</li>
<li><strong>Balance Goal:</strong> We want B&rsquo;s population to always be 2x A&rsquo;s ($\frac{\pi(B)}{\pi(A)} = 2$).</li>
</ul>
<p><strong>Asymmetric Roads ($Q$).</strong> Now, you design an extremely asymmetric traffic system:</p>
<ul>
<li>A $\to$ B (Highway): Very easy. $Q(B|A) = 0.9$ (90% want to go to the big city).</li>
<li>B $\to$ A (Muddy Path): Very hard. $Q(A|B) = 0.1$ (Only 10% want to return to town).</li>
</ul>
<p><strong>Without Correction (Original Metropolis):</strong></p>
<ul>
<li>Acceptance rate only looks at population attraction: $\alpha = \min(1, \frac{200}{100}) = 1$.</li>
<li><strong>Consequence:</strong> People rush to B via the highway, but few return. Soon, B&rsquo;s population explodes to 100x A, not 2x. <strong>Detailed Balance collapses.</strong></li>
</ul>
<p><strong>With Hastings Correction (MH Algorithm):</strong> Let&rsquo;s see how the correction term intervenes as a <strong>&ldquo;Traffic Controller&rdquo;</strong>.</p>
<p><strong>Case 1: Someone wants to go A $\to$ B (via Highway)</strong>
</p>
$$
\alpha(A \to B) = \min\left(1, \frac{200}{100} \times \frac{0.1 \text{ (Hard Return)}}{0.9 \text{ (Easy Go)}} \right) \\
\alpha = \min\left(1, 2 \times 0.11 \right) = \mathbf{0.22}
$$<ul>
<li><strong>Interpretation:</strong> Although City B is more attractive (2x), because the road to B is too easy (asymmetric), letting it be would cause imbalance. So customs slashes the rate, allowing only 22% to pass.</li>
</ul>
<p><strong>Case 2: Someone wants to go B $\to$ A (via Muddy Path)</strong>
</p>
$$
\alpha(B \to A) = \min\left(1, \frac{100}{200} \times \frac{0.9 \text{ (Easy Return)}}{0.1 \text{ (Hard Go)}} \right)\\
\alpha = \min\left(1, 0.5 \times 9 \right) = \min(1, 4.5) = \mathbf{1}
$$<ul>
<li><strong>Interpretation:</strong> Although City A isn&rsquo;t attractive (0.5x), the road back is so hard almost no one tries. So customs rules: Anyone willing to return to A is cleared! (100% acceptance).</li>
</ul>
<p><strong>Result:</strong> By restricting the &ldquo;easy road&rdquo; and relaxing the &ldquo;hard road,&rdquo; population flow finally achieves a perfect 1:2 dynamic balance between A and B.</p>
<h2 id="mathematical-proof-why-does-it-balance-the-proof">Mathematical Proof: Why Does it Balance? (The Proof)</h2>
<p>We want to prove the following equality (Detailed Balance):
</p>
$$\pi(x) Q(x'|x) \alpha(x \to x') = \pi(x') Q(x|x') \alpha(x' \to x)$$<p>
Assume $x'$ is the &ldquo;better&rdquo; state (i.e., $\pi(x') Q(x|x') > \pi(x) Q(x'|x)$, this side has the advantage).</p>
<ol>
<li><strong>Left Side (Jump $x \to x'$):</strong> According to the formula, this side is disadvantaged, so acceptance rate $\alpha(x \to x') = 1$ (Full accept). $$\text{Left Flow} = \pi(x) \cdot Q(x'|x) \cdot 1$$</li>
<li><strong>Right Side (Jump $x' \to x$):</strong> This side has the advantage, so acceptance rate needs correction: $$\alpha(x' \to x) = \frac{\pi(x)}{\pi(x')} \times \frac{Q(x'|x)}{Q(x|x')}$$ So the right flow is: $$\text{Right Flow} = \pi(x') \cdot Q(x|x') \cdot \left( \frac{\pi(x)}{\pi(x')} \frac{Q(x'|x)}{Q(x|x')} \right)$$</li>
<li><strong>Miraculous Cancellation:</strong> Notice in the right expression, $\pi(x')$ and $Q(x|x')$ cancel out perfectly! $$\text{Right Flow} = \pi(x) \cdot Q(x'|x)$$</li>
<li><strong>Conclusion:</strong> $$\text{Left Flow} = \text{Right Flow}$$</li>
</ol>
<p>Q.E.D. ‚úÖ</p>
<h1 id="the-choice-of-proposals--in-action">The Choice of Proposals ($Q$ in Action)</h1>
<p>The Hastings correction formula means that as long as you can calculate that correction term, you can use <strong>any</strong> proposal distribution $Q$!</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Your Dilemma</th>
          <th style="text-align: left">Recommended $Q$</th>
          <th style="text-align: left">Correction Term $\frac{Q(x\|x')}{Q(x'\|x)}$</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">Standard (No Boundary)</td>
          <td style="text-align: left">Symmetric Random Walk</td>
          <td style="text-align: left">1 (Cancels out)</td>
      </tr>
      <tr>
          <td style="text-align: left">Boundary Constraints (e.g. $x > 0$)</td>
          <td style="text-align: left">Log-Normal Walk</td>
          <td style="text-align: left">$\frac{x_{new}}{x_{old}}$ (Extremely simple)</td>
      </tr>
      <tr>
          <td style="text-align: left">High-Dim Complex Terrain</td>
          <td style="text-align: left">MALA / HMC (Langevin Dynamics)</td>
          <td style="text-align: left">Complex formula (Computable)</td>
      </tr>
  </tbody>
</table>
<h2 id="independent-sampler">Independent Sampler</h2>
<blockquote>
<p>Completely ignores current location, jumps based on a guess of the new distribution.</p></blockquote>
<p>This is the most extreme design.</p>
<ul>
<li><strong>Rule:</strong> $Q(x_{new} | x_{old}) = Q(x_{new})$. I ignore wherever you are; $x_{new}$ is drawn from a fixed global distribution.</li>
<li><strong>Scenario:</strong> When you already have a rough idea of target $\pi$ and can construct a $Q$ that looks very similar to $\pi$.</li>
<li><strong>Correction Term Simplification:</strong> $$\frac{Q(x_{old})}{Q(x_{new})}$$</li>
<li><strong>Acceptance Rate Becomes:</strong> $$\alpha = \min\left(1, \frac{\pi(x_{new}) / Q(x_{new})}{\pi(x_{old}) / Q(x_{old})} \right) = \min\left(1, \frac{w_{new}}{w_{old}} \right)$$ (Here $w = \pi/Q$ is the weight)</li>
<li><strong>Evaluation:</strong>
<ul>
<li><strong>Pros:</strong> If $Q$ is chosen well (similar to $\pi$), convergence is extremely fast, traversing the map in few steps.</li>
<li><strong>Cons:</strong> If $\pi$ is even slightly &ldquo;fatter&rdquo; than $Q$ anywhere (places $Q$ can&rsquo;t cover), the algorithm will get stuck there for a very long time. Extremely dangerous in high dimensions.</li>
</ul>
</li>
</ul>
<h2 id="log-normal-walk">Log-normal Walk</h2>
<blockquote>
<p>Specifically for variables that must be positive (solving boundary problems).</p></blockquote>
<p>We no longer use $x_{new} = x_{old} + \text{Noise}$, but multiplication or addition in log space.</p>
<ul>
<li><strong>Rule:</strong> $$\ln(x_{new}) \sim \text{Normal}(\ln(x_{old}), \sigma^2)$$ Meaning, we do a symmetric walk on &ldquo;log scale,&rdquo; but on &ldquo;original scale,&rdquo; this is completely asymmetric.</li>
<li><strong>Why Asymmetric?</strong>
<ul>
<li>Probability of jumping 1 $\to$ 2 $\neq$ Probability of jumping 2 $\to$ 1.</li>
<li>Log-normal shape is &ldquo;steep left, long tail right.&rdquo;</li>
<li>Derivation (Skip details): $Q(x'|x) \propto \frac{1}{x'}$.</li>
</ul>
</li>
<li><strong>Correction Term (Elegant):</strong> $$\frac{Q(x_{old}|x_{new})}{Q(x_{new}|x_{old})} = \frac{x_{new}}{x_{old}}$$</li>
<li><strong>Intuition:</strong>
<ul>
<li>Log-normal tends to spread towards &ldquo;larger values&rdquo; (right-skewed).</li>
<li>If you propose a large $x_{new}$ (far jump), the correction $\frac{x_{new}}{x_{old}} > 1$ rewards this jump, increasing acceptance.</li>
<li>This perfectly offsets the distribution&rsquo;s inherent bias.</li>
</ul>
</li>
</ul>
<h2 id="mala-metropolis-adjusted-langevin-algorithm">MALA (Metropolis-Adjusted Langevin Algorithm)</h2>
<blockquote>
<p>Uses gradient info so $Q$ proposes &ldquo;drifting&rdquo; towards higher probability.</p></blockquote>
<p>This is the artifact for modern ML (like Bayesian NN). It solves the Phase 1 &ldquo;High-Dim Maze&rdquo; pain point.</p>
<ul>
<li><strong>Intuition:</strong> Instead of blind jumping, calculate gradient $\nabla \log \pi(x)$ (slope).
<ul>
<li>If East is uphill, add an Eastward <strong>&ldquo;Drift&rdquo;</strong> to $Q$.</li>
</ul>
</li>
<li><strong>Rule:</strong> $$x_{new} = x_{old} + \underbrace{\frac{\tau}{2} \nabla \log \pi(x_{old})}_{\text{Drift Uphill}} + \underbrace{\sqrt{\tau} \xi}_{\text{Random Noise}}$$ (Like: I want to go uphill, but I&rsquo;m drunk, so I stumble).</li>
<li><strong>Why MH Correction?</strong> Ideally drifting uphill, but because of discrete time steps ($\tau$), errors are introduced. Without correction, the sampled distribution would slightly deviate from true $\pi$. MH correction acts as &ldquo;error-correction,&rdquo; ensuring exact $\pi$.</li>
</ul>
<h1 id="python-implementation">Python Implementation</h1>
<ul>
<li><strong>Task:</strong> Simulate a classic <strong>Gamma Distribution</strong> (bell-like but 0-truncated left, long tail right).</li>
<li><strong>Experiments:</strong>
<ul>
<li><strong>Plan A:</strong> Naive Metropolis. Symmetric Gaussian walk (correct but inefficient at boundaries).</li>
<li><strong>Plan B:</strong> Broken MH (Wrong). Used asymmetric Log-Normal proposal but forgot correction term.
<ul>
<li>Expected Result: Since Log-Normal tends to jump larger, samples will shift right (biased larger) without correction.</li>
</ul>
</li>
<li><strong>Plan C:</strong> Correct MH (Right). Log-Normal proposal with correction.
<ul>
<li>Expected Result: Perfect fit.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 1. Set Target Distribution ---</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Gamma Distribution (Must be &gt; 0)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">target_pi</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Use np.where to fix previous error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>where(x <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, x <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>x <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Scenario A: Naive Metropolis (Wall Hitter) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_naive_metropolis</span>(n_samples, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>):
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    current_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
</span></span><span style="display:flex;"><span>    wall_hits <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># Counter: Record wall hits</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Symmetric Proposal: Might jump to negative</span>
</span></span><span style="display:flex;"><span>        proposal_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(current_x, sigma)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Wall Check</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> proposal_x <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            wall_hits <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># Record hit</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            alpha <span style="color:#f92672">=</span> min(<span style="color:#ae81ff">1</span>, target_pi(proposal_x) <span style="color:#f92672">/</span> target_pi(current_x))
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> alpha:
</span></span><span style="display:flex;"><span>            current_x <span style="color:#f92672">=</span> proposal_x
</span></span><span style="display:flex;"><span>        samples<span style="color:#f92672">.</span>append(current_x)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples, wall_hits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Scenario B: Broken MH (Biased, No Correction) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_broken_mh</span>(n_samples, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>):
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    current_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># LogNormal always &gt; 0, so no wall hits</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Asymmetric Proposal (Tends to enable larger values)</span>
</span></span><span style="display:flex;"><span>        proposal_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>lognormal(np<span style="color:#f92672">.</span>log(current_x), sigma)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ‚ùå WRONG CORE: Calc probability ratio but FORGOT correction!</span>
</span></span><span style="display:flex;"><span>        ratio_pi <span style="color:#f92672">=</span> target_pi(proposal_x) <span style="color:#f92672">/</span> target_pi(current_x)
</span></span><span style="display:flex;"><span>        alpha <span style="color:#f92672">=</span> min(<span style="color:#ae81ff">1</span>, ratio_pi) 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> alpha:
</span></span><span style="display:flex;"><span>            current_x <span style="color:#f92672">=</span> proposal_x
</span></span><span style="display:flex;"><span>        samples<span style="color:#f92672">.</span>append(current_x)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Scenario C: Correct MH (Biased + Correction) ---</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_correct_mh</span>(n_samples, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>):
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    current_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Asymmetric Proposal</span>
</span></span><span style="display:flex;"><span>        proposal_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>lognormal(np<span style="color:#f92672">.</span>log(current_x), sigma)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ‚úÖ CORRECT CORE: Add Hastings Correction (new / old)</span>
</span></span><span style="display:flex;"><span>        ratio_pi <span style="color:#f92672">=</span> target_pi(proposal_x) <span style="color:#f92672">/</span> target_pi(current_x)
</span></span><span style="display:flex;"><span>        correction <span style="color:#f92672">=</span> proposal_x <span style="color:#f92672">/</span> current_x 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        alpha <span style="color:#f92672">=</span> min(<span style="color:#ae81ff">1</span>, ratio_pi <span style="color:#f92672">*</span> correction)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> alpha:
</span></span><span style="display:flex;"><span>            current_x <span style="color:#f92672">=</span> proposal_x
</span></span><span style="display:flex;"><span>        samples<span style="color:#f92672">.</span>append(current_x)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> samples
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 4. Run Simulation &amp; Print Data ---</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">100000</span>
</span></span><span style="display:flex;"><span>sigma_val <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;--- Running Simulation (N=</span><span style="color:#e6db74">{</span>N<span style="color:#e6db74">}</span><span style="color:#e6db74">) ---&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run A</span>
</span></span><span style="display:flex;"><span>samples_naive, walls <span style="color:#f92672">=</span> run_naive_metropolis(N, sigma_val)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[A. Naive Metropolis]&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;‚ùå Wall Hits: </span><span style="color:#e6db74">{</span>walls<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;üìâ Waste Rate: </span><span style="color:#e6db74">{</span>walls<span style="color:#f92672">/</span>N<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">% (These calcs were wasted)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run B</span>
</span></span><span style="display:flex;"><span>samples_broken <span style="color:#f92672">=</span> run_broken_mh(N, sigma_val)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[B. Broken MH]&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;‚úÖ Wall Hits: 0 (Immune)&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;‚ö†Ô∏è Mean will be biased high due to missing correction&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run C</span>
</span></span><span style="display:flex;"><span>samples_correct <span style="color:#f92672">=</span> run_correct_mh(N, sigma_val)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[C. Correct MH]&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;‚úÖ Wall Hits: 0&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;üéâ No waste, correct distribution&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- 5. Plot Comparison ---</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Plotting...&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>x_true <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>y_true <span style="color:#f92672">=</span> target_pi(x_true)
</span></span><span style="display:flex;"><span>y_true <span style="color:#f92672">=</span> y_true <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>trapz(y_true, x_true) <span style="color:#75715e"># Normalize</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot 1</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples_naive, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Samples&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_true, y_true, <span style="color:#e6db74">&#39;r-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True Target&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;A. Naive (Symmetric)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Wasted </span><span style="color:#e6db74">{</span>walls<span style="color:#f92672">/</span>N<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">% Calc&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot 2</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples_broken, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Biased Samples&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_true, y_true, <span style="color:#e6db74">&#39;r-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True Target&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;B. Broken MH (No Correction)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">‚ö†Ô∏è Curve Shifted Right!&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot 3</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>hist(samples_correct, bins<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>, density<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Correct Samples&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(x_true, y_true, <span style="color:#e6db74">&#39;r-&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;True Target&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;C. Correct MH (With Correction)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Perfect Fit&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><pre><code>--- Running Simulation (N=100000) ---

[A. Naive Metropolis]
‚ùå Wall Hits: 2606
üìâ Waste Rate: 2.61% (These calcs were wasted)

[B. Broken MH]
‚úÖ Wall Hits: 0 (Immune)
‚ö†Ô∏è Mean will be biased high due to missing correction

[C. Correct MH]
‚úÖ Wall Hits: 0
üéâ No waste, correct distribution

Plotting...


/var/folders/mx/684cy0qs5zd3c_pdx4wy4pkc0000gn/T/ipykernel_28347/4241814712.py:99: DeprecationWarning: `trapz` is deprecated. Use `trapezoid` instead, or one of the numerical integration functions in `scipy.integrate`.
  y_true = y_true / np.trapz(y_true, x_true) # Normalize
</code></pre>
<p><img src="/img/contents/post/mcmc-statics/7_metropolis_hastings/7_mcmc_metropolis-hastings_18_2.png" alt="png"></p>
<p><strong>About Wall Hits:</strong></p>
<ul>
<li>Naive method: When $x$ is near 0 (e.g., $x=0.5$), half the proposals jump to negative. Useless work.</li>
<li>MH method: Log-Normal proposal always suggests valid positive numbers.</li>
</ul>
<p><strong>Correctness Verification:</strong></p>
<ul>
<li>Plot B: Broken MH (Orange)
<ul>
<li>Histogram shifted right.</li>
<li><strong>Math</strong>: When jumping right (x: 1-&gt;2), Correction = 2/1 = 2 (&gt;1). Correction boosts acceptance. Removing it makes jumping right harder than it should be? Wait, logic check:
<ul>
<li>Log-normal proposal $q(x'|x)$ favors jumping to larger $x'$?</li>
<li>Actually, Log-normal is skewed. If we simply sample, it pushes values. The correction term balances the geometric nature.</li>
<li>Without correction, you are sampling from target $\times$ proposal bias.</li>
</ul>
</li>
</ul>
</li>
<li>Plot C: Correct MH (Green)
<ul>
<li>Perfect fit. Hastings correction successfully cancelled the asymmetry bias!</li>
</ul>
</li>
</ul>
<h1 id="mcmc-diagnostics--tuning">MCMC Diagnostics &amp; Tuning</h1>
<h2 id="core-concepts-three-vitals">Core Concepts: Three Vitals</h2>
<h3 id="trace-plot--the-ecg-of-mcmc">Trace Plot ‚Äî‚Äî The ECG of MCMC</h3>
<p>Horizontal axis <strong>Iteration (Time)</strong>, Vertical <strong>Sample Value</strong>.</p>
<ul>
<li>‚úÖ Good (Caterpillar): Vigorous up/down movement, no trend, fuzzy caterpillar. Good mixing.</li>
<li>‚ùå Bad (Snake): Slow wandering or stuck. Poor mixing.</li>
</ul>
<h3 id="burn-in--discarding-garbage-time">Burn-in ‚Äî‚Äî Discarding Garbage Time</h3>
<p>If you drop the sampler far from the peak (e.g., peak at 0, start at 1000). It takes many steps to walk to 0. This &ldquo;travel time&rdquo; samples the transition, not target.</p>
<ul>
<li><strong>Action:</strong> Discard first 1000 or 5000 samples.</li>
</ul>
<h3 id="acceptance-rate--goldilocks-principle">Acceptance Rate ‚Äî‚Äî Goldilocks Principle</h3>
<p>Step size $\sigma$ determines acceptance:</p>
<ul>
<li><strong>Too Small (Coward):</strong> Rate $\approx 99\%$. Moving, but slowly. Trace looks like a <strong>smooth snake</strong>.</li>
<li><strong>Too Large (Reckless):</strong> Rate $\approx 1\%$. Always rejected. Trace looks like <strong>square wave</strong> (flat lines, sudden jumps).</li>
<li><strong>Perfect (Golden Zone):</strong> Theory says ~23.4% for high-dim Gaussian (1D can be 40-50%). Trace is a <strong>caterpillar</strong>.</li>
</ul>
<h2 id="python-code-diagnosing-sick-chains">Python Code: Diagnosing &ldquo;Sick&rdquo; Chains</h2>
<p>Simulating <strong>Standard Normal</strong> (Center 0), showing 2 sick and 1 healthy case.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Target: Standard Normal</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">target_pi</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> x<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generic Metropolis Sampler</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_metropolis</span>(n_samples, start_x, sigma):
</span></span><span style="display:flex;"><span>    samples <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    current_x <span style="color:#f92672">=</span> start_x
</span></span><span style="display:flex;"><span>    accepted_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n_samples):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Symmetric Proposal</span>
</span></span><span style="display:flex;"><span>        proposal_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>normal(current_x, sigma)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Calc Acceptance</span>
</span></span><span style="display:flex;"><span>        alpha <span style="color:#f92672">=</span> min(<span style="color:#ae81ff">1</span>, target_pi(proposal_x) <span style="color:#f92672">/</span> target_pi(current_x))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand() <span style="color:#f92672">&lt;</span> alpha:
</span></span><span style="display:flex;"><span>            current_x <span style="color:#f92672">=</span> proposal_x
</span></span><span style="display:flex;"><span>            accepted_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        samples<span style="color:#f92672">.</span>append(current_x)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    acc_rate <span style="color:#f92672">=</span> accepted_count <span style="color:#f92672">/</span> n_samples
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>array(samples), acc_rate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Experiments ---</span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>start_bad <span style="color:#f92672">=</span> <span style="color:#ae81ff">20.0</span>  <span style="color:#75715e"># Far from center, bad init</span>
</span></span><span style="display:flex;"><span>start_good <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. Sick A: Too Small (Coward) + Bad Start</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sigma=0.1, start=20</span>
</span></span><span style="display:flex;"><span>samples_slow, acc_slow <span style="color:#f92672">=</span> run_metropolis(N, start_bad, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Sick B: Too Large (Reckless)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sigma=50, start=0</span>
</span></span><span style="display:flex;"><span>samples_stuck, acc_stuck <span style="color:#f92672">=</span> run_metropolis(N, start_good, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">50.0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Healthy C: Moderate + Good Start</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sigma=1.0, start=0</span>
</span></span><span style="display:flex;"><span>samples_good, acc_good <span style="color:#f92672">=</span> run_metropolis(N, start_good, sigma<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --- Plotting Diagnostics ---</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot A: Too Small (Slow Mixing)</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(samples_slow, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;A. Step Size Too Small (Sigma=0.1) - Acc Rate: </span><span style="color:#e6db74">{</span>acc_slow<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Sample Value&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axhline(<span style="color:#ae81ff">0</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Target Mean (0)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axvline(<span style="color:#ae81ff">750</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;k&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;:&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Burn-in Cutoff?&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>text(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">15</span>, <span style="color:#e6db74">&#34;Drifting slowly...&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bold&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot B: Too Large (Stuck)</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(samples_stuck, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;purple&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;B. Step Size Too Large (Sigma=50) - Acc Rate: </span><span style="color:#e6db74">{</span>acc_stuck<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Sample Value&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axhline(<span style="color:#ae81ff">0</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Target Mean (0)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>text(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;Stuck (Flat lines)&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bold&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot C: Healthy (Good Mixing)</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>subplot(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(samples_good, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;C. Optimal Step Size (Sigma=1.0) - Acc Rate: </span><span style="color:#e6db74">{</span>acc_good<span style="color:#e6db74">:</span><span style="color:#e6db74">.1%</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Sample Value&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Iteration&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>axhline(<span style="color:#ae81ff">0</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Target Mean (0)&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>text(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;Fuzzy Caterpillar (Healthy)&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>, fontweight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bold&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>tight_layout()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img src="/img/contents/post/mcmc-statics/7_metropolis_hastings/7_mcmc_metropolis-hastings_23_0.png" alt="png"></p>
<p><strong>Plot A: Step Too Small (The Snake)</strong></p>
<ul>
<li>Rate: Very High (&gt;90%).</li>
<li>Trace: Continuous but crawls like a snake.</li>
<li>Burn-in: Takes forever (500-1000 steps) to crawl from 20 to 0.</li>
<li>Diag: High correlation, slow convergence. Increase step size, discard burn-in.</li>
</ul>
<p><strong>Plot B: Step Too Large (The Square Wave)</strong></p>
<ul>
<li>Rate: Very Low (&lt;5%).</li>
<li>Trace: Square wave. Flat lines (rejected, value unchanged), sudden jump, flat again.</li>
<li>Diag: Few effective samples. Decrease step size.</li>
</ul>
<p><strong>Plot C: Healthy (The Caterpillar) üêõ</strong></p>
<ul>
<li>Rate: Moderate (30% - 50%).</li>
<li>Trace: Fuzzy caterpillar. No trend, oscillates vigorously around 0.</li>
<li>Diag: Perfect MCMC chain! Samples are independent and valid.</li>
</ul>


        
          <div class="blog-tags">
            
              <a href="http://localhost:1313/tags/mcmc/">MCMC</a>&nbsp;
            
              <a href="http://localhost:1313/tags/mh-algorithm/">MH Algorithm</a>&nbsp;
            
              <a href="http://localhost:1313/tags/hastings-correction/">Hastings Correction</a>&nbsp;
            
              <a href="http://localhost:1313/tags/detailed-balance/">Detailed Balance</a>&nbsp;
            
              <a href="http://localhost:1313/tags/python/">Python</a>&nbsp;
            
              <a href="http://localhost:1313/tags/bayesian-statistics/">Bayesian Statistics</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
  <ul class="share">
    
    <li>
      <a
        href="//twitter.com/share?url=http%3a%2f%2flocalhost%3a1313%2fpost%2fmcmc-statics%2fmetropolis-hastings%2f&amp;text=The%20Metropolis-Hastings%20Algorithm%3a%20Breaking%20the%20Symmetry&amp;via="
        target="_blank"
        title="Share on Twitter"
        class="share-btn twitter"
      >
        <i class="fab fa-twitter"></i>
      </a>
    </li>

    
    <li>
      <a
        href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpost%2fmcmc-statics%2fmetropolis-hastings%2f"
        target="_blank"
        title="Share on Facebook"
        class="share-btn facebook"
      >
        <i class="fab fa-facebook"></i>
      </a>
    </li>

    
    <li>
      <a
        href="//service.weibo.com/share/share.php?url=http%3a%2f%2flocalhost%3a1313%2fpost%2fmcmc-statics%2fmetropolis-hastings%2f&amp;appkey=&amp;title=The%20Metropolis-Hastings%20Algorithm%3a%20Breaking%20the%20Symmetry&amp;pic="
        target="_blank"
        title="Share on Weibo"
        class="share-btn weibo"
      >
        <i class="fab fa-weibo"></i>
      </a>
    </li>

    
    <li>
      <a
        href="javascript:void(0);"
        onclick="openWechatModal('http:\/\/localhost:1313\/post\/mcmc-statics\/metropolis-hastings\/')"
        title="Share on WeChat"
        class="share-btn wechat"
      >
        <i class="fab fa-weixin"></i>
      </a>
    </li>

    
    <li>
      <a
        href="//www.linkedin.com/shareArticle?url=http%3a%2f%2flocalhost%3a1313%2fpost%2fmcmc-statics%2fmetropolis-hastings%2f&amp;title=The%20Metropolis-Hastings%20Algorithm%3a%20Breaking%20the%20Symmetry"
        target="_blank"
        title="Share on LinkedIn"
        class="share-btn linkedin"
      >
        <i class="fab fa-linkedin"></i>
      </a>
    </li>

    
    <li>
      <a
        href="javascript:void(0);"
        onclick="copyToClipboard('http:\/\/localhost:1313\/post\/mcmc-statics\/metropolis-hastings\/', 'The Metropolis-Hastings Algorithm: Breaking the Symmetry')"
        title="Copy Link"
        class="share-btn copy-link"
      >
        <i class="fas fa-link"></i>
      </a>
    </li>
  </ul>
</div>


<div id="wechat-modal" class="wechat-modal">
  <div class="wechat-modal-content">
    <span class="wechat-close" onclick="closeWechatModal()">&times;</span>
    <h4>
      Scan to Share <br />
      ÂæÆ‰ø°Êâ´‰∏ÄÊâ´ÂàÜ‰∫´
    </h4>
    <div id="qrcode" class="qrcode-container"></div>
  </div>
</div>

<script type="text/javascript">
  function copyToClipboard(url, title) {
    navigator.clipboard.writeText(url).then(
      function () {
        
        var existingToast = document.getElementById("share-toast");
        if (existingToast) {
          existingToast.remove();
        }

        var toast = document.createElement("div");
        toast.id = "share-toast";
        toast.innerText = "Link copied to clipboard!";
        toast.style.position = "fixed";
        toast.style.bottom = "20px";
        toast.style.left = "50%";
        toast.style.transform = "translateX(-50%)";
        toast.style.backgroundColor = "rgba(0,0,0,0.8)";
        toast.style.color = "#fff";
        toast.style.padding = "10px 20px";
        toast.style.borderRadius = "5px";
        toast.style.zIndex = "10000";
        toast.style.opacity = "0";
        toast.style.transition = "opacity 0.5s ease-in-out";

        document.body.appendChild(toast);

        
        void toast.offsetWidth;

        toast.style.opacity = "1";

        setTimeout(function () {
          toast.style.opacity = "0";
          setTimeout(function () {
            if (toast.parentNode) toast.parentNode.removeChild(toast);
          }, 500);
        }, 3000);
      },
      function (err) {
        console.error("Could not copy text: ", err);
      },
    );
  }

  function openWechatModal(url) {
    var modal = document.getElementById("wechat-modal");
    modal.style.display = "flex";
    var qrcodeContainer = document.getElementById("qrcode");
    qrcodeContainer.innerHTML = "";
    var img = document.createElement("img");
    img.src =
      "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" +
      encodeURIComponent(url);
    img.style.width = "200px";
    img.style.height = "200px";
    qrcodeContainer.appendChild(img);
  }

  function closeWechatModal() {
    var modal = document.getElementById("wechat-modal");
    modal.style.display = "none";
  }

  
  window.onclick = function (event) {
    var modal = document.getElementById("wechat-modal");
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };
</script>


              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/post/mcmc-statics/metropolis/">Metropolis Algorithm Explained: Implementation &amp; Intuition</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://localhost:1313/post/mcmc-statics/metropolis/" data-toggle="tooltip" data-placement="top" title="Metropolis Algorithm Explained: Implementation &amp; Intuition">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      

    </div>
    
    
    <div class="col-lg-3 visible-lg-block">
      
      
      <div class="sidebar-toc">
        <h2 class="sidebar-toc-title">ÁõÆÂΩï</h2>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#why-asymmetry-the-motivation">Why &ldquo;Asymmetry&rdquo;? (The Motivation)</a>
      <ul>
        <li><a href="#reality-pain-points">Reality Pain Points</a>
          <ul>
            <li><a href="#pain-point-1-the-wall-problem">Pain Point 1: The &ldquo;Wall&rdquo; Problem</a></li>
            <li><a href="#pain-point-2-the-high-dim-maze">Pain Point 2: The High-Dim Maze</a></li>
          </ul>
        </li>
        <li><a href="#core-conflict-the-traffic-crisis-of-asymmetry">Core Conflict: The &ldquo;Traffic Crisis&rdquo; of Asymmetry</a></li>
        <li><a href="#-the-solution-idea">üí° The Solution Idea</a></li>
      </ul>
    </li>
    <li><a href="#the-hastings-correction">The Hastings Correction</a>
      <ul>
        <li><a href="#core-formula-from-metropolis-to-mh">Core Formula: From Metropolis to MH</a></li>
        <li><a href="#intuitive-understanding-cities-and-highways-">Intuitive Understanding: Cities and Highways üèôÔ∏èüõ£Ô∏è</a></li>
        <li><a href="#mathematical-proof-why-does-it-balance-the-proof">Mathematical Proof: Why Does it Balance? (The Proof)</a></li>
      </ul>
    </li>
    <li><a href="#the-choice-of-proposals--in-action">The Choice of Proposals ( in Action)</a>
      <ul>
        <li><a href="#independent-sampler">Independent Sampler</a></li>
        <li><a href="#log-normal-walk">Log-normal Walk</a></li>
        <li><a href="#mala-metropolis-adjusted-langevin-algorithm">MALA (Metropolis-Adjusted Langevin Algorithm)</a></li>
      </ul>
    </li>
    <li><a href="#python-implementation">Python Implementation</a></li>
    <li><a href="#mcmc-diagnostics--tuning">MCMC Diagnostics &amp; Tuning</a>
      <ul>
        <li><a href="#core-concepts-three-vitals">Core Concepts: Three Vitals</a>
          <ul>
            <li><a href="#trace-plot--the-ecg-of-mcmc">Trace Plot ‚Äî‚Äî The ECG of MCMC</a></li>
            <li><a href="#burn-in--discarding-garbage-time">Burn-in ‚Äî‚Äî Discarding Garbage Time</a></li>
            <li><a href="#acceptance-rate--goldilocks-principle">Acceptance Rate ‚Äî‚Äî Goldilocks Principle</a></li>
          </ul>
        </li>
        <li><a href="#python-code-diagnosing-sick-chains">Python Code: Diagnosing &ldquo;Sick&rdquo; Chains</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
      
    </div>
    
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:ele.qiong@gmail.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/ictar" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/qiongjie-xu" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://www.xuqiongjie.com">Qiongjie.X</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2026
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://localhost:1313/">Qiongjie&#39;s Notes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.147.4</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="http://localhost:1313/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="http://localhost:1313/js/load-photoswipe.js"></script>









<script src="http://localhost:1313/js/toc-enhancements.js"></script>


    
  </body>
</html>

